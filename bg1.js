var Bt=Object.defineProperty,Mt=Object.defineProperties;var Ut=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var Ie=(t,e,n)=>e in t?Bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E=(t,e)=>{for(var n in e||(e={}))Re.call(e,n)&&Ie(t,n,e[n]);if(V)for(var n of V(e))De.call(e,n)&&Ie(t,n,e[n]);return t},P=(t,e)=>Mt(t,Ut(e));var M=(t,e)=>{var n={};for(var i in t)Re.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&V)for(var i of V(t))e.indexOf(i)<0&&De.call(t,i)&&(n[i]=t[i]);return n};var ae,y,Ze,J,et,Ae,tt,ie={},nt=[],Ft=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function F(t,e){for(var n in e)t[n]=e[n];return t}function st(t){var e=t.parentNode;e&&e.removeChild(t)}function s(t,e,n){var i,r,o,l={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:l[o]=e[o];if(arguments.length>2&&(l.children=arguments.length>3?ae.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)l[o]===void 0&&(l[o]=t.defaultProps[o]);return Z(t,l,i,r,null)}function Z(t,e,n,i,r){var o={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r==null?++Ze:r};return r==null&&y.vnode!=null&&y.vnode(o),o}function x(t){return t.children}function ee(t,e){this.props=t,this.context=e}function j(t,e){if(e==null)return t.__?j(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?j(t):null}function it(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return it(t)}}function he(t){(!t.__d&&(t.__d=!0)&&J.push(t)&&!oe.__r++||Ae!==y.debounceRendering)&&((Ae=y.debounceRendering)||et)(oe)}function oe(){for(var t;oe.__r=J.length;)t=J.sort(function(e,n){return e.__v.__b-n.__v.__b}),J=[],t.some(function(e){var n,i,r,o,l,c;e.__d&&(l=(o=(n=e).__v).__e,(c=n.__P)&&(i=[],(r=F({},o)).__v=o.__v+1,ye(c,o,r,n.__n,c.ownerSVGElement!==void 0,o.__h!=null?[l]:null,i,l==null?j(o):l,o.__h),lt(i,o),o.__e!=l&&it(o)))})}function ot(t,e,n,i,r,o,l,c,d,u){var a,m,h,f,p,R,v,b=i&&i.__k||nt,k=b.length;for(n.__k=[],a=0;a<e.length;a++)if((f=n.__k[a]=(f=e[a])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?Z(null,f,null,null,f):Array.isArray(f)?Z(x,{children:f},null,null,null):f.__b>0?Z(f.type,f.props,f.key,null,f.__v):f)!=null){if(f.__=n,f.__b=n.__b+1,(h=b[a])===null||h&&f.key==h.key&&f.type===h.type)b[a]=void 0;else for(m=0;m<k;m++){if((h=b[m])&&f.key==h.key&&f.type===h.type){b[m]=void 0;break}h=null}ye(t,f,h=h||ie,r,o,l,c,d,u),p=f.__e,(m=f.ref)&&h.ref!=m&&(v||(v=[]),h.ref&&v.push(h.ref,null,f),v.push(m,f.__c||p,f)),p!=null?(R==null&&(R=p),typeof f.type=="function"&&f.__k===h.__k?f.__d=d=rt(f,d,t):d=at(t,f,h,b,p,d),typeof n.type=="function"&&(n.__d=d)):d&&h.__e==d&&d.parentNode!=t&&(d=j(h))}for(n.__e=R,a=k;a--;)b[a]!=null&&(typeof n.type=="function"&&b[a].__e!=null&&b[a].__e==n.__d&&(n.__d=j(i,a+1)),ut(b[a],b[a]));if(v)for(a=0;a<v.length;a++)ct(v[a],v[++a],v[++a])}function rt(t,e,n){for(var i,r=t.__k,o=0;r&&o<r.length;o++)(i=r[o])&&(i.__=t,e=typeof i.type=="function"?rt(i,e,n):at(n,i,i,r,i.__e,e));return e}function at(t,e,n,i,r,o){var l,c,d;if(e.__d!==void 0)l=e.__d,e.__d=void 0;else if(n==null||r!=o||r.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(r),l=null;else{for(c=o,d=0;(c=c.nextSibling)&&d<i.length;d+=2)if(c==r)break e;t.insertBefore(r,o),l=o}return l!==void 0?l:r.nextSibling}function Ht(t,e,n,i,r){var o;for(o in n)o==="children"||o==="key"||o in e||re(t,o,null,n[o],i);for(o in e)r&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||re(t,o,e[o],n[o],i)}function Pe(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||Ft.test(e)?n:n+"px"}function re(t,e,n,i,r){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||Pe(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||Pe(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?i||t.addEventListener(e,o?$e:Le,o):t.removeEventListener(e,o?$e:Le,o);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n==null?"":n;break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function Le(t){this.l[t.type+!1](y.event?y.event(t):t)}function $e(t){this.l[t.type+!0](y.event?y.event(t):t)}function ye(t,e,n,i,r,o,l,c,d){var u,a,m,h,f,p,R,v,b,k,D,S=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(d=n.__h,c=e.__e=n.__e,e.__h=null,o=[c]),(u=y.__b)&&u(e);try{e:if(typeof S=="function"){if(v=e.props,b=(u=S.contextType)&&i[u.__c],k=u?b?b.props.value:u.__:i,n.__c?R=(a=e.__c=n.__c).__=a.__E:("prototype"in S&&S.prototype.render?e.__c=a=new S(v,k):(e.__c=a=new ee(v,k),a.constructor=S,a.render=jt),b&&b.sub(a),a.props=v,a.state||(a.state={}),a.context=k,a.__n=i,m=a.__d=!0,a.__h=[]),a.__s==null&&(a.__s=a.state),S.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=F({},a.__s)),F(a.__s,S.getDerivedStateFromProps(v,a.__s))),h=a.props,f=a.state,m)S.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(S.getDerivedStateFromProps==null&&v!==h&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(v,k),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(v,a.__s,k)===!1||e.__v===n.__v){a.props=v,a.state=a.__s,e.__v!==n.__v&&(a.__d=!1),a.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(C){C&&(C.__=e)}),a.__h.length&&l.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(v,a.__s,k),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(h,f,p)})}a.context=k,a.props=v,a.state=a.__s,(u=y.__r)&&u(e),a.__d=!1,a.__v=e,a.__P=t,u=a.render(a.props,a.state,a.context),a.state=a.__s,a.getChildContext!=null&&(i=F(F({},i),a.getChildContext())),m||a.getSnapshotBeforeUpdate==null||(p=a.getSnapshotBeforeUpdate(h,f)),D=u!=null&&u.type===x&&u.key==null?u.props.children:u,ot(t,Array.isArray(D)?D:[D],e,n,i,r,o,l,c,d),a.base=e.__e,e.__h=null,a.__h.length&&l.push(a),R&&(a.__E=a.__=null),a.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Wt(n.__e,e,n,i,r,o,l,d);(u=y.diffed)&&u(e)}catch(C){e.__v=null,(d||o!=null)&&(e.__e=c,e.__h=!!d,o[o.indexOf(c)]=null),y.__e(C,e,n)}}function lt(t,e){y.__c&&y.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(i){i.call(n)})}catch(i){y.__e(i,n.__v)}})}function Wt(t,e,n,i,r,o,l,c){var d,u,a,m=n.props,h=e.props,f=e.type,p=0;if(f==="svg"&&(r=!0),o!=null){for(;p<o.length;p++)if((d=o[p])&&"setAttribute"in d==!!f&&(f?d.localName===f:d.nodeType===3)){t=d,o[p]=null;break}}if(t==null){if(f===null)return document.createTextNode(h);t=r?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,h.is&&h),o=null,c=!1}if(f===null)m===h||c&&t.data===h||(t.data=h);else{if(o=o&&ae.call(t.childNodes),u=(m=n.props||ie).dangerouslySetInnerHTML,a=h.dangerouslySetInnerHTML,!c){if(o!=null)for(m={},p=0;p<t.attributes.length;p++)m[t.attributes[p].name]=t.attributes[p].value;(a||u)&&(a&&(u&&a.__html==u.__html||a.__html===t.innerHTML)||(t.innerHTML=a&&a.__html||""))}if(Ht(t,h,m,r,c),a)e.__k=[];else if(p=e.props.children,ot(t,Array.isArray(p)?p:[p],e,n,i,r&&f!=="foreignObject",o,l,o?o[0]:n.__k&&j(n,0),c),o!=null)for(p=o.length;p--;)o[p]!=null&&st(o[p]);c||("value"in h&&(p=h.value)!==void 0&&(p!==t.value||f==="progress"&&!p||f==="option"&&p!==m.value)&&re(t,"value",p,m.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==t.checked&&re(t,"checked",p,m.checked,!1))}return t}function ct(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(i){y.__e(i,n)}}function ut(t,e,n){var i,r;if(y.unmount&&y.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||ct(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){y.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&ut(i[r],e,typeof t.type!="function");n||t.__e==null||st(t.__e),t.__e=t.__d=void 0}function jt(t,e,n){return this.constructor(t,n)}function Qt(t,e,n){var i,r,o;y.__&&y.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,o=[],ye(e,t=(!i&&n||e).__k=s(x,null,[t]),r||ie,ie,e.ownerSVGElement!==void 0,!i&&n?[n]:r?null:e.firstChild?ae.call(e.childNodes):null,o,!i&&n?n:r?r.__e:e.firstChild,i),lt(o,t)}function le(t,e){var n={__c:e="__cC"+tt++,__:t,Consumer:function(i,r){return i.children(r)},Provider:function(i){var r,o;return this.getChildContext||(r=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(l){this.props.value!==l.value&&r.some(he)},this.sub=function(l){r.push(l);var c=l.componentWillUnmount;l.componentWillUnmount=function(){r.splice(r.indexOf(l),1),c&&c.call(l)}}),i.children}};return n.Provider.__=n.Consumer.contextType=n}ae=nt.slice,y={__e:function(t,e,n,i){for(var r,o,l;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),l=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),l=r.__d),l)return r.__E=r}catch(c){t=c}throw t}},Ze=0,ee.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=F({},this.state),typeof t=="function"&&(t=t(F({},n),this.props)),t&&F(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),he(this))},ee.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),he(this))},ee.prototype.render=x,J=[],et=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,oe.__r=0,tt=0;let dt="America/New_York";function Yt(t){dt=t}function $(t){t=new Date(t||Date.now());const e={},n="2-digit";return Intl.DateTimeFormat("en-US",{timeZone:dt,hourCycle:"h23",year:"numeric",month:n,day:n,hour:n,minute:n,second:n}).formatToParts(t).forEach(i=>e[i.type]=i.value),{date:`${e.year}-${e.month}-${e.day}`,time:`${e.hour}:${e.minute}:${e.second}`}}function U(t){const e=t.split(":").map(Number),n=e[0]>=12?"PM":"AM";return e[0]=e[0]%12||12,e.map(i=>String(i).padStart(2,"0")).join(":").replace(/:00$/,"").replace(/^0/,"")+" "+n}class mt extends Error{constructor(e){super(`Auth data "${e}" missing or expired`),this.name="ReauthNeeded"}}class Jt{constructor(e,n=localStorage){this.storageKey=e,this.storage=n}getData(){const e=this.storage.getItem(this.storageKey);if(e){const{swid:n,accessToken:i,expires:r}=JSON.parse(e),o=$(new Date(r)),l=$();if(o.date>l.date||o.date===l.date&&o.time>l.time&&o.time>="17")return{swid:n,accessToken:i}}throw new mt(this.storageKey)}setData(e){this.storage.setItem(this.storageKey,JSON.stringify(e))}deleteData(){this.storage.removeItem(this.storageKey)}}const qt="modulepreload",Oe={},zt="/bg1/",Ge=function(e,n){return!n||n.length===0?e():Promise.all(n.map(i=>{if(i=`${zt}${i}`,i in Oe)return;Oe[i]=!0;const r=i.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${o}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":qt,r||(l.as="script",l.crossOrigin=""),l.href=i,document.head.appendChild(l),r)return new Promise((c,d)=>{l.addEventListener("load",c),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())},Kt=8e3;async function _e(t,e={}){const u=e,{params:n,data:i,timeout:r=Kt}=u;e=M(u,["params","data","timeout"]),e.referrer||(e.referrer=""),e.credentials||(e.credentials="omit"),e.cache||(e.cache="no-store"),e.headers=E({"User-Agent":"Mozilla/5.0"},e.headers||{}),n&&(t+="?"+Object.entries(n).filter(([,a])=>a!=="").map(a=>a.map(encodeURIComponent).join("=")).join("&")),i&&(e.method||(e.method="POST"),e.headers=P(E({},e.headers),{"Content-Type":"application/json"}),e.body=JSON.stringify(i));const l=new AbortController;e.signal=l.signal;const c=setTimeout(()=>l.abort(),r);let d;try{d=await fetch(t,e)}catch(a){return console.error(a),{status:0,data:null}}finally{clearTimeout(c)}return{status:d.status,data:(d.headers.get("Content-Type")||"").startsWith("application/json")?await d.json():{}}}function Vt(t){switch(t){case"./data/dlr.ts":return Ge(()=>import("./dlr.js"),[]);case"./data/wdw.ts":return Ge(()=>import("./wdw.js"),[]);default:return new Promise(function(e,n){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t)))})}}const pe={"https://disneyworld.disney.go.com":"WDW","https://disneyland.disney.go.com":"DLR"},Xt={WDW:"wdw-itinerary-api",DLR:"dlr-itinerary-web-api"};function Zt(t){return t in pe}class ft extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}const X=t=>t.split(";")[0];class be{constructor(e){this.reauth=()=>{},this.guestNames=new Map,this._primaryGuestId="",this.origin=e.origin,this.getAuthData=e.getAuthData,this.data=e.data,this.bookingStack=new en}static async load(e){const n=(await Vt(`./data/${pe[e.origin].toLocaleLowerCase()}.ts`)).default;return new be(P(E({},e),{data:n}))}get resort(){return pe[this.origin]}get parks(){return this.data.parks}async plusExperiences(e){return(await this.request({path:`/tipboard-vas/api/v1/parks/${encodeURIComponent(e.id)}/experiences`,key:"availableExperiences"})).map(i=>E(E({},i),this.data.experiences[i.id])).filter(i=>!!(i.name&&i.flex))}async guests(e){const n=await this.request({path:"/ea-vas/api/v1/guests",params:{productType:"FLEX",experienceId:e.experience.id,parkId:e.park.id}});this._primaryGuestId=n.primaryGuestId;const i=u=>{var a=u,{firstName:l,lastName:c}=a,d=M(a,["firstName","lastName"]);return P(E({},d),{name:`${l} ${c}`.trim()})},r=n.ineligibleGuests.map(i),o=n.guests.map(i).filter(l=>"ineligibleReason"in l?(r.push(l),!1):!0);return[...o,...r].forEach(l=>{this.guestNames.has(l.id)||this.guestNames.set(l.id,l.name)}),o.sort((l,c)=>l.name.localeCompare(c.name)),r.sort((l,c)=>{const d=l.name.localeCompare(c.name);return l.eligibleAfter||c.eligibleAfter?(l.eligibleAfter||"99").localeCompare(c.eligibleAfter||"99")||d:l.ineligibleReason===c.ineligibleReason?d:l.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?-1:c.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?1:d}),{eligible:o,ineligible:r}}async primaryGuestId(e){return this._primaryGuestId||await this.guests(e),this._primaryGuestId}async offer({experience:e,park:n,guests:i}){const{id:r,date:o,startTime:l,endTime:c,changeStatus:d}=await this.request({path:"/ea-vas/api/v1/products/flex/offers",method:"POST",data:{productType:"FLEX",guestIds:i.map(u=>u.id),primaryGuestId:await this.primaryGuestId({experience:e,park:n}),parkId:n.id,experienceId:e.id,selectedTime:e.flex.nextAvailableTime},key:"offer"});return{id:r,start:{date:o,time:l},end:{date:o,time:c},changeStatus:d}}async cancelOffer(e){await this.request({path:`/ea-vas/api/v1/offers/${encodeURIComponent(e.id)}`,method:"DELETE",params:{productType:"FLEX"},userId:!1})}async book(e){const{singleExperienceDetails:{experienceId:n,parkId:i},entitlements:r,startDateTime:o,endDateTime:l}=await this.request({path:"/ea-vas/api/v1/products/flex/bookings",method:"POST",userId:!1,data:{offerId:e.id},key:"booking"});return this.bookings(),{experience:{id:n,name:this.data.experiences[n].name},park:this.data.parks.find(c=>c.id===i),start:$(o),end:$(l),cancellable:!0,guests:r.map(c=>({id:c.guestId,name:this.guestNames.get(c.guestId)||"",entitlementId:c.id}))}}async cancelBooking(e){const i=e.map(r=>r.entitlementId).map(encodeURIComponent).join(",");await this.request({path:`/ea-vas/api/v1/entitlements/${i}`,method:"DELETE",userId:!1})}async bookings(){const{swid:e}=this.getAuthData(),n=new Date(Date.now()),i=Xt[this.resort],{items:r=[],assets:o={},profiles:l={}}=await this.request({path:`/plan/${i}/api/v1/itinerary-items/${e}`,params:{destination:this.resort,fields:"items,profiles,assets","item-types":"FASTPASS","guest-locators":e+";type=swid","guest-locator-groups":"MY_FAMILY","start-date":$(n).date,"end-date":$(new Date(n.getTime()).setDate(n.getDate()+1)).date,"show-friends":"false"},userId:!1}),c=Object.fromEntries(this.parks.map(m=>[m.id,m])),d=$(new Date(n.getTime()).setMinutes(n.getMinutes()-15)),u=new Set(["FLEX","OTHER"]),a=r.filter(m=>m.type==="FASTPASS"&&u.has(m.kind)).filter(m=>(!m.displayEndDate||m.displayEndDate>=d.date)&&(!m.displayEndTime||m.displayEndTime>=d.time)).map(m=>{const h=X(m.facility),f=o[m.facility],{name:p}=this.data.experiences[h]||f,R=X(f.location),v={experience:{id:h,name:p},park:c[R],start:{date:m.displayStartDate,time:m.displayStartTime},end:{date:m.displayEndDate,time:m.displayEndTime},cancellable:m.cancellable,guests:m.guests.map(b=>{const{name:k}=l[b.id];return E({id:X(b.id),entitlementId:b.entitlementId,name:`${k.firstName} ${k.lastName}`.trim()},b.redemptionsRemaining!==void 0&&{redemptions:b.redemptionsRemaining})})};return m.multipleExperiences&&(v.experience={id:"",name:"Multiple Experiences"},v.choices=m.assets.filter(b=>!b.excluded&&!b.original).map(({content:b})=>{const k=X(b),{name:D}=this.data.experiences[k]||o[b];return{id:k,name:D}}).sort((b,k)=>b.name.localeCompare(k.name))),v}).sort((m,h)=>((m.start.date||"0000-00-00")+(m.start.time||"")).localeCompare((h.start.date||"0000-00-00")+(h.start.time||"")));return this.bookingStack.update(a),a}isRebookable(e){return this.bookingStack.isRebookable(e)}pdt(e){var i;const n=$().time.slice(0,5);return(i=this.data.pdts[e.id])==null?void 0:i.find(r=>r>=n)}async request(e){var u;const{swid:n,accessToken:i}=this.getAuthData(),r=this.origin+e.path,o=E({},e.params);((u=e.userId)==null||u)&&(o.userId=n);const{status:l,data:c}=await _e(r,{method:e.method||"GET",params:o,data:e.data,headers:{Authorization:`BEARER ${i}`}});l===401&&this.reauth();const{key:d}=e;if(String(l)[0]==="2"&&(!d||c[d]))return d?c[d]:c;throw new ft({status:l,data:c})}}const Be="bg1.genie.bookings";class en{constructor(e=!0){if(this.entitlementIds=[],this.mostRecent=new Map,!e)return;const{entitlementIds:n=[],mostRecent:i={}}=JSON.parse(localStorage.getItem(Be)||"{}");this.entitlementIds=n,this.mostRecent=new Map(Object.entries(i))}isRebookable(e){return e.guests.every(n=>this.mostRecent.get(n.id)===n.entitlementId)}update(e){const n=new Map,i=new Set(this.entitlementIds);this.entitlementIds=e.filter(({cancellable:r})=>r).map(r=>r.guests.map(({id:o,entitlementId:l})=>(this.entitlementIds.push(l),i.has(l)||n.set(o,n.has(o)?"":l),l))).flat(1),this.mostRecent=new Map([...this.mostRecent,...n]),n.size>0&&localStorage.setItem(Be,JSON.stringify({entitlementIds:this.entitlementIds,mostRecent:Object.fromEntries(this.mostRecent)}))}}const ht={"https://vqguest-svc-wdw.wdprapps.disney.com":"WDW","https://vqguest-svc.wdprapps.disney.com":"DLR"};function tn(t){return t in ht}function nn(t){return t.sort((e,n)=>e.isPrimaryGuest!==n.isPrimaryGuest?Number(n.isPrimaryGuest)-Number(e.isPrimaryGuest):e.isPreselected!==n.isPreselected?Number(n.isPreselected)-Number(e.isPreselected):e.name.localeCompare(n.name))}class te extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}class sn{constructor(e){this.reauth=()=>{},this.origin=e.origin,this.getAuthData=e.getAuthData}get resort(){return ht[this.origin]}url(e){return`${this.origin}/application/v1/guest/${e}`}async getQueues(){return(await _e(this.url("getQueues"))).data.queues.map(i=>{var r=i,{queueId:e}=r,n=M(r,["queueId"]);return P(E({},n),{id:e})}).sort((e,n)=>e.categoryContentId===n.categoryContentId?e.name.localeCompare(n.name):e.categoryContentId==="attraction"?-1:1)}async getQueue(e){const n=(await this.getQueues()).find(i=>i.id===e.id);if(n)return n;throw new Error("Queue not Found")}async getLinkedGuests(e){const{data:n}=await this.post({resource:"getLinkedGuests",data:{queueId:e.id}});return nn(n.guests.map(c=>{var d=c,{guestId:i,firstName:r,lastName:o}=d,l=M(d,["guestId","firstName","lastName"]);return P(E({},l),{id:i,name:`${r} ${o}`.trim()})}))}async joinQueue(e,n){const i=n.map(l=>l.id),{status:r,data:o}=await this.post({resource:"joinQueue",data:{queueId:e.id,guestIds:i}});if(o.responseStatus==="OK"){const l=o.positions.find(c=>c.queueId===e.id&&c.guestIds.length>0&&i.some(d=>c.guestIds.includes(d)));if(!l)throw new te({status:r,data:o});return{boardingGroup:l.boardingGroup,conflicts:{},closed:!1}}else if(o.responseStatus==="INVALID_GUEST"||o.responseStatus==="CLOSED_QUEUE"){const l=o.responseStatus==="CLOSED_QUEUE",c=new Set,d={};for(const m of o.conflicts)for(const h of m.guestIds){const f=n.find(p=>p.id===h);!f||(d[f.id]=m.conflictType,c.add(h))}const u=n.filter(m=>!c.has(m.id));if(l||u.length===0)return{boardingGroup:null,conflicts:d,closed:l};const a=await this.joinQueue(e,u);return a.conflicts=E(E({},d),a.conflicts),a}else throw new te({status:r,data:o})}async post(e){const{status:n,data:i}=await _e(this.url(e.resource),{method:"POST",headers:{Authorization:`BEARER ${this.getAuthData().accessToken}`},data:e.data});if(n===401&&setTimeout(()=>this.reauth()),!n||n>=500)throw new te({status:n,data:i});return{status:n,data:i}}}var z,A,Me,q=0,_t=[],Ue=y.__b,Fe=y.__r,He=y.diffed,We=y.__c,je=y.unmount;function ce(t,e){y.__h&&y.__h(A,t,q||e),q=0;var n=A.__H||(A.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function w(t){return q=1,on(yt,t)}function on(t,e,n){var i=ce(z++,2);return i.t=t,i.__c||(i.__=[n?n(e):yt(void 0,e),function(r){var o=i.t(i.__[0],r);i.__[0]!==o&&(i.__=[o,i.__[1]],i.__c.setState({}))}],i.__c=A),i.__}function I(t,e){var n=ce(z++,3);!y.__s&&gt(n.__H,e)&&(n.__=t,n.__H=e,A.__H.__h.push(n))}function ve(t){return q=5,pt(function(){return{current:t}},[])}function pt(t,e){var n=ce(z++,7);return gt(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Q(t,e){return q=8,pt(function(){return t},e)}function ue(t){var e=A.context[t.__c],n=ce(z++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(A)),e.props.value):t.__}function rn(){for(var t;t=_t.shift();)if(t.__P)try{t.__H.__h.forEach(ne),t.__H.__h.forEach(ge),t.__H.__h=[]}catch(e){t.__H.__h=[],y.__e(e,t.__v)}}y.__b=function(t){A=null,Ue&&Ue(t)},y.__r=function(t){Fe&&Fe(t),z=0;var e=(A=t.__c).__H;e&&(e.__h.forEach(ne),e.__h.forEach(ge),e.__h=[])},y.diffed=function(t){He&&He(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(_t.push(e)!==1&&Me===y.requestAnimationFrame||((Me=y.requestAnimationFrame)||function(n){var i,r=function(){clearTimeout(o),Qe&&cancelAnimationFrame(i),setTimeout(n)},o=setTimeout(r,100);Qe&&(i=requestAnimationFrame(r))})(rn)),A=null},y.__c=function(t,e){e.some(function(n){try{n.__h.forEach(ne),n.__h=n.__h.filter(function(i){return!i.__||ge(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],y.__e(i,n.__v)}}),We&&We(t,e)},y.unmount=function(t){je&&je(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{ne(i)}catch(r){e=r}}),e&&y.__e(e,n.__v))};var Qe=typeof requestAnimationFrame=="function";function ne(t){var e=A,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),A=e}function ge(t){var e=A;t.__c=t.__(),A=e}function gt(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function yt(t,e){return typeof e=="function"?e(t):e}const bt={bg:"bg-blue-500"},vt=le(bt),an=vt.Provider,H=()=>ue(vt),ln={normal:"py-1",small:"py-1.5 text-xs uppercase tracking-wide",full:"w-full py-3"};function L(t){const l=t,{type:e,className:n}=l,i=M(l,["type","className"]),r=(n||"")+" "+ln[e||"normal"],{bg:o}=H();return s("button",E({className:`${r} border-2 border-white rounded-lg px-2 ${o} text-white font-semibold disabled:opacity-50`},i))}function G({onClick:t,disabled:e,href:n,children:i}){return s("div",{className:"mb-20"},s("div",{className:"fixed bottom-0 left-0 w-full bg-white bg-opacity-75 text-center"},s("a",{href:n,className:"block max-w-2xl mx-auto px-3 pb-5"},s(L,{type:"full",onClick:t,disabled:e},i))))}function cn({title:t,children:e}){const{bg:n}=H();return s("div",{className:`flex justify-end gap-x-2 gap-y-1 min-h-[52px] px-3 py-2 font-semibold text-white ${n}`},s("h1",{className:"flex-1 self-center py-0.5 text-xl overflow-hidden whitespace-nowrap"},t),e)}function we(t){const o=t,{children:e,className:n}=o,i=M(o,["children","className"]),r=E({outer:"",inner:""},typeof n=="string"?{inner:n}:n);return s("div",E({className:`${r.outer} fixed inset-0`},i),s("div",{className:`${r.inner} max-w-2xl min-h-full mx-auto`},e))}function B(c){var d=c,{heading:t,buttons:e,className:n,theme:i,containerRef:r,children:o}=d,l=M(d,["heading","buttons","className","theme","containerRef","children"]);return s(an,{value:i||bt},s(we,E({className:{outer:`bg-white ${n||""}`,inner:"flex flex-col max-w-2xl h-full"}},l),s(cn,{title:t},e),s("div",{ref:r,className:"flex-1 overflow-auto px-3 pb-3"},o)))}const un="bg1.disclaimer.accepted",dn={bg:"bg-red-600"};function mn(){const t=localStorage,e=un,[n,i]=w(!!t.getItem(e));return I(()=>{n&&t.setItem(e,"1")},[n,t,e]),n?null:s(fn,{onAccept:()=>i(!0)})}function fn({onAccept:t}){return s(B,{heading:"Warning!",theme:dn},s("p",null,'Use at your own risk. BG1 is highly experimental, for demonstration purposes only, and provided "as is" without warranty of any kind. It is in no way endorsed by or associated with the Walt Disney Company and could stop working at any time for any reason. To ensure the intended experience, always use the official Disney app.'),s(G,{onClick:t},"Accept"))}const hn="17e2767256f";function _n(t){return"deferredUuid"in t&&t.deferredUuid!==void 0}class pn{constructor(e,n,i,r=!1){this.iframe=e,this.resort=i,this.logging=r,this.handlers={},this.handshakeAcked=!1,this.onMessage=o=>{if(o.source!==this.iframe.contentWindow||o.data==="inner.loaded")return;const l=JSON.parse(o.data);this.logging&&console.log("Message:",l);const c=l.type==="message"?l.eventName:l.type,d=this.handlers[c],u=d?d("data"in l?l.data:null):void 0;_n(l)&&this.send({type:"deferred",action:"resolve",deferredUuid:l.deferredUuid,data:u!=null?u:{}})},this.on("handshake",()=>{this.handshakeAcked||(this.handshakeAcked=!0,this.send({type:"handshakeAck"}),this.logging&&this.sendMessage("setLogLevel",{level:"log"}),this.sendMessage("workflow.execute",{name:"login"}))}),this.on("lightbox.hide",()=>this.open()),this.on("session.dateOfBirth.read",()=>this.open()),this.on("session.loggedin",({token:o})=>{n({swid:o.swid,accessToken:o.access_token,expires:new Date(o.exp)})})}open(){addEventListener("message",this.onMessage),this.iframe.src=this.authPageUrl,this.handshakeAcked=!1}close(){removeEventListener("message",this.onMessage)}on(e,n){this.handlers[e]=n}sendMessage(e,n){this.send({type:"message",eventName:e,data:n})}send(e){var n;(n=this.iframe.contentWindow)==null||n.postMessage(JSON.stringify(P(E({},e),{name:"lightbox-client-window"})),this.authPageUrl)}get authPageUrl(){return`https://cdn.registerdisney.go.com/v2/TPR-${this.resort}-LBSDK.IOS-PROD/en-US?include=l10n,config,html,js&buildId=${hn}`}}function gn({resort:t,onLogin:e}){const n=ve(null);return I(()=>{if(!n.current)return;const i=new pn(n.current,e,t);return i.open(),()=>i.close()},[t,e,n]),s("iframe",{title:"Disney Login Form",ref:n,className:"fixed top-0 left-0 w-full h-full border-0"})}const wt=le({reauth:()=>{}}),yn=wt.Provider,xe=()=>ue(wt),de=xe,bn=xe;function vn({resort:t,authStore:e,children:n}){const[i,r]=w("Blank"),o=mn(),l=xe();return I(()=>{l.reauth=()=>{throw console.log("reauth"),r("LoginForm"),new Error("oops")}},[l]),I(()=>{function d(){if(!document.hidden)try{e.getData(),r("Client")}catch(u){if(u instanceof mt)return r("LoginForm");console.error(u)}}return d(),document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[e]),s(x,null,o||{Blank:s("div",null),LoginForm:s(gn,{resort:t,onLogin:d=>{e.setData(d),r("Client")}}),Client:n}[i])}const xt=le({current:null,begin:()=>null,end:()=>null}),wn=xt.Provider,K=()=>ue(xt),xn=3e3,kn={alert:"bg-yellow-200",error:"bg-red-200"};function ke(){const[,t]=w(0),[e,n]=w(""),[i,r]=w("alert"),o=Q((c,d)=>{n(c),r(d||"alert"),t(u=>(clearTimeout(u),c?self.setTimeout(()=>{n("")},xn):u))},[]);return[s(Nn,{message:e,type:i}),o]}function Nn({message:t,type:e}){return t?s("div",{role:"alert",className:`fixed bottom-20 left-0 w-full p-2 font-semibold text-center ${kn[e]} text-gray-800`},t):null}function kt({children:t,className:e}){return e||(e=""),e.match(/\bw-\S+\s*/)||(e+=" w-4"),e.match(/\bh-\S+\s*/)||(e+=" h-auto"),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16",className:e},t)}/**
 * Refresh icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function Ne({className:t}){return s(kt,{className:t},s("path",{d:"M16 6h-6l2.243-2.243c-1.133-1.133-2.64-1.757-4.243-1.757s-3.109 0.624-4.243 1.757c-1.133 1.133-1.757 2.64-1.757 4.243s0.624 3.109 1.757 4.243c1.133 1.133 2.64 1.757 4.243 1.757s3.109-0.624 4.243-1.757c0.095-0.095 0.185-0.192 0.273-0.292l1.505 1.317c-1.466 1.674-3.62 2.732-6.020 2.732-4.418 0-8-3.582-8-8s3.582-8 8-8c2.209 0 4.209 0.896 5.656 2.344l2.343-2.344v6z"}))}async function Nt(t){return new Promise(e=>{setTimeout(e,t)})}function En(){const[t,e]=w(0),n=Q(async(r,o=500)=>{e(c=>c+1);const l=Nt(o);try{await r()}finally{await l,e(c=>c-1)}},[]);return[t>0?s(Tn,null):null,n]}function Tn(){const{bg:t}=H();return s(we,{className:"flex items-center bg-white bg-opacity-75"},s("div",{className:"w-[50px] mx-auto"},s("div",{"aria-label":"Loading\u2026",className:`rounded-full p-[20%] ${t}`},s(Ne,{className:"animate-spin w-full text-white"}))))}function Ee(){const[t,e]=En(),n=!!t,[i,r]=ke();return{loadData:Q(async(c,d)=>{const u=E({error:"Unknown error occurred",request:"Network request failed"},d);r("");let a=()=>null;const m=new Promise(f=>{a=()=>f(null)});async function h(...f){await m,r(...f)}await e(async()=>{try{await c(h)}catch(f){if(f instanceof ft){const{status:p}=f.response;h(p in u?u[p]:u.request,"error")}else console.error(f),h(u.error,"error")}}),a()},[e,r]),loaderElem:s(x,null,i,t),isLoading:n}}/**
 * Power icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function Sn({className:t}){return s(kt,{className:t},s("path",{d:"M6 0l-6 8h6l-4 8 14-10h-8l6-6z"}))}function Ye(t){const r=t,{className:e}=r,n=M(r,["className"]),{bg:i}=H();return s("select",E({className:`${e||""} border-2 border-white rounded-lg px-1 ${i} font-semibold disabled:opacity-50`},n))}const Et=le({eligible:[],ineligible:[],selected:[],setSelected:()=>null}),Cn=Et.Provider,Te=()=>ue(Et);function O({guests:t,selectable:e,conflicts:n}){return t.length===0?null:s("ul",{className:"mt-2"},t.map(i=>{var r;return s("li",{key:i.id,className:"px-3 py-1"},s("label",{className:"flex items-center"},e?s("input",{type:"checkbox",checked:e.isSelected(i),onChange:()=>e.onToggle(i),className:"mr-3"}):null,s("span",{className:"w-[48px] h-[48px] leading-[48px] mr-3 rounded-full text-3xl font-bold text-center bg-gray-400 text-white"},i.avatarImageUrl?s("img",{src:i.avatarImageUrl,alt:"",width:"48",height:"48",className:"rounded-full"}):s("span",{"aria-hidden":"true"},i.name[0])),s("span",{className:"leading-tight"},i.name,s("br",null),n!=null&&n[i.id]?s("span",{className:"text-xs font-semibold text-red-700 uppercase"},(r=n[i.id])==null?void 0:r.replace(/_/g," ")):null)))}))}function Se({times:t}){return s("div",{className:"mt-4 text-lg"},"Arrive by:"," ",s("span",{className:"ml-0.5 font-semibold"},t.start.time?s("time",null,U(t.start.time)):"Park Open"," - ",t.end.time?s("time",null,U(t.end.time)):"Park Close"))}function In({booking:t,onClose:e}){const n=de(),[i,r]=w(new Set),{loadData:o,loaderElem:l}=Ee(),{guests:c}=t,d=i.size===0,u=i.size===c.length;function a(){o(async()=>{d||await n.cancelBooking([...i]),e(c.filter(m=>!i.has(m)))})}return s(B,{heading:"Your Lightning Lane",theme:t.park.theme},s("h2",null,t.experience.name),s("div",null,t.park.name),s(Se,{times:t}),s("div",{className:"ml-3"},s("label",{className:"flex items-center py-4"},s("input",{type:"checkbox",checked:u,onChange:()=>r(new Set(u?[]:c))}),s("span",{className:"ml-3"},"Select All"))),d?null:s("div",{className:"mb-4"},s("h3",null,"Cancel These Guests"),s(O,{guests:c.filter(m=>i.has(m)),selectable:{isSelected:()=>!0,onToggle:m=>{const h=new Set(i);h.delete(m),r(h)}}})),u?null:s("div",null,s("h3",null,"Select Guests to Cancel"),s(O,{guests:c.filter(m=>!i.has(m)),selectable:{isSelected:()=>!1,onToggle:m=>r(new Set(i).add(m))}})),s(G,{onClick:a},d?"Back":"Cancel "+(u?"Reservation":"Guests")),l)}function Tt({booking:t,onClose:e,isRebookable:n,isNew:i}){const r=K(),[o,l]=w(t.guests),[c,d]=w(!1);return c?s(In,{booking:P(E({},t),{guests:o}),onClose:u=>{d(!1),u.length>0?l(u):e(u)}}):s(B,{heading:"Your Lightning Lane",theme:t.park.theme,buttons:n&&s(L,{onClick:()=>r.begin(t)},"Rebook")},s("h2",null,t.experience.name),s("div",null,t.park.name),s(Se,{times:t}),t.choices&&s(x,null,s("p",null,"An experience you booked was temporarily unavailable during your return time. You may redeem this Lightning Lane at one of these replacement experiences:"),s("ul",{className:"list-disc mt-2 pl-8"},t.choices.map(u=>s("li",{key:u.id},u.name)))),s("div",{className:"flex mt-4"},s("h3",{className:"inline mt-0"},"Your Party"),t.cancellable&&s(L,{type:"small",onClick:()=>d(!0),className:"ml-3"},"Cancel")),s(O,{guests:o,conflicts:Object.fromEntries(o.filter(u=>u.redemptions!==void 0).map(u=>[u.id,`Redemptions left: ${u.redemptions}`]))}),s(G,{onClick:()=>e(o)},i?"Done":"Back"))}function St(){const{ineligible:t}=Te();return s(O,{guests:t,conflicts:Object.fromEntries(t.map(e=>[e.id,e.eligibleAfter?`TOO EARLY (${U(e.eligibleAfter)})`:e.ineligibleReason||"ELIGIBLE FOR NEW BOOKING"]))})}function Ct({buttonText:t,onSubmit:e}){const{eligible:n,ineligible:i,selected:r,setSelected:o}=Te(),[l,c]=w();return l?s(x,null,s("h3",null,"Choose Your Party"),s(O,{guests:n,selectable:{isSelected:u=>l.has(u),onToggle:u=>c(a=>(a=new Set(a),a[a.has(u)?"delete":"add"](u),a))}}),i.length>0&&s(x,null,s("h3",null,"Ineligible Guests"),s(St,null)),s(G,{disabled:l.size===0,onClick:()=>{o([...l]),c(void 0)}},"Confirm Party")):s(x,null,s("div",{className:"mt-4"},s("h3",{className:"inline mt-0"},"Your Party"),s("span",null,s(L,{type:"small",onClick:()=>c(new Set(r)),className:"ml-3"},"Edit"))),s(O,{guests:r}),s(G,{onClick:e},t))}function Rn({offer:t,onBook:e}){const n=K();return s(x,null,n.current&&s("p",{className:"border-2 rounded border-red-600 p-1 font-semibold text-center text-red-600 bg-red-100"},"Rebooking resets the two hour timer"),s(Se,{times:t}),t.changeStatus==="PARK_HOPPING"&&s("div",{className:"text-sm"},s("strong",null,"Note:")," Time changed due to park hopping"),s(Ct,{buttonText:`${n.current?"Rebook":"Book"} Lightning Lane`,onSubmit:e}))}const Je="https://widget.time.is/t.js";function Dn(){if([...document.scripts].some(e=>e.src===Je))return;const t=document.createElement("script");t.src=Je,t.onload=It,document.head.appendChild(t)}const se={};function It(){"time_is_widget"in self&&self.time_is_widget.init(se)}function An(t){Dn(),se[t]||(se[t]={}),It()}function Rt(t,e){const n=document.getElementById(t);if(!n||n.firstElementChild)return e();n.textContent=$().time,setTimeout(()=>Rt(t,e),100)}function Pn({id:t,onSync:e}){return I(()=>{An(t),Rt(t,e)},[t,e]),s("time",{id:t})}const Ln={WDW:"Orlando_z161",DLR:"Anaheim_z14e"},$n=5e3;function Dt({resort:t,time:e,label:n}){const i=Ln[t],[r,o]=w(null);I(()=>{setTimeout(()=>o(c=>c||!1),$n)},[]);const l=Q(()=>o(!0),[]);return s("table",{className:"mt-4 mx-auto text-gray-500"},s(qe,{heading:n,time:s("time",null,e||"--:--:--")}),s(qe,{heading:s("a",{href:`https://time.is/${i.split("_")[0]}`,id:"time_is_link",target:"_blank",rel:"noreferrer"},"Current time"),time:s(x,null,s(Pn,{id:i,onSync:l}),r===!1?s("span",{className:"text-sm font-sans font-semibold text-red-600"}," ","(unsynced)"):null)}))}function qe({heading:t,time:e}){return s("tr",null,s("th",{scope:"row",className:"pr-3 text-right text-xs font-semibold uppercase"},t,":"),s("td",{className:"text-xl font-mono leading-tight"},"\uFEFF",e))}function On({startTime:t,onRefresh:e}){return s(x,null,t&&s(Dt,{resort:"WDW",time:t,label:"Booking start"}),s("h3",{className:"mt-4"},"Not Available Yet"),t?s("p",null,"At"," ",s("time",{dateTime:t,className:"font-semibold"},U(t)),", tap the ",s("span",{className:"font-semibold"},"Check Availability")," ","button below to start booking this Lightning Lane."):s("p",null,"Sorry, but you can't make a Lightning Lane reservation for this attraction yet."),s(Ct,{buttonText:"Check Availability",onSubmit:e}))}function Gn({onClose:t}){const{ineligible:e}=Te(),{eligibleAfter:n}=e[0]||{},i=K();return s(x,null,n&&s("div",{className:"mt-4 border-2 border-green-600 rounded p-1 uppercase font-semibold text-center text-green-600 bg-green-100"},"Eligible at ",U(n)),i.current?s(x,null,s("h3",null,"Unable to Rebook"),s("p",null,"Your current reservation cannot be rebooked to this experience due to the following conflicts:")):s(x,null,s("h3",null,"No Eligible Guests"),s("p",null,"No one in your party is currently eligible for this Lightning Lane.")),s(St,null),s(G,{onClick:t},"Back"))}function Bn({onRefresh:t}){return s(x,null,s("h3",null,"No Guests Found"),s("p",null,"Your party could not be loaded. This is probably just a temporary network error. Wait a few seconds and try again."),s(G,{onClick:t},"Try Again"))}function Mn({onClose:t}){return s(x,null,s("h3",null,"No Reservations Available"),s("p",null,"Tap the refresh button above to try again or go back to the tip board and select another attraction."),s(G,{onClick:t},"Back"))}function At({booking:t,button:e}){return s("div",{className:"flex items-center gap-x-2"},s("div",{className:"flex-1 min-w-0"},s("div",{className:"text-gray-500 text-sm font-semibold uppercase"},t.start.time?s("time",null,U(t.start.time)):"open"," - ",t.end.time?s("time",null,U(t.end.time)):"close"),s("div",{className:"text-lg font-semibold leading-tight truncate"},t.experience.name)),e&&s("div",null,e))}function Pt(){const t=K(),e=H();return t.current?s("div",{className:`sticky top-0 -mx-3 pb-1 ${e.bg}`},s("div",{className:"pb-3 bg-white"},s("div",{className:`py-1.5 ${e.bg} text-white text-sm font-semibold uppercase text-center`},"Rebooking"),s("div",{className:"mt-2 px-3"},s(At,{booking:t.current,button:s(L,{type:"small",onClick:()=>t.end(!0)},"Keep")})))):null}function Un({experience:t,park:e,onClose:n}){var C;const i=de(),r=K(),[o,l]=w(),[c,d]=w(t.flex.available),[u,a]=w(c?void 0:null),[m,h]=w(),{loadData:f,loaderElem:p,isLoading:R}=Ee();async function v(){if(!u||!o)return;let _=null;await f(async()=>{const g=new Set(o.selected.map(N=>N.id));r.current&&await i.cancelBooking(r.current.guests.filter(N=>g.has(N.id)));try{_=await i.book(u)}finally{r.end()}const T=_.guests.filter(N=>!g.has(N.id));T.length>0&&(await i.cancelBooking(T),_.guests=_.guests.filter(N=>g.has(N.id)))},{410:"Offer expired"}),_&&h(_)}function b(){f(async _=>{const T=(await i.plusExperiences(e)).find(N=>N.id===t.id);T!=null&&T.flex.available?(d(!0),a(void 0)):_("Reservations not open yet")})}function k(){u&&i.cancelOffer(u),n()}function D(){!o||o.eligible.length===0||f(async()=>{const _=await i.offer({experience:t,park:e,guests:o.eligible});a(g=>(g&&i.cancelOffer(g),_))},{410:"No reservations available"})}const S=Q(()=>{f(async()=>{try{let _=await i.guests({experience:t,park:e});const g=r.current;if(g){const T=new Set(g.guests.map(W=>W.id)),N=[..._.eligible,..._.ineligible].filter(W=>T.has(W.id)&&!(W.ineligibleReason==="TOO_EARLY"||W.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"&&t.id===g.experience.id));_=N.length>0?{eligible:[],ineligible:N}:{eligible:g.guests,ineligible:[]}}l(P(E({},_),{selected:_.eligible,setSelected:T=>l(N=>{if(!N)return N;const W=new Set(N.selected);return T.some(Y=>!W.has(Y))&&a(Y=>{if(!Y)return Y;i.cancelOffer(Y)}),P(E({},N),{selected:T})})}))}catch(_){throw l({eligible:[],ineligible:[],selected:[],setSelected:()=>null}),_}})},[i,t,e,r,f]);return I(S,[S]),I(()=>{u!==void 0||!o||o.eligible.length===0||f(async()=>{try{a(await i.offer({experience:t,park:e,guests:[...o.selected]}))}catch(_){throw a(null),_}},{410:""})},[i,t,e,o,u,f]),m?s(Tt,{booking:m,onClose:n,isNew:!0}):s(B,{heading:"Lightning Lane",theme:e.theme,buttons:s(x,null,(!c||u!==null)&&s(L,{onClick:k},"Cancel"),c&&u!==void 0&&s(L,{onClick:D,title:"Refresh Offer"},s(Ne,null)))},s(Pt,null),s("h2",null,t.name),s("div",null,e.name),s(Cn,{value:o||{eligible:[],ineligible:[],selected:[],setSelected:()=>null}},((C=o==null?void 0:o.eligible)==null?void 0:C.length)===0?R?s("div",null):o.ineligible.length===0?s(Bn,{onRefresh:S}):s(Gn,{onClose:n}):!o||u===void 0?s("div",null):c?u===null?s(Mn,{onClose:n}):s(Rn,{offer:u,onBook:v}):s(On,{startTime:t.flex.enrollmentStartTime,onRefresh:b})),p)}function Fn({onClose:t}){const e=de(),[n,i]=w(),[r,o]=w(),[l,c]=w(!1);function d(a){!r||(i(m=>{if(!!m)return a.length>0?r.guests=a:m.splice(m.indexOf(r),1),m}),o(void 0))}I(()=>{c(!0),e.bookings().then(a=>i(a))},[e]);function u(){c(!1),setTimeout(t,300)}return r?s(Tt,{booking:r,onClose:d,isRebookable:e.isRebookable(r)}):s(x,null,s(we,{onClick:u,"data-testid":"panel-shade",className:"bg-black bg-opacity-75"}),s(B,{heading:"Your Lightning Lanes",buttons:s(L,{onClick:u},"Close"),className:`top-auto max-h-[50%] ${l?"h-[275px]":"h-0"} duration-200 ease-linear`},n&&n.length>0?s("ul",null,(n||[]).map(a=>{var m;return s("li",{className:"py-3 first:border-0 border-t-4 border-gray-300",key:(m=a.guests[0])==null?void 0:m.entitlementId},s(At,{booking:a,button:s(L,{type:"small",onClick:()=>o(a)},"More")}))})):s("div",{className:"mt-4 text-sm font-semibold text-center uppercase  text-gray-500"},n&&"No current reservations")))}function Ce({label:t,children:e}){return s("div",{className:"flex items-center flex-1 whitespace-nowrap"},s("span",{className:"mr-2 text-xs font-semibold uppercase text-gray-500"},t)," ",e)}function Hn({experience:t,onClick:e}){const{flex:n}=t;return s(Ce,{label:"Genie+"},n.nextAvailableTime?s("span",null,s(L,{onClick:()=>e(t)},U(n.nextAvailableTime))):s("span",{className:"inline-block border-2 border-gray-500 rounded px-1.5 py-0.5 font-semibold text-gray-500 bg-gray-100"},"none"))}function Wn({experience:{type:t,standby:e}}){return e.displayNextShowTime||t==="ENTERTAINMENT"&&!e.waitTime?s(Qn,{standby:e}):s(jn,{standby:e})}const jn=({standby:t})=>s(Ce,{label:"Standby"},t.available?s($t,{time:t.waitTime!==void 0?t.waitTime+" min":"now"}):s(Ot,{text:"down"})),Qn=({standby:t})=>s(Ce,{label:s(x,null,"Next ",s("span",{className:"hidden xs:inline"},"Show"))},t.displayNextShowTime?s($t,{time:t.displayNextShowTime}):s(Ot,{text:"none"})),Lt="inline-block border-2 rounded px-1.5 py-0.5 font-semibold",$t=({time:t})=>s("span",{className:`${Lt} border-gray-500 text-gray-500 bg-gray-100`},t),Ot=({text:t})=>s("span",{className:`${Lt} border-red-600 text-red-600 bg-red-100`},t);function ze({label:t,time:e}){const n=H();return s("div",{className:`-mx-3 px-3 pb-1 ${n.bg} text-white text-sm font-semibold uppercase text-center`},t,": ",s("time",null,U(e)))}const Yn=6e4,Ke="bg1.genie.tipBoard.park",Jn=(t,e)=>(t.priority||1/0)-(e.priority||1/0),me=(t,e)=>(e.standby.waitTime||-1)-(t.standby.waitTime||-1),fe=(t,e)=>(t.flex.nextAvailableTime||"").localeCompare(e.flex.nextAvailableTime||""),qn=(t,e)=>t.name.toLowerCase().localeCompare(e.name.toLowerCase()),zn={priority:(t,e)=>Jn(t,e)||me(t,e)||fe(t,e),standby:(t,e)=>me(t,e)||fe(t,e),soonest:(t,e)=>fe(t,e)||me(t,e),aToZ:()=>0};function Kn(){const t=de(),{parks:e}=t,[n,i]=w(()=>{const{id:_=e[0].id,date:g=""}=JSON.parse(sessionStorage.getItem(Ke)||"{}")||{};return g===$().date&&e.find(T=>T.id===_)||e[0]}),[r,o]=w([]),[l,c]=w(),[d,u]=w(!1),[a,m]=w("priority"),{loadData:h,loaderElem:f,isLoading:p}=Ee(),[,R]=w(0),[v,b]=w(()=>({current:null,begin:_=>{b(P(E({},v),{current:_})),i(_.park),u(!1)},end:(_=!1)=>{b(g=>g.current?P(E({},g),{current:null}):g),_&&c(void 0)}})),k=ve(null),D=r.length>0&&!r[0].flex.available?r[0].flex.enrollmentStartTime:void 0,S=r.length>0?t.pdt(n):void 0,C=Q((_=!0)=>{R(g=>!_&&Date.now()-g<Yn?g:(h(async()=>o(await t.plusExperiences(n))),Date.now()))},[t,n,h]);return I(()=>{o([]),C()},[C]),I(()=>{if(p||l||d)return;const _=()=>{document.hidden||C(!1)};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},[l,C,p,d]),I(()=>{var _;(_=k.current)==null||_.scroll(0,0)},[n,a,v]),I(()=>{sessionStorage.setItem(Ke,JSON.stringify({id:n.id,date:$().date}))},[n]),s(wn,{value:v},s(B,{heading:s(x,null,"G",s("span",{className:"hidden xs:inline"},"enie"),"+"),theme:n.theme,buttons:s(x,null,s(L,{onClick:()=>u(!0),title:"Your Lightning Lanes"},s(Sn,null)),s(Ye,{value:n.id,onChange:_=>{i(e.find(g=>g.id===_.currentTarget.value))},title:"Park"},e.map(_=>s("option",{value:_.id,title:_.name,key:_.id},_.abbr))),s(Ye,{value:a,onChange:_=>m(_.currentTarget.value),title:"Sort By"},s("option",{value:"priority"},"Priority"),s("option",{value:"standby"},"Standby"),s("option",{value:"soonest"},"Soonest"),s("option",{value:"aToZ"},"A to Z")),s(L,{onClick:C,title:"Refresh Tip Board"},s(Ne,null))),containerRef:k},s("div",{"aria-hidden":!!(l||d)},s(Pt,null),D?s(ze,{label:"Booking start",time:D}):S?s(ze,{label:"Next drop",time:S}):null,s("ul",null,r.sort((_,g)=>+g.flex.available-+_.flex.available||zn[a](_,g)||qn(_,g)).map(_=>s("li",{className:"pb-3 first:border-0 border-t-4 border-gray-300",key:_.id},s("h2",{className:"text-lg leading-tight truncate"},_.name),_.flex.preexistingPlan?s("div",{className:"mt-2 border-2 border-green-600 rounded p-1 text-sm uppercase font-semibold text-center text-green-600 bg-green-100"},"Lightning Lane Booked"):null,s("div",{className:"flex flex-wrap gap-1.5 mt-2"},s(Wn,{experience:_}),s(Hn,{experience:_,onClick:c}))))),f)),d&&s(Fn,{onClose:()=>u(!1)}),l&&s(Un,{experience:l,park:n,onClose:()=>{C(!1),c(void 0)}}))}const Vn={success:5e3,failure:1e3};function Xn({guests:t,result:e,onDone:n}){const{boardingGroup:i,conflicts:r}=e,o=t.filter(u=>!(u.id in r)),l=t.filter(u=>u.id in r),[c,d]=w(!0);return I(()=>{setTimeout(()=>d(!1),Vn[i?"success":"failure"])},[i]),s(x,null,i?s(x,null,s("h2",{className:"mt-5 text-xl"},"Boarding Group: ",i),s(O,{guests:o}),Object.keys(r).length>0?s(x,null,s("p",{className:"font-semibold"},"These guests could not join:"),s(O,{guests:l,conflicts:r})):null,s("p",null,"Refer to the My Disney Experience app for return time and other information.")):s(x,null,s("h2",{className:"mt-5 text-xl"},"Sorry!"),s("p",null,"A boarding group could not be obtained."),s(O,{guests:l,conflicts:r})),c?null:s(G,{onClick:n},"Done"))}function Zn({guests:t,party:e,onToggle:n,onConfirm:i}){return s(x,null,s("h2",{className:"mt-5 text-xl"},"Choose Your Party"),t?t.length>0?s(O,{guests:t,selectable:{isSelected:r=>e.has(r),onToggle:n}}):s("p",null,"No guests available"):s("p",null,"Loading guests\u2026"),s(G,{disabled:e.size===0,onClick:i},"Confirm Party"))}function es({queue:t}){return s(x,null,t.howToEnterMessage.split(`

`).map((e,n)=>s("p",{key:n},e)))}const ts=999;function ns({guests:t,joinQueue:e,onEdit:n}){const[i,r]=w(!1),[o,l]=ke(),{bg:c}=H();async function d(){r(!0),l("");const u=Nt(ts);try{await e()||l("Queue not open yet")}catch(a){l("Error: try again","error"),a instanceof te||console.error(a)}finally{await u,r(!1)}}return s(x,null,s("div",{className:"mt-4"},s("h2",{className:"inline text-xl"},"Your Party"),s("span",null,s("button",{onClick:n,className:`ml-3 px-2 py-1.5 rounded-lg ${c} text-white text-xs uppercase font-semibold tracking-wide align-middle`},"Edit"))),s(O,{guests:t}),s(G,{disabled:i,onClick:d},"Join Boarding Group"),o)}function ss({queue:t,queues:e,onChange:n}){e||(e=[]);const{bg:i}=H(),r=`block w-full ${i} text-white text-xl font-semibold`;return s(x,null,e.length<=1?s("span",{className:`${r} px-1 truncate`},t.name):s("select",{className:`${r} pr-1`,onChange:o=>n?n(o.currentTarget.value):null},e.map(o=>s("option",{selected:o===t,key:o.id,value:o.id,className:"text-base font-normal"},o.name))))}function is(){const t=bn(),[e,n]=w(),[i,r]=w(null),[o,l]=w(),[c,d]=w(new Set),[u,a]=w({boardingGroup:null,conflicts:{},closed:!0}),[m,h]=w("ChooseParty"),[f,p]=ke(),R=ve(null);I(()=>{(async()=>{const g=await t.getQueues();n(g),r(g[0])})()},[t]),I(()=>{if(!i)return;let g=!1;return(async()=>{const T=await t.getLinkedGuests(i);g||(l(T),d(new Set(T.filter(N=>N.isPreselected))))})(),()=>{g=!0}},[t,i]),I(()=>{var g;(g=R.current)==null||g.scroll(0,0)},[m]);function v(g){const T=new Set(c);T[T.has(g)?"delete":"add"](g);const N=Number(i==null?void 0:i.maxPartySize);N>0&&T.size>N?p(`Max party size: ${N}`,"error"):(d(T),p(""))}function b(g){const T=e==null?void 0:e.find(N=>N.id===g);T&&r(T)}async function k(){return!i||!(await t.getQueue(i)).isAcceptingJoins?!1:(a(await t.joinQueue(i,[...c])),h("BGResult"),!0)}if((e==null?void 0:e.length)===0)return s(B,{heading:"No Virtual Queues"},s("p",null,"The virtual queue system is not currently in use for any attractions."));if(!i)return s("div",null);const D=(o||[]).filter(g=>c.has(g)),S=s(Dt,{resort:t.resort,time:i.nextScheduledOpenTime,label:"Next queue opening"}),C=s(ss,{queue:i,queues:m==="ChooseParty"?e:[],onChange:b});return{ChooseParty:s(B,{heading:C,containerRef:R},s(es,{queue:i}),S,s(Zn,{guests:o,party:c,onToggle:v,onConfirm:()=>h("JoinQueue")}),f),JoinQueue:s(B,{heading:C},S,s(ns,{guests:D,onEdit:()=>h("ChooseParty"),joinQueue:k})),BGResult:s(B,{heading:C},s(Xn,{guests:D,result:u,onDone:()=>h("ChooseParty")}))}[m]}const Gt=new Jt("bg1.auth"),Ve=()=>Gt.getData();tn(origin)?Xe(new sn({origin,getAuthData:Ve}),is):Zt(origin)?be.load({origin,getAuthData:Ve}).then(t=>Xe(t,Kn)):location.href="https://joelface.github.io/bg1/start.html";async function Xe(t,e){document.head.innerHTML+=`
    <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>BG1</title>
  `,Yt({WDW:"America/New_York",DLR:"America/Los_Angeles"}[t.resort]),Qt(s(vn,{resort:t.resort,authStore:Gt},s(yn,{value:t},s(e,null))),document.body),os()}function os(){document.body.addEventListener("click",()=>null)}
