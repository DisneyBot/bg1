var Ot=Object.defineProperty,Gt=Object.defineProperties;var Bt=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var Ce=(t,e,n)=>e in t?Ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,T=(t,e)=>{for(var n in e||(e={}))Ie.call(e,n)&&Ce(t,n,e[n]);if(Z)for(var n of Z(e))Re.call(e,n)&&Ce(t,n,e[n]);return t},P=(t,e)=>Gt(t,Bt(e));var B=(t,e)=>{var n={};for(var i in t)Ie.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&Z)for(var i of Z(t))e.indexOf(i)<0&&Re.call(t,i)&&(n[i]=t[i]);return n};var ce,g,Ke,J,Ve,De,Xe,re={},Ze=[],Mt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function U(t,e){for(var n in e)t[n]=e[n];return t}function et(t){var e=t.parentNode;e&&e.removeChild(t)}function s(t,e,n){var i,r,o,l={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:l[o]=e[o];if(arguments.length>2&&(l.children=arguments.length>3?ce.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)l[o]===void 0&&(l[o]=t.defaultProps[o]);return te(t,l,i,r,null)}function te(t,e,n,i,r){var o={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r==null?++Ke:r};return r==null&&g.vnode!=null&&g.vnode(o),o}function w(t){return t.children}function ne(t,e){this.props=t,this.context=e}function W(t,e){if(e==null)return t.__?W(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?W(t):null}function tt(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return tt(t)}}function he(t){(!t.__d&&(t.__d=!0)&&J.push(t)&&!ae.__r++||De!==g.debounceRendering)&&((De=g.debounceRendering)||Ve)(ae)}function ae(){for(var t;ae.__r=J.length;)t=J.sort(function(e,n){return e.__v.__b-n.__v.__b}),J=[],t.some(function(e){var n,i,r,o,l,c;e.__d&&(l=(o=(n=e).__v).__e,(c=n.__P)&&(i=[],(r=U({},o)).__v=o.__v+1,ye(c,o,r,n.__n,c.ownerSVGElement!==void 0,o.__h!=null?[l]:null,i,l==null?W(o):l,o.__h),ot(i,o),o.__e!=l&&tt(o)))})}function nt(t,e,n,i,r,o,l,c,d,u){var a,m,h,f,_,R,b,y=i&&i.__k||Ze,k=y.length;for(n.__k=[],a=0;a<e.length;a++)if((f=n.__k[a]=(f=e[a])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?te(null,f,null,null,f):Array.isArray(f)?te(w,{children:f},null,null,null):f.__b>0?te(f.type,f.props,f.key,null,f.__v):f)!=null){if(f.__=n,f.__b=n.__b+1,(h=y[a])===null||h&&f.key==h.key&&f.type===h.type)y[a]=void 0;else for(m=0;m<k;m++){if((h=y[m])&&f.key==h.key&&f.type===h.type){y[m]=void 0;break}h=null}ye(t,f,h=h||re,r,o,l,c,d,u),_=f.__e,(m=f.ref)&&h.ref!=m&&(b||(b=[]),h.ref&&b.push(h.ref,null,f),b.push(m,f.__c||_,f)),_!=null?(R==null&&(R=_),typeof f.type=="function"&&f.__k===h.__k?f.__d=d=st(f,d,t):d=it(t,f,h,y,_,d),typeof n.type=="function"&&(n.__d=d)):d&&h.__e==d&&d.parentNode!=t&&(d=W(h))}for(n.__e=R,a=k;a--;)y[a]!=null&&(typeof n.type=="function"&&y[a].__e!=null&&y[a].__e==n.__d&&(n.__d=W(i,a+1)),at(y[a],y[a]));if(b)for(a=0;a<b.length;a++)rt(b[a],b[++a],b[++a])}function st(t,e,n){for(var i,r=t.__k,o=0;r&&o<r.length;o++)(i=r[o])&&(i.__=t,e=typeof i.type=="function"?st(i,e,n):it(n,i,i,r,i.__e,e));return e}function it(t,e,n,i,r,o){var l,c,d;if(e.__d!==void 0)l=e.__d,e.__d=void 0;else if(n==null||r!=o||r.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(r),l=null;else{for(c=o,d=0;(c=c.nextSibling)&&d<i.length;d+=2)if(c==r)break e;t.insertBefore(r,o),l=o}return l!==void 0?l:r.nextSibling}function Ut(t,e,n,i,r){var o;for(o in n)o==="children"||o==="key"||o in e||le(t,o,null,n[o],i);for(o in e)r&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||le(t,o,e[o],n[o],i)}function Ae(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||Mt.test(e)?n:n+"px"}function le(t,e,n,i,r){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||Ae(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||Ae(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?i||t.addEventListener(e,o?Le:Pe,o):t.removeEventListener(e,o?Le:Pe,o);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n==null?"":n;break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function Pe(t){this.l[t.type+!1](g.event?g.event(t):t)}function Le(t){this.l[t.type+!0](g.event?g.event(t):t)}function ye(t,e,n,i,r,o,l,c,d){var u,a,m,h,f,_,R,b,y,k,I,p=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(d=n.__h,c=e.__e=n.__e,e.__h=null,o=[c]),(u=g.__b)&&u(e);try{e:if(typeof p=="function"){if(b=e.props,y=(u=p.contextType)&&i[u.__c],k=u?y?y.props.value:u.__:i,n.__c?R=(a=e.__c=n.__c).__=a.__E:("prototype"in p&&p.prototype.render?e.__c=a=new p(b,k):(e.__c=a=new ne(b,k),a.constructor=p,a.render=Ht),y&&y.sub(a),a.props=b,a.state||(a.state={}),a.context=k,a.__n=i,m=a.__d=!0,a.__h=[]),a.__s==null&&(a.__s=a.state),p.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=U({},a.__s)),U(a.__s,p.getDerivedStateFromProps(b,a.__s))),h=a.props,f=a.state,m)p.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(p.getDerivedStateFromProps==null&&b!==h&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(b,k),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(b,a.__s,k)===!1||e.__v===n.__v){a.props=b,a.state=a.__s,e.__v!==n.__v&&(a.__d=!1),a.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(E){E&&(E.__=e)}),a.__h.length&&l.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(b,a.__s,k),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(h,f,_)})}a.context=k,a.props=b,a.state=a.__s,(u=g.__r)&&u(e),a.__d=!1,a.__v=e,a.__P=t,u=a.render(a.props,a.state,a.context),a.state=a.__s,a.getChildContext!=null&&(i=U(U({},i),a.getChildContext())),m||a.getSnapshotBeforeUpdate==null||(_=a.getSnapshotBeforeUpdate(h,f)),I=u!=null&&u.type===w&&u.key==null?u.props.children:u,nt(t,Array.isArray(I)?I:[I],e,n,i,r,o,l,c,d),a.base=e.__e,e.__h=null,a.__h.length&&l.push(a),R&&(a.__E=a.__=null),a.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Ft(n.__e,e,n,i,r,o,l,d);(u=g.diffed)&&u(e)}catch(E){e.__v=null,(d||o!=null)&&(e.__e=c,e.__h=!!d,o[o.indexOf(c)]=null),g.__e(E,e,n)}}function ot(t,e){g.__c&&g.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(i){i.call(n)})}catch(i){g.__e(i,n.__v)}})}function Ft(t,e,n,i,r,o,l,c){var d,u,a,m=n.props,h=e.props,f=e.type,_=0;if(f==="svg"&&(r=!0),o!=null){for(;_<o.length;_++)if((d=o[_])&&"setAttribute"in d==!!f&&(f?d.localName===f:d.nodeType===3)){t=d,o[_]=null;break}}if(t==null){if(f===null)return document.createTextNode(h);t=r?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,h.is&&h),o=null,c=!1}if(f===null)m===h||c&&t.data===h||(t.data=h);else{if(o=o&&ce.call(t.childNodes),u=(m=n.props||re).dangerouslySetInnerHTML,a=h.dangerouslySetInnerHTML,!c){if(o!=null)for(m={},_=0;_<t.attributes.length;_++)m[t.attributes[_].name]=t.attributes[_].value;(a||u)&&(a&&(u&&a.__html==u.__html||a.__html===t.innerHTML)||(t.innerHTML=a&&a.__html||""))}if(Ut(t,h,m,r,c),a)e.__k=[];else if(_=e.props.children,nt(t,Array.isArray(_)?_:[_],e,n,i,r&&f!=="foreignObject",o,l,o?o[0]:n.__k&&W(n,0),c),o!=null)for(_=o.length;_--;)o[_]!=null&&et(o[_]);c||("value"in h&&(_=h.value)!==void 0&&(_!==t.value||f==="progress"&&!_||f==="option"&&_!==m.value)&&le(t,"value",_,m.value,!1),"checked"in h&&(_=h.checked)!==void 0&&_!==t.checked&&le(t,"checked",_,m.checked,!1))}return t}function rt(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(i){g.__e(i,n)}}function at(t,e,n){var i,r;if(g.unmount&&g.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||rt(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){g.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&at(i[r],e,typeof t.type!="function");n||t.__e==null||et(t.__e),t.__e=t.__d=void 0}function Ht(t,e,n){return this.constructor(t,n)}function jt(t,e,n){var i,r,o;g.__&&g.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,o=[],ye(e,t=(!i&&n||e).__k=s(w,null,[t]),r||re,re,e.ownerSVGElement!==void 0,!i&&n?[n]:r?null:e.firstChild?ce.call(e.childNodes):null,o,!i&&n?n:r?r.__e:e.firstChild,i),ot(o,t)}function z(t,e){var n={__c:e="__cC"+Xe++,__:t,Consumer:function(i,r){return i.children(r)},Provider:function(i){var r,o;return this.getChildContext||(r=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(l){this.props.value!==l.value&&r.some(he)},this.sub=function(l){r.push(l);var c=l.componentWillUnmount;l.componentWillUnmount=function(){r.splice(r.indexOf(l),1),c&&c.call(l)}}),i.children}};return n.Provider.__=n.Consumer.contextType=n}ce=Ze.slice,g={__e:function(t,e,n,i){for(var r,o,l;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),l=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),l=r.__d),l)return r.__E=r}catch(c){t=c}throw t}},Ke=0,ne.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=U({},this.state),typeof t=="function"&&(t=t(U({},n),this.props)),t&&U(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),he(this))},ne.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),he(this))},ne.prototype.render=w,J=[],Ve=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ae.__r=0,Xe=0;let lt="America/New_York";function Wt(t){lt=t}function M(t){t=new Date(t||Date.now());const e={},n="2-digit";return Intl.DateTimeFormat("en-US",{timeZone:lt,hourCycle:"h23",year:"numeric",month:n,day:n,hour:n,minute:n,second:n}).formatToParts(t).forEach(i=>e[i.type]=i.value),{date:`${e.year}-${e.month}-${e.day}`,time:`${e.hour}:${e.minute}:${e.second}`}}function F(t){const e=t.split(":").map(Number),n=e[0]>=12?"PM":"AM";return e[0]=e[0]%12||12,e.map(i=>String(i).padStart(2,"0")).join(":").replace(/:00$/,"").replace(/^0/,"")+" "+n}class ct extends Error{constructor(e){super(`Auth data "${e}" missing or expired`),this.name="ReauthNeeded"}}class Qt{constructor(e,n=localStorage){this.storageKey=e,this.storage=n}getData(){const e=this.storage.getItem(this.storageKey);if(e){const{swid:n,accessToken:i,expires:r}=JSON.parse(e),o=M(new Date(r)),l=M();if(o.date>l.date||o.date===l.date&&o.time>l.time&&o.time>="17")return{swid:n,accessToken:i}}throw new ct(this.storageKey)}setData(e){this.storage.setItem(this.storageKey,JSON.stringify(e))}deleteData(){this.storage.removeItem(this.storageKey)}}const Yt="modulepreload",$e={},Jt="/bg1/",Oe=function(e,n){return!n||n.length===0?e():Promise.all(n.map(i=>{if(i=`${Jt}${i}`,i in $e)return;$e[i]=!0;const r=i.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${o}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":Yt,r||(l.as="script",l.crossOrigin=""),l.href=i,document.head.appendChild(l),r)return new Promise((c,d)=>{l.addEventListener("load",c),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())},qt=8e3;async function _e(t,e={}){const u=e,{params:n,data:i,timeout:r=qt}=u;e=B(u,["params","data","timeout"]),n&&(t+="?"+Object.entries(n).filter(([,a])=>a!=="").map(a=>a.map(encodeURIComponent).join("=")).join("&")),i&&(e.method||(e.method="POST"),e.headers=P(T({},e.headers||{}),{"Content-Type":"application/json"}),e.body=JSON.stringify(i));const l=new AbortController;e.signal=l.signal;const c=setTimeout(()=>l.abort(),r);let d;try{d=await fetch(t,e)}catch(a){return console.error(a),{status:0,data:null}}finally{clearTimeout(c)}return{status:d.status,data:(d.headers.get("Content-Type")||"").startsWith("application/json")?await d.json():{}}}function zt(t){switch(t){case"./data/dlr.ts":return Oe(()=>import("./dlr.js"),[]);case"./data/wdw.ts":return Oe(()=>import("./wdw.js"),[]);default:return new Promise(function(e,n){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t)))})}}const pe={"https://disneyworld.disney.go.com":"WDW","https://disneyland.disney.go.com":"DLR"},Kt={WDW:"wdw-itinerary-api",DLR:"dlr-itinerary-web-api"};function Vt(t){return t in pe}class ut extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}const ee=t=>t.split(";")[0];class be{constructor(e){this.guestNames=new Map,this._primaryGuestId="",this.origin=e.origin,this.getAuthData=e.getAuthData,this.data=e.data,this.bookingStack=new Xt}static async load(e){const n=(await zt(`./data/${pe[e.origin].toLocaleLowerCase()}.ts`)).default;return new be(P(T({},e),{data:n}))}get resort(){return pe[this.origin]}get parks(){return this.data.parks}async plusExperiences(e){return(await this.request({path:`/tipboard-vas/api/v1/parks/${encodeURIComponent(e.id)}/experiences`,key:"availableExperiences"})).map(i=>T(T({},i),this.data.experiences[i.id])).filter(i=>!!(i.name&&i.flex))}async guests(e){const n=await this.request({path:"/ea-vas/api/v1/guests",params:{productType:"FLEX",experienceId:e.experience.id,parkId:e.park.id}});this._primaryGuestId=n.primaryGuestId;const i=u=>{var a=u,{firstName:l,lastName:c}=a,d=B(a,["firstName","lastName"]);return P(T({},d),{name:`${l} ${c}`.trim()})},r=n.ineligibleGuests.map(i),o=n.guests.map(i).filter(l=>"ineligibleReason"in l?(r.push(l),!1):!0);return[...o,...r].forEach(l=>{this.guestNames.has(l.id)||this.guestNames.set(l.id,l.name)}),o.sort((l,c)=>l.name.localeCompare(c.name)),r.sort((l,c)=>{const d=l.name.localeCompare(c.name);return l.eligibleAfter||c.eligibleAfter?(l.eligibleAfter||"99").localeCompare(c.eligibleAfter||"99")||d:l.ineligibleReason===c.ineligibleReason?d:l.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?-1:c.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?1:d}),{eligible:o,ineligible:r}}async primaryGuestId(e){return this._primaryGuestId||await this.guests(e),this._primaryGuestId}async offer({experience:e,park:n,guests:i}){const{id:r,date:o,startTime:l,endTime:c,changeStatus:d}=await this.request({path:"/ea-vas/api/v1/products/flex/offers",method:"POST",data:{productType:"FLEX",guestIds:i.map(u=>u.id),primaryGuestId:await this.primaryGuestId({experience:e,park:n}),parkId:n.id,experienceId:e.id,selectedTime:e.flex.nextAvailableTime},key:"offer"});return{id:r,start:{date:o,time:l},end:{date:o,time:c},changeStatus:d}}async cancelOffer(e){await this.request({path:`/ea-vas/api/v1/offers/${encodeURIComponent(e.id)}`,method:"DELETE",params:{productType:"FLEX"},userId:!1})}async book(e){const{singleExperienceDetails:{experienceId:n,parkId:i},entitlements:r,startDateTime:o,endDateTime:l}=await this.request({path:"/ea-vas/api/v1/products/flex/bookings",method:"POST",userId:!1,data:{offerId:e.id},key:"booking"});return this.bookings(),{experience:{id:n,name:this.data.experiences[n].name},park:this.data.parks.find(c=>c.id===i),start:M(o),end:M(l),cancellable:!0,guests:r.map(c=>({id:c.guestId,name:this.guestNames.get(c.guestId)||"",entitlementId:c.id}))}}async cancelBooking(e){const i=e.map(r=>r.entitlementId).map(encodeURIComponent).join(",");await this.request({path:`/ea-vas/api/v1/entitlements/${i}`,method:"DELETE",userId:!1})}async bookings(){const{swid:e}=this.getAuthData(),n=new Date(Date.now()),i=Kt[this.resort],{items:r=[],assets:o={},profiles:l={}}=await this.request({path:`/plan/${i}/api/v1/itinerary-items/${e}`,params:{destination:this.resort,fields:"items,profiles,assets","item-types":"FASTPASS","guest-locators":e+";type=swid","guest-locator-groups":"MY_FAMILY","start-date":M(n).date,"end-date":M(new Date(n.getTime()).setDate(n.getDate()+1)).date,"show-friends":"false"},userId:!1}),c=Object.fromEntries(this.parks.map(m=>[m.id,m])),d=M(new Date(n.getTime()).setMinutes(n.getMinutes()-15)),u=new Set(["FLEX","OTHER"]),a=r.filter(m=>m.type==="FASTPASS"&&u.has(m.kind)).filter(m=>(!m.displayEndDate||m.displayEndDate>=d.date)&&(!m.displayEndTime||m.displayEndTime>=d.time)).map(m=>{const h=ee(m.facility),f=o[m.facility],{name:_}=this.data.experiences[h]||f,R=ee(f.location),b={experience:{id:h,name:_},park:c[R],start:{date:m.displayStartDate,time:m.displayStartTime},end:{date:m.displayEndDate,time:m.displayEndTime},cancellable:m.cancellable,guests:m.guests.map(y=>{const{name:k}=l[y.id];return T({id:ee(y.id),entitlementId:y.entitlementId,name:`${k.firstName} ${k.lastName}`.trim()},y.redemptionsRemaining!==void 0&&{redemptions:y.redemptionsRemaining})})};return m.multipleExperiences&&(b.experience={id:"",name:"Multiple Experiences"},b.choices=m.assets.filter(y=>!y.excluded&&!y.original).map(({content:y})=>{const k=ee(y),{name:I}=this.data.experiences[k]||o[y];return{id:k,name:I}}).sort((y,k)=>y.name.localeCompare(k.name))),b}).sort((m,h)=>((m.start.date||"0000-00-00")+(m.start.time||"")).localeCompare((h.start.date||"0000-00-00")+(h.start.time||"")));return this.bookingStack.update(a),a}isRebookable(e){return this.bookingStack.isRebookable(e)}async request(e){var u;const{swid:n,accessToken:i}=this.getAuthData(),r=this.origin+e.path,o=T({},e.params);((u=e.userId)==null||u)&&(o.userId=n);const{status:l,data:c}=await _e(r,{method:e.method||"GET",params:o,data:e.data,headers:{Authorization:`BEARER ${i}`,"User-Agent":"Mozilla/5.0"},credentials:"omit"}),{key:d}=e;if(String(l)[0]==="2"&&(!d||c[d]))return d?c[d]:c;throw new ut({status:l,data:c})}}const Ge="bg1.genie.bookings";class Xt{constructor(e=!0){if(this.entitlementIds=[],this.mostRecent=new Map,!e)return;const{entitlementIds:n=[],mostRecent:i={}}=JSON.parse(localStorage.getItem(Ge)||"{}");this.entitlementIds=n,this.mostRecent=new Map(Object.entries(i))}isRebookable(e){return e.guests.every(n=>this.mostRecent.get(n.id)===n.entitlementId)}update(e){const n=new Map,i=new Set(this.entitlementIds);this.entitlementIds=e.filter(({cancellable:r})=>r).map(r=>r.guests.map(({id:o,entitlementId:l})=>(this.entitlementIds.push(l),i.has(l)||n.set(o,n.has(o)?"":l),l))).flat(1),this.mostRecent=new Map([...this.mostRecent,...n]),n.size>0&&localStorage.setItem(Ge,JSON.stringify({entitlementIds:this.entitlementIds,mostRecent:Object.fromEntries(this.mostRecent)}))}}const dt={"https://vqguest-svc-wdw.wdprapps.disney.com":"WDW","https://vqguest-svc.wdprapps.disney.com":"DLR"};function Zt(t){return t in dt}function en(t){return t.sort((e,n)=>e.isPrimaryGuest!==n.isPrimaryGuest?Number(n.isPrimaryGuest)-Number(e.isPrimaryGuest):e.isPreselected!==n.isPreselected?Number(n.isPreselected)-Number(e.isPreselected):e.name.localeCompare(n.name))}class se extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}class tn{constructor(e){this.origin=e.origin,this.getAuthData=e.getAuthData}get resort(){return dt[this.origin]}url(e){return`${this.origin}/application/v1/guest/${e}`}async getQueues(){return(await _e(this.url("getQueues"))).data.queues.map(i=>{var r=i,{queueId:e}=r,n=B(r,["queueId"]);return P(T({},n),{id:e})}).sort((e,n)=>e.categoryContentId===n.categoryContentId?e.name.localeCompare(n.name):e.categoryContentId==="attraction"?-1:1)}async getQueue(e){const n=(await this.getQueues()).find(i=>i.id===e.id);if(n)return n;throw new Error("Queue not Found")}async getLinkedGuests(e){const{data:n}=await this.post({resource:"getLinkedGuests",data:{queueId:e.id}});return en(n.guests.map(c=>{var d=c,{guestId:i,firstName:r,lastName:o}=d,l=B(d,["guestId","firstName","lastName"]);return P(T({},l),{id:i,name:`${r} ${o}`.trim()})}))}async joinQueue(e,n){const i=n.map(l=>l.id),{status:r,data:o}=await this.post({resource:"joinQueue",data:{queueId:e.id,guestIds:i}});if(o.responseStatus==="OK"){const l=o.positions.find(c=>c.queueId===e.id&&c.guestIds.length>0&&i.some(d=>c.guestIds.includes(d)));if(!l)throw new se({status:r,data:o});return{boardingGroup:l.boardingGroup,conflicts:{},closed:!1}}else if(o.responseStatus==="INVALID_GUEST"||o.responseStatus==="CLOSED_QUEUE"){const l=o.responseStatus==="CLOSED_QUEUE",c=new Set,d={};for(const m of o.conflicts)for(const h of m.guestIds){const f=n.find(_=>_.id===h);!f||(d[f.id]=m.conflictType,c.add(h))}const u=n.filter(m=>!c.has(m.id));if(l||u.length===0)return{boardingGroup:null,conflicts:d,closed:l};const a=await this.joinQueue(e,u);return a.conflicts=T(T({},d),a.conflicts),a}else throw new se({status:r,data:o})}async post(e){const{status:n,data:i}=await _e(this.url(e.resource),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`BEARER ${this.getAuthData().accessToken}`},body:JSON.stringify(e.data)});if(!n||n>=500)throw new se({status:n,data:i});return{status:n,data:i}}}var K,A,Be,q=0,mt=[],Me=g.__b,Ue=g.__r,Fe=g.diffed,He=g.__c,je=g.unmount;function ue(t,e){g.__h&&g.__h(A,t,q||e),q=0;var n=A.__H||(A.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function v(t){return q=1,nn(_t,t)}function nn(t,e,n){var i=ue(K++,2);return i.t=t,i.__c||(i.__=[n?n(e):_t(void 0,e),function(r){var o=i.t(i.__[0],r);i.__[0]!==o&&(i.__=[o,i.__[1]],i.__c.setState({}))}],i.__c=A),i.__}function D(t,e){var n=ue(K++,3);!g.__s&&ht(n.__H,e)&&(n.__=t,n.__H=e,A.__H.__h.push(n))}function ve(t){return q=5,ft(function(){return{current:t}},[])}function ft(t,e){var n=ue(K++,7);return ht(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Q(t,e){return q=8,ft(function(){return t},e)}function V(t){var e=A.context[t.__c],n=ue(K++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(A)),e.props.value):t.__}function sn(){for(var t;t=mt.shift();)if(t.__P)try{t.__H.__h.forEach(ie),t.__H.__h.forEach(ge),t.__H.__h=[]}catch(e){t.__H.__h=[],g.__e(e,t.__v)}}g.__b=function(t){A=null,Me&&Me(t)},g.__r=function(t){Ue&&Ue(t),K=0;var e=(A=t.__c).__H;e&&(e.__h.forEach(ie),e.__h.forEach(ge),e.__h=[])},g.diffed=function(t){Fe&&Fe(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(mt.push(e)!==1&&Be===g.requestAnimationFrame||((Be=g.requestAnimationFrame)||function(n){var i,r=function(){clearTimeout(o),We&&cancelAnimationFrame(i),setTimeout(n)},o=setTimeout(r,100);We&&(i=requestAnimationFrame(r))})(sn)),A=null},g.__c=function(t,e){e.some(function(n){try{n.__h.forEach(ie),n.__h=n.__h.filter(function(i){return!i.__||ge(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],g.__e(i,n.__v)}}),He&&He(t,e)},g.unmount=function(t){je&&je(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{ie(i)}catch(r){e=r}}),e&&g.__e(e,n.__v))};var We=typeof requestAnimationFrame=="function";function ie(t){var e=A,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),A=e}function ge(t){var e=A;t.__c=t.__(),A=e}function ht(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function _t(t,e){return typeof e=="function"?e(t):e}const pt={bg:"bg-blue-500"},gt=z(pt),on=gt.Provider,j=()=>V(gt),rn={normal:"py-1",small:"py-1.5 text-xs uppercase tracking-wide",full:"w-full py-3"};function L(t){const l=t,{type:e,className:n}=l,i=B(l,["type","className"]),r=(n||"")+" "+rn[e||"normal"],{bg:o}=j();return s("button",T({className:`${r} border-2 border-white rounded-lg px-2 ${o} text-white font-semibold disabled:opacity-50`},i))}function O({onClick:t,disabled:e,href:n,children:i}){return s("div",{className:"mb-20"},s("div",{className:"fixed bottom-0 left-0 w-full bg-white bg-opacity-75 text-center"},s("a",{href:n,className:"block max-w-2xl mx-auto px-3 pb-5"},s(L,{type:"full",onClick:t,disabled:e},i))))}function an({title:t,children:e}){const{bg:n}=j();return s("div",{className:`flex flex-nowrap justify-end gap-x-2 gap-y-1 min-h-[52px] px-3 py-2 font-semibold text-white ${n}`},s("h1",{className:"flex-1 self-center py-0.5 text-xl overflow-hidden whitespace-nowrap"},t),e)}function we(t){const o=t,{children:e,className:n}=o,i=B(o,["children","className"]),r=T({outer:"",inner:""},typeof n=="string"?{inner:n}:n);return s("div",T({className:`${r.outer} fixed inset-0`},i),s("div",{className:`${r.inner} max-w-2xl min-h-full mx-auto`},e))}function G(c){var d=c,{heading:t,buttons:e,className:n,theme:i,containerRef:r,children:o}=d,l=B(d,["heading","buttons","className","theme","containerRef","children"]);return s(on,{value:i||pt},s(we,T({className:{outer:`bg-white ${n||""}`,inner:"flex flex-col max-w-2xl h-full"}},l),s(an,{title:t},e),s("div",{ref:r,className:"flex-1 overflow-auto px-3 pb-3"},o)))}const ln="bg1.disclaimer.accepted",cn={bg:"bg-red-600"};function un(){const t=localStorage,e=ln,[n,i]=v(!!t.getItem(e));return D(()=>{n&&t.setItem(e,"1")},[n,t,e]),n?null:s(dn,{onAccept:()=>i(!0)})}function dn({onAccept:t}){return s(G,{heading:"Warning!",theme:cn},s("p",null,'Use at your own risk. BG1 is highly experimental, for demonstration purposes only, and provided "as is" without warranty of any kind. It is in no way endorsed by or associated with the Walt Disney Company and could stop working at any time for any reason. To ensure the intended experience, always use the official Disney app.'),s(O,{onClick:t},"Accept"))}const mn="17e2767256f";function fn(t){return"deferredUuid"in t&&t.deferredUuid!==void 0}class hn{constructor(e,n,i,r=!1){this.iframe=e,this.resort=i,this.logging=r,this.handlers={},this.handshakeAcked=!1,this.onMessage=o=>{if(o.source!==this.iframe.contentWindow||o.data==="inner.loaded")return;const l=JSON.parse(o.data);this.logging&&console.log("Message:",l);const c=l.type==="message"?l.eventName:l.type,d=this.handlers[c],u=d?d("data"in l?l.data:null):void 0;fn(l)&&this.send({type:"deferred",action:"resolve",deferredUuid:l.deferredUuid,data:u!=null?u:{}})},this.on("handshake",()=>{this.handshakeAcked||(this.handshakeAcked=!0,this.send({type:"handshakeAck"}),this.logging&&this.sendMessage("setLogLevel",{level:"log"}),this.sendMessage("workflow.execute",{name:"login"}))}),this.on("lightbox.hide",()=>this.open()),this.on("session.dateOfBirth.read",()=>this.open()),this.on("session.loggedin",({token:o})=>{n({swid:o.swid,accessToken:o.access_token,expires:new Date(o.exp)})})}open(){addEventListener("message",this.onMessage),this.iframe.src=this.authPageUrl,this.handshakeAcked=!1}close(){removeEventListener("message",this.onMessage)}on(e,n){this.handlers[e]=n}sendMessage(e,n){this.send({type:"message",eventName:e,data:n})}send(e){var n;(n=this.iframe.contentWindow)==null||n.postMessage(JSON.stringify(P(T({},e),{name:"lightbox-client-window"})),this.authPageUrl)}get authPageUrl(){return`https://cdn.registerdisney.go.com/v2/TPR-${this.resort}-LBSDK.IOS-PROD/en-US?include=l10n,config,html,js&buildId=${mn}`}}function _n({resort:t,onLogin:e}){const n=ve(null);return D(()=>{if(!n.current)return;const i=new hn(n.current,e,t);return i.open(),()=>i.close()},[t,e,n]),s("iframe",{title:"Disney Login Form",ref:n,className:"fixed top-0 left-0 w-full h-full border-0"})}function pn({resort:t,authStore:e,children:n}){const[i,r]=v("Blank"),o=un();return D(()=>{function c(){if(!document.hidden)try{e.getData(),r("Client")}catch(d){if(d instanceof ct)return r("LoginForm");console.error(d)}}return c(),document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)}},[e]),s(w,null,o||{Blank:s("div",null),LoginForm:s(_n,{resort:t,onLogin:c=>{e.setData(c),r("Client")}}),Client:n}[i])}const yt=z({}),gn=yt.Provider,de=()=>V(yt),bt=z({current:null,begin:()=>null,end:()=>null}),yn=bt.Provider,X=()=>V(bt),bn=3e3,vn={alert:"bg-yellow-200",error:"bg-red-200"};function xe(){const[,t]=v(0),[e,n]=v(""),[i,r]=v("alert"),o=Q((c,d)=>{n(c),r(d||"alert"),t(u=>(clearTimeout(u),c?self.setTimeout(()=>{n("")},bn):u))},[]);return[s(wn,{message:e,type:i}),o]}function wn({message:t,type:e}){return t?s("div",{role:"alert",className:`fixed bottom-20 left-0 w-full p-2 font-semibold text-center ${vn[e]} text-gray-800`},t):null}function vt({children:t,className:e}){return e||(e=""),e.match(/\bw-\S+\s*/)||(e+=" w-4"),e.match(/\bh-\S+\s*/)||(e+=" h-auto"),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16",className:e},t)}/**
 * Refresh icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function ke({className:t}){return s(vt,{className:t},s("path",{d:"M16 6h-6l2.243-2.243c-1.133-1.133-2.64-1.757-4.243-1.757s-3.109 0.624-4.243 1.757c-1.133 1.133-1.757 2.64-1.757 4.243s0.624 3.109 1.757 4.243c1.133 1.133 2.64 1.757 4.243 1.757s3.109-0.624 4.243-1.757c0.095-0.095 0.185-0.192 0.273-0.292l1.505 1.317c-1.466 1.674-3.62 2.732-6.020 2.732-4.418 0-8-3.582-8-8s3.582-8 8-8c2.209 0 4.209 0.896 5.656 2.344l2.343-2.344v6z"}))}async function wt(t){return new Promise(e=>{setTimeout(e,t)})}function xn(){const[t,e]=v(0),n=Q(async(r,o=500)=>{e(c=>c+1);const l=wt(o);try{await r()}finally{await l,e(c=>c-1)}},[]);return[t>0?s(kn,null):null,n]}function kn(){const{bg:t}=j();return s(we,{className:"flex items-center bg-white bg-opacity-75"},s("div",{className:"w-[50px] mx-auto"},s("div",{"aria-label":"Loading\u2026",className:`rounded-full p-[20%] ${t}`},s(ke,{className:"animate-spin w-full text-white"}))))}function Ne(){const[t,e]=xn(),n=!!t,[i,r]=xe();return{loadData:Q(async(c,d)=>{const u=T({error:"Unknown error occurred",request:"Network request failed"},d);r("");let a=()=>null;const m=new Promise(f=>{a=()=>f(null)});async function h(...f){await m,r(...f)}await e(async()=>{try{await c(h)}catch(f){if(f instanceof ut){const{status:_}=f.response;h(_ in u?u[_]:u.request,"error")}else console.error(f),h(u.error,"error")}}),a()},[e,r]),loaderElem:s(w,null,i,t),isLoading:n}}/**
 * Power icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function Nn({className:t}){return s(vt,{className:t},s("path",{d:"M6 0l-6 8h6l-4 8 14-10h-8l6-6z"}))}function Qe(t){const r=t,{className:e}=r,n=B(r,["className"]),{bg:i}=j();return s("select",T({className:`${e||""} border-2 border-white rounded-lg px-1 ${i} font-semibold disabled:opacity-50`},n))}const xt=z({eligible:[],ineligible:[],selected:[],setSelected:()=>null}),En=xt.Provider,Ee=()=>V(xt);function $({guests:t,selectable:e,conflicts:n}){return t.length===0?null:s("ul",{className:"mt-2"},t.map(i=>{var r;return s("li",{key:i.id,className:"px-3 py-1"},s("label",{className:"flex items-center"},e?s("input",{type:"checkbox",checked:e.isSelected(i),onChange:()=>e.onToggle(i),className:"mr-3"}):null,s("span",{className:"w-[48px] h-[48px] leading-[48px] mr-3 rounded-full text-3xl font-bold text-center bg-gray-400 text-white"},i.avatarImageUrl?s("img",{src:i.avatarImageUrl,alt:"",width:"48",height:"48",className:"rounded-full"}):s("span",{"aria-hidden":"true"},i.name[0])),s("span",{className:"leading-tight"},i.name,s("br",null),n!=null&&n[i.id]?s("span",{className:"text-xs font-semibold text-red-700 uppercase"},(r=n[i.id])==null?void 0:r.replace(/_/g," ")):null)))}))}function Te({times:t}){return s("div",{className:"mt-4 text-lg"},"Arrive by:"," ",s("span",{className:"ml-0.5 font-semibold"},t.start.time?s("time",null,F(t.start.time)):"Park Open"," - ",t.end.time?s("time",null,F(t.end.time)):"Park Close"))}function Tn({booking:t,onClose:e}){const n=de(),[i,r]=v(new Set),{loadData:o,loaderElem:l}=Ne(),{guests:c}=t,d=i.size===0,u=i.size===c.length;function a(){o(async()=>{d||await n.cancelBooking([...i]),e(c.filter(m=>!i.has(m)))})}return s(G,{heading:"Your Lightning Lane",theme:t.park.theme},s("h2",null,t.experience.name),s("div",null,t.park.name),s(Te,{times:t}),s("div",{className:"ml-3"},s("label",{className:"flex items-center py-4"},s("input",{type:"checkbox",checked:u,onChange:()=>r(new Set(u?[]:c))}),s("span",{className:"ml-3"},"Select All"))),d?null:s("div",{className:"mb-4"},s("h3",null,"Cancel These Guests"),s($,{guests:c.filter(m=>i.has(m)),selectable:{isSelected:()=>!0,onToggle:m=>{const h=new Set(i);h.delete(m),r(h)}}})),u?null:s("div",null,s("h3",null,"Select Guests to Cancel"),s($,{guests:c.filter(m=>!i.has(m)),selectable:{isSelected:()=>!1,onToggle:m=>r(new Set(i).add(m))}})),s(O,{onClick:a},d?"Back":"Cancel "+(u?"Reservation":"Guests")),l)}function kt({booking:t,onClose:e,isRebookable:n,isNew:i}){const r=X(),[o,l]=v(t.guests),[c,d]=v(!1);return c?s(Tn,{booking:P(T({},t),{guests:o}),onClose:u=>{d(!1),u.length>0?l(u):e(u)}}):s(G,{heading:"Your Lightning Lane",theme:t.park.theme,buttons:n&&s(L,{onClick:()=>r.begin(t)},"Rebook")},s("h2",null,t.experience.name),s("div",null,t.park.name),s(Te,{times:t}),t.choices&&s(w,null,s("p",null,"An experience you booked was temporarily unavailable during your return time. You may redeem this Lightning Lane at one of these replacement experiences:"),s("ul",{className:"list-disc mt-2 pl-8"},t.choices.map(u=>s("li",{key:u.id},u.name)))),s("div",{className:"flex mt-4"},s("h3",{className:"inline mt-0"},"Your Party"),t.cancellable&&s(L,{type:"small",onClick:()=>d(!0),className:"ml-3"},"Cancel")),s($,{guests:o,conflicts:Object.fromEntries(o.filter(u=>u.redemptions!==void 0).map(u=>[u.id,`Redemptions left: ${u.redemptions}`]))}),s(O,{onClick:()=>e(o)},i?"Done":"Back"))}function Nt(){const{ineligible:t}=Ee();return s($,{guests:t,conflicts:Object.fromEntries(t.map(e=>[e.id,e.eligibleAfter?`TOO EARLY (${F(e.eligibleAfter)})`:e.ineligibleReason||"ELIGIBLE FOR NEW BOOKING"]))})}function Et({buttonText:t,onSubmit:e}){const{eligible:n,ineligible:i,selected:r,setSelected:o}=Ee(),[l,c]=v();return l?s(w,null,s("h3",null,"Choose Your Party"),s($,{guests:n,selectable:{isSelected:u=>l.has(u),onToggle:u=>c(a=>(a=new Set(a),a[a.has(u)?"delete":"add"](u),a))}}),i.length>0&&s(w,null,s("h3",null,"Ineligible Guests"),s(Nt,null)),s(O,{disabled:l.size===0,onClick:()=>{o([...l]),c(void 0)}},"Confirm Party")):s(w,null,s("div",{className:"mt-4"},s("h3",{className:"inline mt-0"},"Your Party"),s("span",null,s(L,{type:"small",onClick:()=>c(new Set(r)),className:"ml-3"},"Edit"))),s($,{guests:r}),s(O,{onClick:e},t))}function Sn({offer:t,onBook:e}){const n=X();return s(w,null,n.current&&s("p",{className:"border-2 rounded border-red-600 p-1 font-semibold text-center text-red-600 bg-red-100"},"Rebooking resets the two hour timer"),s(Te,{times:t}),t.changeStatus==="PARK_HOPPING"&&s("div",{className:"text-sm"},s("strong",null,"Note:")," Time changed due to park hopping"),s(Et,{buttonText:`${n.current?"Rebook":"Book"} Lightning Lane`,onSubmit:e}))}const Ye="https://widget.time.is/t.js";function Cn(){if([...document.scripts].some(e=>e.src===Ye))return;const t=document.createElement("script");t.src=Ye,t.onload=Tt,document.head.appendChild(t)}const oe={};function Tt(){"time_is_widget"in self&&self.time_is_widget.init(oe)}function In(t){Cn(),oe[t]||(oe[t]={}),Tt()}function St(t,e){const n=document.getElementById(t);if(!n||n.firstElementChild)return e();n.textContent=M().time,setTimeout(()=>St(t,e),100)}function Rn({id:t,onSync:e}){return D(()=>{In(t),St(t,e)},[t,e]),s("time",{id:t})}const Dn={WDW:"Orlando_z161",DLR:"Anaheim_z14e"},An=5e3;function Ct({resort:t,time:e,label:n}){const[i,r]=v(null);D(()=>{setTimeout(()=>r(l=>l||!1),An)},[]);const o=Q(()=>r(!0),[]);return s("table",{className:"mt-4 mx-auto text-gray-500"},s(Je,{heading:n,time:s("time",null,e||"--:--:--")}),s(Je,{heading:s("a",{href:`https://time.is/${t}`,id:"time_is_link",target:"_blank",rel:"noreferrer"},"Current time"),time:s(w,null,s(Rn,{id:Dn[t],onSync:o}),i===!1?s("span",{className:"text-sm font-sans font-semibold text-red-600"}," ","(unsynced)"):null)}))}function Je({heading:t,time:e}){return s("tr",null,s("th",{scope:"row",className:"pr-3 text-right text-xs font-semibold uppercase"},t,":"),s("td",{className:"text-xl font-mono leading-tight"},"\uFEFF",e))}function Pn({startTime:t,onRefresh:e}){return s(w,null,t&&s(Ct,{resort:"WDW",time:t,label:"Booking start"}),s("h3",{className:"mt-4"},"Not Available Yet"),t?s("p",null,"At"," ",s("time",{dateTime:t,className:"font-semibold"},F(t)),", tap the ",s("span",{className:"font-semibold"},"Check Availability")," ","button below to start booking this Lightning Lane."):s("p",null,"Sorry, but you can't make a Lightning Lane reservation for this attraction yet."),s(Et,{buttonText:"Check Availability",onSubmit:e}))}function Ln({onClose:t}){const{ineligible:e}=Ee(),{eligibleAfter:n}=e[0]||{},i=X();return s(w,null,n&&s("div",{className:"mt-4 border-2 border-green-600 rounded p-1 uppercase font-semibold text-center text-green-600 bg-green-100"},"Eligible at ",F(n)),i.current?s(w,null,s("h3",null,"Unable to Rebook"),s("p",null,"Your current reservation cannot be rebooked to this experience due to the following conflicts:")):s(w,null,s("h3",null,"No Eligible Guests"),s("p",null,"No one in your party is currently eligible for this Lightning Lane.")),s(Nt,null),s(O,{onClick:t},"Back"))}function $n({onRefresh:t}){return s(w,null,s("h3",null,"No Guests Found"),s("p",null,"Your party could not be loaded. This is probably just a temporary network error. Wait a few seconds and try again."),s(O,{onClick:t},"Try Again"))}function On({onClose:t}){return s(w,null,s("h3",null,"No Reservations Available"),s("p",null,"Tap the refresh button above to try again or go back to the tip board and select another attraction."),s(O,{onClick:t},"Back"))}function It({booking:t,button:e}){return s("div",{className:"flex items-center gap-x-2"},s("div",{className:"flex-1 min-w-0"},s("div",{className:"text-gray-500 text-sm font-semibold uppercase"},t.start.time?s("time",null,F(t.start.time)):"open"," - ",t.end.time?s("time",null,F(t.end.time)):"close"),s("div",{className:"text-lg font-semibold leading-tight truncate"},t.experience.name)),e&&s("div",null,e))}function Rt(){const t=X(),e=j();return t.current?s("div",{className:`sticky top-0 -mx-3 pb-1 ${e.bg}`},s("div",{className:"pb-3 bg-white"},s("div",{className:`py-1.5 ${e.bg} text-white text-sm font-semibold uppercase text-center`},"Rebooking"),s("div",{className:"mt-2 px-3"},s(It,{booking:t.current,button:s(L,{type:"small",onClick:()=>t.end(!0)},"Keep")})))):null}function Gn({experience:t,park:e,onClose:n}){var E;const i=de(),r=X(),[o,l]=v(),[c,d]=v(t.flex.available),[u,a]=v(c?void 0:null),[m,h]=v(),{loadData:f,loaderElem:_,isLoading:R}=Ne();async function b(){if(!u||!o)return;let C=null;await f(async()=>{const x=new Set(o.selected.map(N=>N.id));r.current&&await i.cancelBooking(r.current.guests.filter(N=>x.has(N.id)));try{C=await i.book(u)}finally{r.end()}const S=C.guests.filter(N=>!x.has(N.id));S.length>0&&(await i.cancelBooking(S),C.guests=C.guests.filter(N=>x.has(N.id)))},{410:"Offer expired"}),C&&h(C)}function y(){f(async C=>{const S=(await i.plusExperiences(e)).find(N=>N.id===t.id);S!=null&&S.flex.available?(d(!0),a(void 0)):C("Reservations not open yet")})}function k(){u&&i.cancelOffer(u),n()}function I(){!o||o.eligible.length===0||f(async()=>{const C=await i.offer({experience:t,park:e,guests:o.eligible});a(x=>(x&&i.cancelOffer(x),C))},{410:"No reservations available"})}const p=Q(()=>{f(async()=>{try{let C=await i.guests({experience:t,park:e});const x=r.current;if(x){const S=new Set(x.guests.map(H=>H.id)),N=[...C.eligible,...C.ineligible].filter(H=>S.has(H.id)&&!(H.ineligibleReason==="TOO_EARLY"||H.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"&&t.id===x.experience.id));C=N.length>0?{eligible:[],ineligible:N}:{eligible:x.guests,ineligible:[]}}l(P(T({},C),{selected:C.eligible,setSelected:S=>l(N=>{if(!N)return N;const H=new Set(N.selected);return S.some(Y=>!H.has(Y))&&a(Y=>{if(!Y)return Y;i.cancelOffer(Y)}),P(T({},N),{selected:S})})}))}catch(C){throw l({eligible:[],ineligible:[],selected:[],setSelected:()=>null}),C}})},[i,t,e,r,f]);return D(p,[p]),D(()=>{u!==void 0||!o||o.eligible.length===0||f(async()=>{try{a(await i.offer({experience:t,park:e,guests:[...o.selected]}))}catch(C){throw a(null),C}},{410:""})},[i,t,e,o,u,f]),m?s(kt,{booking:m,onClose:n,isNew:!0}):s(G,{heading:"Lightning Lane",theme:e.theme,buttons:s(w,null,(!c||u!==null)&&s(L,{onClick:k},"Cancel"),c&&u!==void 0&&s(L,{onClick:I,title:"Refresh Offer"},s(ke,null)))},s(Rt,null),s("h2",null,t.name),s("div",null,e.name),s(En,{value:o||{eligible:[],ineligible:[],selected:[],setSelected:()=>null}},((E=o==null?void 0:o.eligible)==null?void 0:E.length)===0?R?s("div",null):o.ineligible.length===0?s($n,{onRefresh:p}):s(Ln,{onClose:n}):!o||u===void 0?s("div",null):c?u===null?s(On,{onClose:n}):s(Sn,{offer:u,onBook:b}):s(Pn,{startTime:t.flex.enrollmentStartTime,onRefresh:y})),_)}function Bn({onClose:t}){const e=de(),[n,i]=v(),[r,o]=v(),[l,c]=v(!1);function d(a){!r||(i(m=>{if(!!m)return a.length>0?r.guests=a:m.splice(m.indexOf(r),1),m}),o(void 0))}D(()=>{c(!0),e.bookings().then(a=>i(a))},[e]);function u(){c(!1),setTimeout(t,300)}return r?s(kt,{booking:r,onClose:d,isRebookable:e.isRebookable(r)}):s(w,null,s(we,{onClick:u,"data-testid":"panel-shade",className:"bg-black bg-opacity-75"}),s(G,{heading:"Your Lightning Lanes",buttons:s(L,{onClick:u},"Close"),className:`top-auto max-h-[50%] ${l?"h-[275px]":"h-0"} duration-200 ease-linear`},n&&n.length>0?s("ul",null,(n||[]).map(a=>{var m;return s("li",{className:"py-3 first:border-0 border-t-4 border-gray-300",key:(m=a.guests[0])==null?void 0:m.entitlementId},s(It,{booking:a,button:s(L,{type:"small",onClick:()=>o(a)},"More")}))})):s("div",{className:"mt-4 text-sm font-semibold text-center uppercase  text-gray-500"},n&&"No current reservations")))}function Se({label:t,children:e}){return s("div",{className:"flex items-center flex-1 whitespace-nowrap"},s("span",{className:"mr-2 text-xs font-semibold uppercase text-gray-500"},t)," ",e)}function Mn({experience:t,onClick:e}){const{flex:n}=t;return s(Se,{label:"Genie+"},n.nextAvailableTime?s("span",null,s(L,{onClick:()=>e(t)},F(n.nextAvailableTime))):s("span",{className:"inline-block border-2 border-gray-500 rounded px-1.5 py-0.5 font-semibold text-gray-500 bg-gray-100"},"none"))}function Un({experience:{type:t,standby:e}}){return e.displayNextShowTime||t==="ENTERTAINMENT"&&!e.waitTime?s(Hn,{standby:e}):s(Fn,{standby:e})}const Fn=({standby:t})=>s(Se,{label:"Standby"},t.available?s(At,{time:t.waitTime!==void 0?t.waitTime+" min":"now"}):s(Pt,{text:"down"})),Hn=({standby:t})=>s(Se,{label:s(w,null,"Next ",s("span",{className:"hidden xs:inline"},"Show"))},t.displayNextShowTime?s(At,{time:t.displayNextShowTime}):s(Pt,{text:"none"})),Dt="inline-block border-2 rounded px-1.5 py-0.5 font-semibold",At=({time:t})=>s("span",{className:`${Dt} border-gray-500 text-gray-500 bg-gray-100`},t),Pt=({text:t})=>s("span",{className:`${Dt} border-red-600 text-red-600 bg-red-100`},t),jn=6e4,Wn=(t,e)=>(t.priority||1/0)-(e.priority||1/0),me=(t,e)=>(e.standby.waitTime||-1)-(t.standby.waitTime||-1),fe=(t,e)=>(t.flex.nextAvailableTime||"").localeCompare(e.flex.nextAvailableTime||""),Qn=(t,e)=>t.name.toLowerCase().localeCompare(e.name.toLowerCase()),Yn={priority:(t,e)=>Wn(t,e)||me(t,e)||fe(t,e),standby:(t,e)=>me(t,e)||fe(t,e),soonest:(t,e)=>fe(t,e)||me(t,e),aToZ:()=>0};function Jn(){const t=de(),{parks:e}=t,[n,i]=v(e[0]),[r,o]=v([]),[l,c]=v(),[d,u]=v(!1),[a,m]=v("priority"),{loadData:h,loaderElem:f,isLoading:_}=Ne(),[,R]=v(0),[b,y]=v(()=>({current:null,begin:p=>{y(P(T({},b),{current:p})),i(p.park),u(!1)},end:(p=!1)=>{y(E=>E.current?P(T({},E),{current:null}):E),p&&c(void 0)}})),k=ve(null),I=Q((p=!0)=>{R(E=>!p&&Date.now()-E<jn?E:(h(async()=>o(await t.plusExperiences(n))),Date.now()))},[t,n,h]);return D(()=>{o([]),I()},[I]),D(()=>{if(_||l||d)return;const p=()=>{document.hidden||I(!1)};return document.addEventListener("visibilitychange",p),()=>{document.removeEventListener("visibilitychange",p)}},[l,I,_,d]),D(()=>{var p;(p=k.current)==null||p.scroll(0,0)},[n,a,b]),s(yn,{value:b},s(G,{heading:s(w,null,"G",s("span",{className:"hidden xs:inline"},"enie"),"+"),theme:n.theme,buttons:s(w,null,s(L,{onClick:()=>u(!0),title:"Your Lightning Lanes"},s(Nn,null)),s(Qe,{value:n.id,onChange:p=>{i(e.find(E=>E.id===p.currentTarget.value))},title:"Park"},e.map(p=>s("option",{value:p.id,title:p.name,key:p.id},p.abbr))),s(Qe,{value:a,onChange:p=>m(p.currentTarget.value),title:"Sort By"},s("option",{value:"priority"},"Priority"),s("option",{value:"standby"},"Standby"),s("option",{value:"soonest"},"Soonest"),s("option",{value:"aToZ"},"A to Z")),s(L,{onClick:I,title:"Refresh Tip Board"},s(ke,null))),containerRef:k},s("div",{"aria-hidden":!!(l||d)},s(Rt,null),s("ul",null,r.sort((p,E)=>+E.flex.available-+p.flex.available||Yn[a](p,E)||Qn(p,E)).map(p=>s("li",{className:"pb-3 first:border-0 border-t-4 border-gray-300",key:p.id},s("h2",{className:"text-lg leading-tight truncate"},p.name),p.flex.preexistingPlan?s("div",{className:"mt-2 border-2 border-green-600 rounded p-1 text-sm uppercase font-semibold text-center text-green-600 bg-green-100"},"Lightning Lane Booked"):null,s("div",{className:"flex flex-wrap gap-1.5 mt-2"},s(Un,{experience:p}),s(Mn,{experience:p,onClick:c}))))),f)),d&&s(Bn,{onClose:()=>u(!1)}),l&&s(Gn,{experience:l,park:n,onClose:()=>{I(!1),c(void 0)}}))}const Lt=z({}),qn=Lt.Provider,zn=()=>V(Lt),Kn={success:5e3,failure:1e3};function Vn({guests:t,result:e,onDone:n}){const{boardingGroup:i,conflicts:r}=e,o=t.filter(u=>!(u.id in r)),l=t.filter(u=>u.id in r),[c,d]=v(!0);return D(()=>{setTimeout(()=>d(!1),Kn[i?"success":"failure"])},[i]),s(w,null,i?s(w,null,s("h2",{className:"mt-5 text-xl"},"Boarding Group: ",i),s($,{guests:o}),Object.keys(r).length>0?s(w,null,s("p",{className:"font-semibold"},"These guests could not join:"),s($,{guests:l,conflicts:r})):null,s("p",null,"Refer to the My Disney Experience app for return time and other information.")):s(w,null,s("h2",{className:"mt-5 text-xl"},"Sorry!"),s("p",null,"A boarding group could not be obtained."),s($,{guests:l,conflicts:r})),c?null:s(O,{onClick:n},"Done"))}function Xn({guests:t,party:e,onToggle:n,onConfirm:i}){return s(w,null,s("h2",{className:"mt-5 text-xl"},"Choose Your Party"),t.length>0?s($,{guests:t,selectable:{isSelected:r=>e.has(r),onToggle:n}}):s("p",null,"No guests available"),s(O,{disabled:e.size===0,onClick:i},"Confirm Party"))}function Zn({queue:t}){return s(w,null,t.howToEnterMessage.split(`

`).map((e,n)=>s("p",{key:n},e)))}const es=999;function ts({guests:t,joinQueue:e,onEdit:n}){const[i,r]=v(!1),[o,l]=xe(),{bg:c}=j();async function d(){r(!0),l("");const u=wt(es);try{await e()||l("Queue not open yet")}catch(a){l("Error: try again","error"),a instanceof se||console.error(a)}finally{await u,r(!1)}}return s(w,null,s("div",{className:"mt-4"},s("h2",{className:"inline text-xl"},"Your Party"),s("span",null,s("button",{onClick:n,className:`ml-3 px-2 py-1.5 rounded-lg ${c} text-white text-xs uppercase font-semibold tracking-wide align-middle`},"Edit"))),s($,{guests:t}),s(O,{disabled:i,onClick:d},"Join Boarding Group"),o)}function ns({queue:t,queues:e,onChange:n}){e||(e=[]);const{bg:i}=j(),r=`block w-full ${i} text-white text-xl font-semibold`;return s(w,null,e.length<=1?s("span",{className:`${r} px-1 truncate`},t.name):s("select",{className:`${r} pr-1`,onChange:o=>n?n(o.currentTarget.value):null},e.map(o=>s("option",{selected:o===t,key:o.id,value:o.id,className:"text-base font-normal"},o.name))))}function ss(){const t=zn(),[e,n]=v(),[i,r]=v(null),[o,l]=v([]),[c,d]=v(new Set),[u,a]=v({boardingGroup:null,conflicts:{},closed:!0}),[m,h]=v("ChooseParty"),[f,_]=xe(),R=ve(null);D(()=>{(async()=>{const x=await t.getQueues();n(x),r(x[0])})()},[t]),D(()=>{if(!i)return;let x=!1;return(async()=>{const S=await t.getLinkedGuests(i);x||(l(S),d(new Set(S.filter(N=>N.isPreselected))))})(),()=>{x=!0}},[t,i]),D(()=>{var x;(x=R.current)==null||x.scroll(0,0)},[m]);function b(x){const S=new Set(c);S[S.has(x)?"delete":"add"](x);const N=Number(i==null?void 0:i.maxPartySize);N>0&&S.size>N?_(`Max party size: ${N}`,"error"):(d(S),_(""))}function y(x){const S=e==null?void 0:e.find(N=>N.id===x);S&&r(S)}async function k(){return!i||!(await t.getQueue(i)).isAcceptingJoins?!1:(a(await t.joinQueue(i,[...c])),h("BGResult"),!0)}if((e==null?void 0:e.length)===0)return s(G,{heading:"No Virtual Queues"},s("p",null,"The virtual queue system is not currently in use for any attractions."));if(!i)return s("div",null);const I=o.filter(x=>c.has(x)),p=s(Ct,{resort:t.resort,time:i.nextScheduledOpenTime,label:"Next queue opening"}),E=s(ns,{queue:i,queues:m==="ChooseParty"?e:[],onChange:y});return{ChooseParty:s(G,{heading:E,containerRef:R},s(Zn,{queue:i}),p,s(Xn,{guests:o,party:c,onToggle:b,onConfirm:()=>h("JoinQueue")}),f),JoinQueue:s(G,{heading:E},p,s(ts,{guests:I,onEdit:()=>h("ChooseParty"),joinQueue:k})),BGResult:s(G,{heading:E},s(Vn,{guests:I,result:u,onDone:()=>h("ChooseParty")}))}[m]}const $t=new Qt("bg1.auth"),qe=()=>$t.getData();Zt(origin)?ze(new tn({origin,getAuthData:qe}),ss,qn):Vt(origin)?be.load({origin,getAuthData:qe}).then(t=>ze(t,Jn,gn)):location.href="https://joelface.github.io/bg1/start.html";async function ze(t,e,n){document.head.innerHTML+=`
    <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>BG1</title>
  `,Wt({WDW:"America/New_York",DLR:"America/Los_Angeles"}[t.resort]),jt(s(pn,{resort:t.resort,authStore:$t},s(n,{value:t},s(e,null))),document.body),is()}function is(){document.body.addEventListener("click",()=>null)}
