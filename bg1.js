var Rt=Object.defineProperty,Pt=Object.defineProperties;var Lt=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Ee=(t,e,n)=>e in t?Rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E=(t,e)=>{for(var n in e||(e={}))Te.call(e,n)&&Ee(t,n,e[n]);if(z)for(var n of z(e))Ce.call(e,n)&&Ee(t,n,e[n]);return t},G=(t,e)=>Pt(t,Lt(e));var M=(t,e)=>{var n={};for(var s in t)Te.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&z)for(var s of z(t))e.indexOf(s)<0&&Ce.call(t,s)&&(n[s]=t[s]);return n};var ie,g,Je,Q,qe,Se,ze,te={},Ke=[],$t=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function F(t,e){for(var n in e)t[n]=e[n];return t}function Ve(t){var e=t.parentNode;e&&e.removeChild(t)}function i(t,e,n){var s,r,o,l={};for(o in e)o=="key"?s=e[o]:o=="ref"?r=e[o]:l[o]=e[o];if(arguments.length>2&&(l.children=arguments.length>3?ie.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)l[o]===void 0&&(l[o]=t.defaultProps[o]);return K(t,l,s,r,null)}function K(t,e,n,s,r){var o={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r==null?++Je:r};return r==null&&g.vnode!=null&&g.vnode(o),o}function x(t){return t.children}function V(t,e){this.props=t,this.context=e}function j(t,e){if(e==null)return t.__?j(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?j(t):null}function Xe(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Xe(t)}}function fe(t){(!t.__d&&(t.__d=!0)&&Q.push(t)&&!ne.__r++||Se!==g.debounceRendering)&&((Se=g.debounceRendering)||qe)(ne)}function ne(){for(var t;ne.__r=Q.length;)t=Q.sort(function(e,n){return e.__v.__b-n.__v.__b}),Q=[],t.some(function(e){var n,s,r,o,l,c;e.__d&&(l=(o=(n=e).__v).__e,(c=n.__P)&&(s=[],(r=F({},o)).__v=o.__v+1,pe(c,o,r,n.__n,c.ownerSVGElement!==void 0,o.__h!=null?[l]:null,s,l==null?j(o):l,o.__h),nt(s,o),o.__e!=l&&Xe(o)))})}function Ze(t,e,n,s,r,o,l,c,u,d){var a,f,_,m,h,N,v,k=s&&s.__k||Ke,T=k.length;for(n.__k=[],a=0;a<e.length;a++)if((m=n.__k[a]=(m=e[a])==null||typeof m=="boolean"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?K(null,m,null,null,m):Array.isArray(m)?K(x,{children:m},null,null,null):m.__b>0?K(m.type,m.props,m.key,null,m.__v):m)!=null){if(m.__=n,m.__b=n.__b+1,(_=k[a])===null||_&&m.key==_.key&&m.type===_.type)k[a]=void 0;else for(f=0;f<T;f++){if((_=k[f])&&m.key==_.key&&m.type===_.type){k[f]=void 0;break}_=null}pe(t,m,_=_||te,r,o,l,c,u,d),h=m.__e,(f=m.ref)&&_.ref!=f&&(v||(v=[]),_.ref&&v.push(_.ref,null,m),v.push(f,m.__c||h,m)),h!=null?(N==null&&(N=h),typeof m.type=="function"&&m.__k===_.__k?m.__d=u=et(m,u,t):u=tt(t,m,_,k,h,u),typeof n.type=="function"&&(n.__d=u)):u&&_.__e==u&&u.parentNode!=t&&(u=j(_))}for(n.__e=N,a=T;a--;)k[a]!=null&&(typeof n.type=="function"&&k[a].__e!=null&&k[a].__e==n.__d&&(n.__d=j(s,a+1)),it(k[a],k[a]));if(v)for(a=0;a<v.length;a++)st(v[a],v[++a],v[++a])}function et(t,e,n){for(var s,r=t.__k,o=0;r&&o<r.length;o++)(s=r[o])&&(s.__=t,e=typeof s.type=="function"?et(s,e,n):tt(n,s,s,r,s.__e,e));return e}function tt(t,e,n,s,r,o){var l,c,u;if(e.__d!==void 0)l=e.__d,e.__d=void 0;else if(n==null||r!=o||r.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(r),l=null;else{for(c=o,u=0;(c=c.nextSibling)&&u<s.length;u+=2)if(c==r)break e;t.insertBefore(r,o),l=o}return l!==void 0?l:r.nextSibling}function Ot(t,e,n,s,r){var o;for(o in n)o==="children"||o==="key"||o in e||se(t,o,null,n[o],s);for(o in e)r&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||se(t,o,e[o],n[o],s)}function Ie(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||$t.test(e)?n:n+"px"}function se(t,e,n,s,r){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||Ie(t.style,e,"");if(n)for(e in n)s&&n[e]===s[e]||Ie(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?s||t.addEventListener(e,o?Ae:De,o):t.removeEventListener(e,o?Ae:De,o);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n==null?"":n;break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function De(t){this.l[t.type+!1](g.event?g.event(t):t)}function Ae(t){this.l[t.type+!0](g.event?g.event(t):t)}function pe(t,e,n,s,r,o,l,c,u){var d,a,f,_,m,h,N,v,k,T,I,p=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(u=n.__h,c=e.__e=n.__e,e.__h=null,o=[c]),(d=g.__b)&&d(e);try{e:if(typeof p=="function"){if(v=e.props,k=(d=p.contextType)&&s[d.__c],T=d?k?k.props.value:d.__:s,n.__c?N=(a=e.__c=n.__c).__=a.__E:("prototype"in p&&p.prototype.render?e.__c=a=new p(v,T):(e.__c=a=new V(v,T),a.constructor=p,a.render=Bt),k&&k.sub(a),a.props=v,a.state||(a.state={}),a.context=T,a.__n=s,f=a.__d=!0,a.__h=[]),a.__s==null&&(a.__s=a.state),p.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=F({},a.__s)),F(a.__s,p.getDerivedStateFromProps(v,a.__s))),_=a.props,m=a.state,f)p.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(p.getDerivedStateFromProps==null&&v!==_&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(v,T),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(v,a.__s,T)===!1||e.__v===n.__v){a.props=v,a.state=a.__s,e.__v!==n.__v&&(a.__d=!1),a.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(b){b&&(b.__=e)}),a.__h.length&&l.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(v,a.__s,T),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(_,m,h)})}a.context=T,a.props=v,a.state=a.__s,(d=g.__r)&&d(e),a.__d=!1,a.__v=e,a.__P=t,d=a.render(a.props,a.state,a.context),a.state=a.__s,a.getChildContext!=null&&(s=F(F({},s),a.getChildContext())),f||a.getSnapshotBeforeUpdate==null||(h=a.getSnapshotBeforeUpdate(_,m)),I=d!=null&&d.type===x&&d.key==null?d.props.children:d,Ze(t,Array.isArray(I)?I:[I],e,n,s,r,o,l,c,u),a.base=e.__e,e.__h=null,a.__h.length&&l.push(a),N&&(a.__E=a.__=null),a.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Gt(n.__e,e,n,s,r,o,l,u);(d=g.diffed)&&d(e)}catch(b){e.__v=null,(u||o!=null)&&(e.__e=c,e.__h=!!u,o[o.indexOf(c)]=null),g.__e(b,e,n)}}function nt(t,e){g.__c&&g.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(s){s.call(n)})}catch(s){g.__e(s,n.__v)}})}function Gt(t,e,n,s,r,o,l,c){var u,d,a,f=n.props,_=e.props,m=e.type,h=0;if(m==="svg"&&(r=!0),o!=null){for(;h<o.length;h++)if((u=o[h])&&"setAttribute"in u==!!m&&(m?u.localName===m:u.nodeType===3)){t=u,o[h]=null;break}}if(t==null){if(m===null)return document.createTextNode(_);t=r?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,_.is&&_),o=null,c=!1}if(m===null)f===_||c&&t.data===_||(t.data=_);else{if(o=o&&ie.call(t.childNodes),d=(f=n.props||te).dangerouslySetInnerHTML,a=_.dangerouslySetInnerHTML,!c){if(o!=null)for(f={},h=0;h<t.attributes.length;h++)f[t.attributes[h].name]=t.attributes[h].value;(a||d)&&(a&&(d&&a.__html==d.__html||a.__html===t.innerHTML)||(t.innerHTML=a&&a.__html||""))}if(Ot(t,_,f,r,c),a)e.__k=[];else if(h=e.props.children,Ze(t,Array.isArray(h)?h:[h],e,n,s,r&&m!=="foreignObject",o,l,o?o[0]:n.__k&&j(n,0),c),o!=null)for(h=o.length;h--;)o[h]!=null&&Ve(o[h]);c||("value"in _&&(h=_.value)!==void 0&&(h!==t.value||m==="progress"&&!h||m==="option"&&h!==f.value)&&se(t,"value",h,f.value,!1),"checked"in _&&(h=_.checked)!==void 0&&h!==t.checked&&se(t,"checked",h,f.checked,!1))}return t}function st(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(s){g.__e(s,n)}}function it(t,e,n){var s,r;if(g.unmount&&g.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||st(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(o){g.__e(o,e)}s.base=s.__P=null}if(s=t.__k)for(r=0;r<s.length;r++)s[r]&&it(s[r],e,typeof t.type!="function");n||t.__e==null||Ve(t.__e),t.__e=t.__d=void 0}function Bt(t,e,n){return this.constructor(t,n)}function Mt(t,e,n){var s,r,o;g.__&&g.__(t,e),r=(s=typeof n=="function")?null:n&&n.__k||e.__k,o=[],pe(e,t=(!s&&n||e).__k=i(x,null,[t]),r||te,te,e.ownerSVGElement!==void 0,!s&&n?[n]:r?null:e.firstChild?ie.call(e.childNodes):null,o,!s&&n?n:r?r.__e:e.firstChild,s),nt(o,t)}function oe(t,e){var n={__c:e="__cC"+ze++,__:t,Consumer:function(s,r){return s.children(r)},Provider:function(s){var r,o;return this.getChildContext||(r=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(l){this.props.value!==l.value&&r.some(fe)},this.sub=function(l){r.push(l);var c=l.componentWillUnmount;l.componentWillUnmount=function(){r.splice(r.indexOf(l),1),c&&c.call(l)}}),s.children}};return n.Provider.__=n.Consumer.contextType=n}ie=Ke.slice,g={__e:function(t,e,n,s){for(var r,o,l;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),l=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,s||{}),l=r.__d),l)return r.__E=r}catch(c){t=c}throw t}},Je=0,V.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=F({},this.state),typeof t=="function"&&(t=t(F({},n),this.props)),t&&F(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),fe(this))},V.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),fe(this))},V.prototype.render=x,Q=[],qe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ne.__r=0,ze=0;let ot="America/New_York";function Ut(t){ot=t}function U(t){t=new Date(t||Date.now());const e={},n="2-digit";return Intl.DateTimeFormat("en-US",{timeZone:ot,hourCycle:"h23",year:"numeric",month:n,day:n,hour:n,minute:n,second:n}).formatToParts(t).forEach(s=>e[s.type]=s.value),{date:`${e.year}-${e.month}-${e.day}`,time:`${e.hour}:${e.minute}:${e.second}`}}function W(t){const e=t.split(":").map(Number),n=e[0]>=12?"PM":"AM";return e[0]=e[0]%12||12,e.map(s=>String(s).padStart(2,"0")).join(":").replace(/:00$/,"").replace(/^0/,"")+" "+n}class rt extends Error{constructor(e){super(`Auth data "${e}" missing or expired`),this.name="ReauthNeeded"}}class Ft{constructor(e,n=localStorage){this.storageKey=e,this.storage=n}getData(){const e=this.storage.getItem(this.storageKey);if(e){const{swid:n,accessToken:s,expires:r}=JSON.parse(e),o=U(new Date(r)),l=U();if(o.date>l.date||o.date===l.date&&o.time>l.time&&o.time>="17")return{swid:n,accessToken:s}}throw new rt(this.storageKey)}setData(e){this.storage.setItem(this.storageKey,JSON.stringify(e))}deleteData(){this.storage.removeItem(this.storageKey)}}const Ht="modulepreload",Re={},jt="/bg1/",Pe=function(e,n){return!n||n.length===0?e():Promise.all(n.map(s=>{if(s=`${jt}${s}`,s in Re)return;Re[s]=!0;const r=s.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${o}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":Ht,r||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),r)return new Promise((c,u)=>{l.addEventListener("load",c),l.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())},Wt=8e3;async function me(t,e={}){const d=e,{params:n,data:s,timeout:r=Wt}=d;e=M(d,["params","data","timeout"]),n&&(t+="?"+Object.entries(n).filter(([,a])=>a!=="").map(a=>a.map(encodeURIComponent).join("=")).join("&")),s&&(e.method||(e.method="POST"),e.headers=G(E({},e.headers||{}),{"Content-Type":"application/json"}),e.body=JSON.stringify(s));const l=new AbortController;e.signal=l.signal;const c=setTimeout(()=>l.abort(),r);let u;try{u=await fetch(t,e)}catch(a){return console.error(a),{status:0,data:null}}finally{clearTimeout(c)}return{status:u.status,data:(u.headers.get("Content-Type")||"").startsWith("application/json")?await u.json():{}}}function Qt(t){switch(t){case"./data/dlr.ts":return Pe(()=>import("./dlr.js"),[]);case"./data/wdw.ts":return Pe(()=>import("./wdw.js"),[]);default:return new Promise(function(e,n){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t)))})}}const _e={"https://disneyworld.disney.go.com":"WDW","https://disneyland.disney.go.com":"DLR"},Yt={WDW:"wdw-itinerary-api",DLR:"dlr-itinerary-web-api"};function Jt(t){return t in _e}class at extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}class ge{constructor(e){this.guestNames=new Map,this._primaryGuestId="",this.origin=e.origin,this.getAuthData=e.getAuthData,this.data=e.data,this.bookingStack=new qt}static async load(e){const n=(await Qt(`./data/${_e[e.origin].toLocaleLowerCase()}.ts`)).default;return new ge(G(E({},e),{data:n}))}get resort(){return _e[this.origin]}get parks(){return this.data.parks}async plusExperiences(e){return(await this.request({path:`/tipboard-vas/api/v1/parks/${encodeURIComponent(e.id)}/experiences`,key:"availableExperiences"})).map(s=>E(E({},s),this.data.experiences[s.id])).filter(s=>!!(s.name&&s.flex))}async guests(e){const n=await this.request({path:"/ea-vas/api/v1/guests",params:{productType:"FLEX",experienceId:e.experience.id,parkId:e.park.id}});this._primaryGuestId=n.primaryGuestId;const s=d=>{var a=d,{firstName:l,lastName:c}=a,u=M(a,["firstName","lastName"]);return G(E({},u),{name:`${l} ${c}`.trim()})},r=n.ineligibleGuests.map(s),o=n.guests.map(s).filter(l=>"ineligibleReason"in l?(r.push(l),!1):!0);return[...o,...r].forEach(l=>{this.guestNames.has(l.id)||this.guestNames.set(l.id,l.name)}),o.sort((l,c)=>l.name.localeCompare(c.name)),r.sort((l,c)=>{const u=l.name.localeCompare(c.name);return l.eligibleAfter||c.eligibleAfter?(l.eligibleAfter||"99").localeCompare(c.eligibleAfter||"99")||u:l.ineligibleReason===c.ineligibleReason?u:l.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?-1:c.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?1:u}),{guests:o,ineligibleGuests:r}}async primaryGuestId(e){return this._primaryGuestId||await this.guests(e),this._primaryGuestId}async offer({experience:e,park:n,guests:s}){const{id:r,date:o,startTime:l,endTime:c,changeStatus:u}=await this.request({path:"/ea-vas/api/v1/products/flex/offers",method:"POST",data:{productType:"FLEX",guestIds:s.map(d=>d.id),primaryGuestId:await this.primaryGuestId({experience:e,park:n}),parkId:n.id,experienceId:e.id,selectedTime:e.flex.nextAvailableTime},key:"offer"});return{id:r,start:{date:o,time:l},end:{date:o,time:c},changeStatus:u}}async cancelOffer(e){await this.request({path:`/ea-vas/api/v1/offers/${encodeURIComponent(e.id)}`,method:"DELETE",params:{productType:"FLEX"},userId:!1})}async book(e){const{singleExperienceDetails:{experienceId:n,parkId:s},entitlements:r,startDateTime:o,endDateTime:l}=await this.request({path:"/ea-vas/api/v1/products/flex/bookings",method:"POST",userId:!1,data:{offerId:e.id},key:"booking"});return this.bookings(),{experience:{id:n,name:this.data.experiences[n].name},park:this.data.parks.find(c=>c.id===s),start:U(o),end:U(l),guests:r.map(c=>({id:c.guestId,name:this.guestNames.get(c.guestId)||"",entitlementId:c.id})),multipleExperiences:!1}}async cancelBooking(e){const s=e.map(r=>r.entitlementId).map(encodeURIComponent).join(",");await this.request({path:`/ea-vas/api/v1/entitlements/${s}`,method:"DELETE",userId:!1})}async bookings(){const{swid:e}=this.getAuthData(),n=new Date(Date.now()),s=Yt[this.resort],{items:r=[],assets:o={},profiles:l={}}=await this.request({path:`/plan/${s}/api/v1/itinerary-items/${e}`,params:{destination:this.resort,fields:"items,profiles,assets","item-types":"FASTPASS","guest-locators":e+";type=swid","guest-locator-groups":"MY_FAMILY","start-date":U(n).date,"end-date":U(new Date(n.getTime()).setDate(n.getDate()+1)).date,"show-friends":"false"},userId:!1}),c=Object.fromEntries(this.parks.map(a=>[a.id,a])),u=U(new Date(n.getTime()).setMinutes(n.getMinutes()-15)),d=r.filter(a=>a.type==="FASTPASS"&&a.kind==="FLEX").filter(a=>a.displayEndDate>=u.date&&a.displayEndTime>=u.time).map(a=>{const f=a.facility.split(";")[0],_=o[a.facility],m=_.location.split(";")[0];return{experience:{id:f,name:this.data.experiences[f].name||_.name},park:c[m],start:{date:a.displayStartDate,time:a.displayStartTime},end:{date:a.displayEndDate,time:a.displayEndTime},multipleExperiences:a.multipleExperiences,guests:a.guests.map(h=>{const{name:N}=l[h.id];return{id:h.id.split(";")[0],entitlementId:h.entitlementId,name:`${N.firstName} ${N.lastName}`.trim()}})}}).sort((a,f)=>(a.start.date+a.start.time).localeCompare(f.start.date+f.start.time));return this.bookingStack.update(d),d}isRebookable(e){return this.bookingStack.isRebookable(e)}async request(e){var d;const{swid:n,accessToken:s}=this.getAuthData(),r=this.origin+e.path,o=E({},e.params);((d=e.userId)==null||d)&&(o.userId=n);const{status:l,data:c}=await me(r,{method:e.method||"GET",params:o,data:e.data,headers:{Authorization:`BEARER ${s}`,"User-Agent":"Mozilla/5.0"},credentials:"omit"}),{key:u}=e;if(String(l)[0]==="2"&&(!u||c[u]))return u?c[u]:c;throw new at({status:l,data:c})}}const Le="bg1.genie.bookings";class qt{constructor(e=!0){if(this.entitlementIds=[],this.mostRecent=new Map,!e)return;const{entitlementIds:n=[],mostRecent:s={}}=JSON.parse(localStorage.getItem(Le)||"{}");this.entitlementIds=n,this.mostRecent=new Map(Object.entries(s))}isRebookable(e){return e.guests.every(n=>this.mostRecent.get(n.id)===n.entitlementId)}update(e){const n=new Map,s=new Set(this.entitlementIds);this.entitlementIds=e.filter(r=>!r.multipleExperiences).map(r=>r.guests.map(({id:o,entitlementId:l})=>(this.entitlementIds.push(l),s.has(l)||n.set(o,n.has(o)?"":l),l))).flat(1),this.mostRecent=new Map([...this.mostRecent,...n]),n.size>0&&localStorage.setItem(Le,JSON.stringify({entitlementIds:this.entitlementIds,mostRecent:Object.fromEntries(this.mostRecent)}))}}const lt={"https://vqguest-svc-wdw.wdprapps.disney.com":"WDW","https://vqguest-svc.wdprapps.disney.com":"DLR"};function zt(t){return t in lt}function Kt(t){return t.sort((e,n)=>e.isPrimaryGuest!==n.isPrimaryGuest?Number(n.isPrimaryGuest)-Number(e.isPrimaryGuest):e.isPreselected!==n.isPreselected?Number(n.isPreselected)-Number(e.isPreselected):e.name.localeCompare(n.name))}class X extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}class Vt{constructor(e){this.origin=e.origin,this.getAuthData=e.getAuthData}get resort(){return lt[this.origin]}url(e){return`${this.origin}/application/v1/guest/${e}`}async getQueues(){return(await me(this.url("getQueues"))).data.queues.map(s=>{var r=s,{queueId:e}=r,n=M(r,["queueId"]);return G(E({},n),{id:e})}).sort((e,n)=>e.categoryContentId===n.categoryContentId?e.name.localeCompare(n.name):e.categoryContentId==="attraction"?-1:1)}async getQueue(e){const n=(await this.getQueues()).find(s=>s.id===e.id);if(n)return n;throw new Error("Queue not Found")}async getLinkedGuests(e){const{data:n}=await this.post({resource:"getLinkedGuests",data:{queueId:e.id}});return Kt(n.guests.map(c=>{var u=c,{guestId:s,firstName:r,lastName:o}=u,l=M(u,["guestId","firstName","lastName"]);return G(E({},l),{id:s,name:`${r} ${o}`.trim()})}))}async joinQueue(e,n){const s=n.map(l=>l.id),{status:r,data:o}=await this.post({resource:"joinQueue",data:{queueId:e.id,guestIds:s}});if(o.responseStatus==="OK"){const l=o.positions.find(c=>c.queueId===e.id&&c.guestIds.length>0&&s.some(u=>c.guestIds.includes(u)));if(!l)throw new X({status:r,data:o});return{boardingGroup:l.boardingGroup,conflicts:{},closed:!1}}else if(o.responseStatus==="INVALID_GUEST"||o.responseStatus==="CLOSED_QUEUE"){const l=o.responseStatus==="CLOSED_QUEUE",c=new Set,u={};for(const f of o.conflicts)for(const _ of f.guestIds){const m=n.find(h=>h.id===_);!m||(u[m.id]=f.conflictType,c.add(_))}const d=n.filter(f=>!c.has(f.id));if(l||d.length===0)return{boardingGroup:null,conflicts:u,closed:l};const a=await this.joinQueue(e,d);return a.conflicts=E(E({},u),a.conflicts),a}else throw new X({status:r,data:o})}async post(e){const{status:n,data:s}=await me(this.url(e.resource),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`BEARER ${this.getAuthData().accessToken}`},body:JSON.stringify(e.data)});if(!n||n>=500)throw new X({status:n,data:s});return{status:n,data:s}}}var J,R,$e,Y=0,ct=[],Oe=g.__b,Ge=g.__r,Be=g.diffed,Me=g.__c,Ue=g.unmount;function re(t,e){g.__h&&g.__h(R,t,Y||e),Y=0;var n=R.__H||(R.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function y(t){return Y=1,Xt(ft,t)}function Xt(t,e,n){var s=re(J++,2);return s.t=t,s.__c||(s.__=[n?n(e):ft(void 0,e),function(r){var o=s.t(s.__[0],r);s.__[0]!==o&&(s.__=[o,s.__[1]],s.__c.setState({}))}],s.__c=R),s.__}function A(t,e){var n=re(J++,3);!g.__s&&dt(n.__H,e)&&(n.__=t,n.__H=e,R.__H.__h.push(n))}function ye(t){return Y=5,ut(function(){return{current:t}},[])}function ut(t,e){var n=re(J++,7);return dt(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function q(t,e){return Y=8,ut(function(){return t},e)}function ae(t){var e=R.context[t.__c],n=re(J++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(R)),e.props.value):t.__}function Zt(){for(var t;t=ct.shift();)if(t.__P)try{t.__H.__h.forEach(Z),t.__H.__h.forEach(he),t.__H.__h=[]}catch(e){t.__H.__h=[],g.__e(e,t.__v)}}g.__b=function(t){R=null,Oe&&Oe(t)},g.__r=function(t){Ge&&Ge(t),J=0;var e=(R=t.__c).__H;e&&(e.__h.forEach(Z),e.__h.forEach(he),e.__h=[])},g.diffed=function(t){Be&&Be(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(ct.push(e)!==1&&$e===g.requestAnimationFrame||(($e=g.requestAnimationFrame)||function(n){var s,r=function(){clearTimeout(o),Fe&&cancelAnimationFrame(s),setTimeout(n)},o=setTimeout(r,100);Fe&&(s=requestAnimationFrame(r))})(Zt)),R=null},g.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Z),n.__h=n.__h.filter(function(s){return!s.__||he(s)})}catch(s){e.some(function(r){r.__h&&(r.__h=[])}),e=[],g.__e(s,n.__v)}}),Me&&Me(t,e)},g.unmount=function(t){Ue&&Ue(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{Z(s)}catch(r){e=r}}),e&&g.__e(e,n.__v))};var Fe=typeof requestAnimationFrame=="function";function Z(t){var e=R,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),R=e}function he(t){var e=R;t.__c=t.__(),R=e}function dt(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function ft(t,e){return typeof e=="function"?e(t):e}const mt={bg:"bg-blue-500"},_t=oe(mt),en=_t.Provider,H=()=>ae(_t),tn={normal:"py-1",small:"py-1.5 text-xs uppercase tracking-wide",full:"w-full py-3"};function P(t){const l=t,{type:e,className:n}=l,s=M(l,["type","className"]),r=(n||"")+" "+tn[e||"normal"],{bg:o}=H();return i("button",E({className:`${r} border-2 border-white rounded-lg px-2 ${o} text-white font-semibold disabled:opacity-50`},s))}function $({onClick:t,disabled:e,href:n,children:s}){return i("div",{className:"mb-20"},i("div",{className:"fixed bottom-0 left-0 w-full bg-white bg-opacity-75 text-center"},i("a",{href:n,className:"block max-w-2xl mx-auto px-3 pb-5"},i(P,{type:"full",onClick:t,disabled:e},s))))}function nn({title:t,children:e}){const{bg:n}=H();return i("div",{className:`flex flex-nowrap justify-end gap-x-2 gap-y-1 min-h-[52px] px-3 py-2 font-semibold text-white ${n}`},i("h1",{className:"flex-1 self-center py-0.5 text-xl overflow-hidden whitespace-nowrap"},t),e)}function be(t){const o=t,{children:e,className:n}=o,s=M(o,["children","className"]),r=E({outer:"",inner:""},typeof n=="string"?{inner:n}:n);return i("div",E({className:`${r.outer} fixed inset-0`},s),i("div",{className:`${r.inner} max-w-2xl min-h-full mx-auto`},e))}function B(c){var u=c,{heading:t,buttons:e,className:n,theme:s,containerRef:r,children:o}=u,l=M(u,["heading","buttons","className","theme","containerRef","children"]);return i(en,{value:s||mt},i(be,E({className:{outer:`bg-white ${n||""}`,inner:"flex flex-col max-w-2xl h-full"}},l),i(nn,{title:t},e),i("div",{ref:r,className:"flex-1 overflow-auto px-3 pb-3"},o)))}const sn="bg1.disclaimer.accepted",on={bg:"bg-red-600"};function rn(){const t=localStorage,e=sn,[n,s]=y(!!t.getItem(e));return A(()=>{n&&t.setItem(e,"1")},[n,t,e]),n?null:i(an,{onAccept:()=>s(!0)})}function an({onAccept:t}){return i(B,{heading:"Warning!",theme:on},i("p",null,'Use at your own risk. BG1 is highly experimental, for demonstration purposes only, and provided "as is" without warranty of any kind. It is in no way endorsed by or associated with the Walt Disney Company and could stop working at any time for any reason. To ensure the intended experience, always use the official Disney app.'),i($,{onClick:t},"Accept"))}const ln="17e2767256f";function cn(t){return"deferredUuid"in t&&t.deferredUuid!==void 0}class un{constructor(e,n,s,r=!1){this.iframe=e,this.resort=s,this.logging=r,this.handlers={},this.handshakeAcked=!1,this.onMessage=o=>{if(o.source!==this.iframe.contentWindow||o.data==="inner.loaded")return;const l=JSON.parse(o.data);this.logging&&console.log("Message:",l);const c=l.type==="message"?l.eventName:l.type,u=this.handlers[c],d=u?u("data"in l?l.data:null):void 0;cn(l)&&this.send({type:"deferred",action:"resolve",deferredUuid:l.deferredUuid,data:d!=null?d:{}})},this.on("handshake",()=>{this.handshakeAcked||(this.handshakeAcked=!0,this.send({type:"handshakeAck"}),this.logging&&this.sendMessage("setLogLevel",{level:"log"}),this.sendMessage("workflow.execute",{name:"login"}))}),this.on("lightbox.hide",()=>this.open()),this.on("session.dateOfBirth.read",()=>this.open()),this.on("session.loggedin",({token:o})=>{n({swid:o.swid,accessToken:o.access_token,expires:new Date(o.exp)})})}open(){addEventListener("message",this.onMessage),this.iframe.src=this.authPageUrl,this.handshakeAcked=!1}close(){removeEventListener("message",this.onMessage)}on(e,n){this.handlers[e]=n}sendMessage(e,n){this.send({type:"message",eventName:e,data:n})}send(e){var n;(n=this.iframe.contentWindow)==null||n.postMessage(JSON.stringify(G(E({},e),{name:"lightbox-client-window"})),this.authPageUrl)}get authPageUrl(){return`https://cdn.registerdisney.go.com/v2/TPR-${this.resort}-LBSDK.IOS-PROD/en-US?include=l10n,config,html,js&buildId=${ln}`}}function dn({resort:t,onLogin:e}){const n=ye(null);return A(()=>{if(!n.current)return;const s=new un(n.current,e,t);return s.open(),()=>s.close()},[t,e,n]),i("iframe",{title:"Disney Login Form",ref:n,className:"fixed top-0 left-0 w-full h-full border-0"})}function fn({resort:t,authStore:e,children:n}){const[s,r]=y("Blank"),o=rn();return A(()=>{function c(){try{e.getData(),r("Client")}catch(d){if(d instanceof rt)return r("LoginForm");console.error(d)}}c();const u=setInterval(c,36e5);return()=>clearInterval(u)},[e]),i(x,null,o||{Blank:i("div",null),LoginForm:i(dn,{resort:t,onLogin:c=>{e.setData(c),r("Client")}}),Client:n}[s])}const ht=oe({}),mn=ht.Provider,le=()=>ae(ht),pt=oe({current:null,begin:()=>null,end:()=>null}),_n=pt.Provider,ce=()=>ae(pt),hn=3e3,pn={alert:"bg-yellow-200",error:"bg-red-200"};function ve(){const[,t]=y(0),[e,n]=y(""),[s,r]=y("alert"),o=q((c,u)=>{n(c),r(u||"alert"),t(d=>(clearTimeout(d),c?self.setTimeout(()=>{n("")},hn):d))},[]);return[i(gn,{message:e,type:s}),o]}function gn({message:t,type:e}){return t?i("div",{role:"alert",className:`fixed bottom-20 left-0 w-full p-2 font-semibold text-center ${pn[e]} text-gray-800`},t):null}function gt({children:t,className:e}){return e||(e=""),e.match(/\bw-\S+\s*/)||(e+=" w-4"),e.match(/\bh-\S+\s*/)||(e+=" h-auto"),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16",className:e},t)}/**
 * Refresh icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function we({className:t}){return i(gt,{className:t},i("path",{d:"M16 6h-6l2.243-2.243c-1.133-1.133-2.64-1.757-4.243-1.757s-3.109 0.624-4.243 1.757c-1.133 1.133-1.757 2.64-1.757 4.243s0.624 3.109 1.757 4.243c1.133 1.133 2.64 1.757 4.243 1.757s3.109-0.624 4.243-1.757c0.095-0.095 0.185-0.192 0.273-0.292l1.505 1.317c-1.466 1.674-3.62 2.732-6.020 2.732-4.418 0-8-3.582-8-8s3.582-8 8-8c2.209 0 4.209 0.896 5.656 2.344l2.343-2.344v6z"}))}async function yt(t){return new Promise(e=>{setTimeout(e,t)})}function yn(){const[t,e]=y(0),n=q(async(r,o=500)=>{e(c=>c+1);const l=yt(o);try{await r()}finally{await l,e(c=>c-1)}},[]);return[t>0?i(bn,null):null,n]}function bn(){const{bg:t}=H();return i(be,{className:"flex items-center bg-white bg-opacity-75"},i("div",{className:"w-[50px] mx-auto"},i("div",{"aria-label":"Loading\u2026",className:`rounded-full p-[20%] ${t}`},i(we,{className:"animate-spin w-full text-white"}))))}function xe(){const[t,e]=yn(),n=!!t,[s,r]=ve();return{loadData:q(async(c,u)=>{const d=E({error:"Unknown error occurred",request:"Network request failed"},u);r("");let a=()=>null;const f=new Promise(m=>{a=()=>m(null)});async function _(...m){await f,r(...m)}await e(async()=>{try{await c(_)}catch(m){if(m instanceof at){const{status:h}=m.response;_(h in d?d[h]:d.request,"error")}else console.error(m),_(d.error,"error")}}),a()},[e,r]),loaderElem:i(x,null,s,t),isLoading:n}}/**
 * Power icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function vn({className:t}){return i(gt,{className:t},i("path",{d:"M6 0l-6 8h6l-4 8 14-10h-8l6-6z"}))}function He(t){const r=t,{className:e}=r,n=M(r,["className"]),{bg:s}=H();return i("select",E({className:`${e||""} border-2 border-white rounded-lg px-1 ${s} font-semibold disabled:opacity-50`},n))}function L({guests:t,selectable:e,conflicts:n}){return t.length===0?null:i("ul",{className:"mt-2"},t.map(s=>{var r;return i("li",{key:s.id,className:"px-3 py-1"},i("label",{className:"flex items-center"},e?i("input",{type:"checkbox",checked:e.isSelected(s),onChange:()=>e.onToggle(s),className:"mr-3"}):null,i("span",{className:"w-[48px] h-[48px] leading-[48px] mr-3 rounded-full text-3xl font-bold text-center bg-gray-400 text-white"},s.avatarImageUrl?i("img",{src:s.avatarImageUrl,alt:"",width:"48",height:"48",className:"rounded-full"}):i("span",{"aria-hidden":"true"},s.name[0])),i("span",{className:"leading-tight"},s.name,i("br",null),n!=null&&n[s.id]?i("span",{className:"text-xs font-semibold text-red-700"},(r=n[s.id])==null?void 0:r.replace(/_/g," ")):null)))}))}function ke({times:t}){return i("div",{className:"mt-4 text-lg"},"Arrive by:"," ",i("span",{className:"ml-0.5 font-semibold"},i("time",null,W(t.start.time))," -"," ",i("time",null,W(t.end.time))))}function wn({booking:t,onClose:e}){const n=le(),[s,r]=y(new Set),{loadData:o,loaderElem:l}=xe(),{guests:c}=t,u=s.size===0,d=s.size===c.length;function a(){o(async()=>{u||await n.cancelBooking([...s]),e(c.filter(f=>!s.has(f)))})}return i(B,{heading:"Your Lightning Lane",theme:t.park.theme},i("h2",null,t.experience.name),i("div",null,t.park.name),i(ke,{times:t}),i("div",{className:"ml-3"},i("label",{className:"flex items-center py-4"},i("input",{type:"checkbox",checked:d,onChange:()=>r(new Set(d?[]:c))}),i("span",{className:"ml-3"},"Select All"))),u?null:i("div",{className:"mb-4"},i("h3",null,"Cancel These Guests"),i(L,{guests:c.filter(f=>s.has(f)),selectable:{isSelected:()=>!0,onToggle:f=>{const _=new Set(s);_.delete(f),r(_)}}})),d?null:i("div",null,i("h3",null,"Select Guests to Cancel"),i(L,{guests:c.filter(f=>!s.has(f)),selectable:{isSelected:()=>!1,onToggle:f=>r(new Set(s).add(f))}})),i($,{onClick:a},u?"Back":"Cancel "+(d?"Reservation":"Guests")),l)}function bt({booking:t,onClose:e,isRebookable:n,isNew:s}){const r=ce(),[o,l]=y(t.guests),[c,u]=y(!1);return c?i(wn,{booking:G(E({},t),{guests:o}),onClose:d=>{u(!1),d.length>0?l(d):e(d)}}):i(B,{heading:"Your Lightning Lane",theme:t.park.theme,buttons:n&&i(P,{onClick:()=>r.begin(t)},"Rebook")},i("h2",null,t.experience.name),i("div",null,t.park.name),i(ke,{times:t}),i("div",{className:"flex mt-4"},i("h3",{className:"inline mt-0"},"Your Party"),i(P,{type:"small",onClick:()=>u(!0),className:"ml-3"},"Cancel")),i(L,{guests:o}),i($,{onClick:()=>e(o)},s?"Done":"Back"))}function vt({guests:t}){return i(L,{guests:t,conflicts:Object.fromEntries(t.map(e=>[e.id,e.displayEligibleAfter?`TOO EARLY (${e.displayEligibleAfter})`:e.ineligibleReason]))})}function xn({offer:t,guests:e,ineligibleGuests:n,onConfirm:s}){const r=ce(),[o,l]=y(new Set(e)),[c,u]=y(!1);return i(x,null,r.current&&i("p",{className:"border-2 rounded border-red-600 p-1 font-semibold text-center text-red-600 bg-red-100"},"Rebooking resets the two hour timer"),i(ke,{times:t}),t.changeStatus==="PARK_HOPPING"&&i("div",{className:"text-sm"},i("strong",null,"Note:")," Time changed due to park hopping"),c?i(x,null,i("h3",null,"Choose Your Party"),i(L,{guests:e,selectable:{isSelected:d=>o.has(d),onToggle:d=>{const a=new Set(o);a[o.has(d)?"delete":"add"](d),l(a)}}}),n.length>0&&i(x,null,i("h3",null,"Ineligible Guests"),i(vt,{guests:n})),i($,{onClick:()=>u(!1)},"Confirm Party")):i(x,null,i("div",{className:"mt-4"},i("h3",{className:"inline mt-0"},"Your Party"),i("span",null,i(P,{type:"small",onClick:()=>u(!0),className:"ml-3"},"Edit"))),i(L,{guests:e.filter(d=>o.has(d))}),i($,{onClick:()=>s([...o])},r.current?"Rebook":"Book"," Lightning Lane")))}const je="https://widget.time.is/t.js";function kn(){if([...document.scripts].some(e=>e.src===je))return;const t=document.createElement("script");t.src=je,t.onload=wt,document.head.appendChild(t)}const ee={};function wt(){"time_is_widget"in self&&self.time_is_widget.init(ee)}function Nn(t){kn(),ee[t]||(ee[t]={}),wt()}function xt(t,e){const n=document.getElementById(t);if(!n||n.firstElementChild)return e();n.textContent=U().time,setTimeout(()=>xt(t,e),100)}function En({id:t,onSync:e}){return A(()=>{Nn(t),xt(t,e)},[t,e]),i("time",{id:t})}const Tn={WDW:"Orlando_z161",DLR:"Anaheim_z14e"},Cn=5e3;function kt({resort:t,time:e,label:n}){const[s,r]=y(null);A(()=>{setTimeout(()=>r(l=>l||!1),Cn)},[]);const o=q(()=>r(!0),[]);return i("table",{className:"mt-4 mx-auto text-gray-500"},i(We,{heading:n,time:i("time",null,e||"--:--:--")}),i(We,{heading:i("a",{href:`https://time.is/${t}`,id:"time_is_link",target:"_blank",rel:"noreferrer"},"Current time"),time:i(x,null,i(En,{id:Tn[t],onSync:o}),s===!1?i("span",{className:"text-sm font-sans font-semibold text-red-600"}," ","(unsynced)"):null)}))}function We({heading:t,time:e}){return i("tr",null,i("th",{scope:"row",className:"pr-3 text-right text-xs font-semibold uppercase"},t,":"),i("td",{className:"text-xl font-mono leading-tight"},"\uFEFF",e))}function Sn({startTime:t,onRefresh:e}){return i(x,null,t&&i(kt,{resort:"WDW",time:t,label:"Booking start"}),i("h3",{className:"mt-4"},"Not Available Yet"),t?i("p",null,"At"," ",i("time",{dateTime:t,className:"font-semibold"},W(t)),", tap the ",i("span",{className:"font-semibold"},"Check Availability")," ","button below to start booking this Lightning Lane."):i("p",null,"Sorry, but you can't make a Lightning Lane reservation for this attraction yet."),i($,{onClick:e},"Check Availability"))}function In({guests:t,onClose:e}){var s;const n=(s=t==null?void 0:t[0])==null?void 0:s.displayEligibleAfter;return i(x,null,n&&i("div",{className:"mt-4 border-2 border-green-600 rounded p-1 uppercase font-semibold text-center text-green-600 bg-green-100"},"Eligible at ",n),i("h3",{className:"mt-4"},"No Eligible Guests"),i("p",null,"No one in your party is currently eligible for this Lightning Lane."),i(vt,{guests:t}),i($,{onClick:e},"Back"))}function Dn({onClose:t}){return i(x,null,i("h3",null,"No Reservations Available"),i("p",null,"Tap the refresh button above to try again or go back to the tip board and select another attraction."),i($,{onClick:t},"Back"))}function Nt({booking:t,button:e}){return i("div",{className:"flex items-center gap-x-2"},i("div",{className:"flex-1 min-w-0"},i("div",{className:"text-gray-500 text-sm font-semibold"},i("time",null,W(t.start.time))," -"," ",i("time",null,W(t.end.time))),i("div",{className:"text-lg font-semibold leading-tight truncate"},t.experience.name)),e&&i("div",null,e))}function Et(){const t=ce(),e=H();return t.current?i("div",{className:`sticky top-0 -mx-3 pb-1 ${e.bg}`},i("div",{className:"pb-3 bg-white"},i("div",{className:`py-1.5 ${e.bg} text-white text-sm font-semibold uppercase text-center`},"Rebooking"),i("div",{className:"mt-2 px-3"},i(Nt,{booking:t.current,button:i(P,{type:"small",onClick:()=>t.end(!0)},"Keep")})))):null}function An({experience:t,park:e,onClose:n}){const s=le(),r=ce(),[o,l]=y(),[c,u]=y([]),[d,a]=y(t.flex.available),[f,_]=y(d?void 0:null),[m,h]=y(),{loadData:N,loaderElem:v}=xe();async function k(b){if(!f)return;let D=null;await N(async()=>{const w=new Set(b.map(C=>C.id));r.current&&await s.cancelBooking(r.current.guests.filter(C=>w.has(C.id)));try{D=await s.book(f)}finally{r.end()}const S=D.guests.filter(C=>!w.has(C.id));S.length>0&&(await s.cancelBooking(S),D.guests=D.guests.filter(C=>w.has(C.id)))},{410:"Offer expired"}),D&&h(D)}function T(){N(async b=>{const w=(await s.plusExperiences(e)).find(S=>S.id===t.id);w!=null&&w.flex.available?(a(!0),_(void 0)):b("Reservations not open yet")})}function I(){f&&s.cancelOffer(f),n()}function p(){!o||o.length===0||N(async()=>{const b=await s.offer({experience:t,park:e,guests:o});_(D=>(D&&s.cancelOffer(D),b))},{410:"No reservations available"})}return A(()=>{o||N(async()=>{const{guests:b,ineligibleGuests:D}=await s.guests({experience:t,park:e}),w=r.current;if(w){const S=new Set(D.filter(O=>O.ineligibleReason==="TOO_EARLY"||O.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"&&t.id===w.experience.id).map(O=>O.id)),C=w.guests.every(O=>S.has(O.id));l(C?w.guests:[]);const At=new Set(w.guests.map(O=>O.id));u(C?[]:D.filter(O=>At.has(O.id)))}else l(b),u(D)})},[s,t,e,o,r,N]),A(()=>{f!==void 0||!o||o.length===0||N(async()=>{try{_(await s.offer({experience:t,park:e,guests:o}))}catch(b){throw _(null),b}},{410:""})},[s,t,e,o,f,N]),m?i(bt,{booking:m,onClose:n,isNew:!0}):i(B,{heading:"Lightning Lane",theme:e.theme,buttons:i(x,null,(!d||f)&&i(P,{onClick:I},"Cancel"),d&&o&&o.length>0&&i(P,{onClick:p,title:"Refresh Offer"},i(we,null)))},i(Et,null),i("h2",null,t.name),i("div",null,e.name),(o==null?void 0:o.length)===0?i(In,{guests:c,onClose:n}):!o||f===void 0?i("div",null):d?f===null?i(Dn,{onClose:n}):i(xn,{offer:f,guests:o,ineligibleGuests:c,onConfirm:k}):i(Sn,{startTime:t.flex.enrollmentStartTime,onRefresh:T}),v)}function Rn({onClose:t}){const e=le(),[n,s]=y(),[r,o]=y(),[l,c]=y(!1);function u(a){!r||(s(f=>{if(!!f)return a.length>0?r.guests=a:f.splice(f.indexOf(r),1),f}),o(void 0))}A(()=>{c(!0),e.bookings().then(a=>s(a))},[e]);function d(){c(!1),setTimeout(t,300)}return r?i(bt,{booking:r,onClose:u,isRebookable:e.isRebookable(r)}):i(x,null,i(be,{onClick:d,"data-testid":"panel-shade",className:"bg-black bg-opacity-75"}),i(B,{heading:"Your Lightning Lanes",buttons:i(P,{onClick:d},"Close"),className:`top-auto max-h-[50%] ${l?"h-[275px]":"h-0"} duration-200 ease-linear`},n&&n.length>0?i("ul",null,(n||[]).map(a=>{var f;return i("li",{className:"py-3 first:border-0 border-t-4 border-gray-300",key:(f=a.guests[0])==null?void 0:f.entitlementId},i(Nt,{booking:a,button:i(P,{type:"small",onClick:()=>o(a)},"More")}))})):i("div",{className:"mt-4 text-sm font-semibold text-center uppercase  text-gray-500"},n&&"No current reservations")))}function Ne({label:t,children:e}){return i("div",{className:"flex items-center flex-1 whitespace-nowrap"},i("span",{className:"mr-2 text-xs font-semibold uppercase text-gray-500"},t)," ",e)}function Pn({experience:t,onClick:e}){const{flex:n}=t;return i(Ne,{label:"Genie+"},n.nextAvailableTime?i("span",null,i(P,{onClick:()=>e(t)},W(n.nextAvailableTime))):i("span",{className:"inline-block border-2 border-gray-500 rounded px-1.5 py-0.5 font-semibold text-gray-500 bg-gray-100"},"none"))}function Ln({experience:{type:t,standby:e}}){return e.displayNextShowTime||t==="ENTERTAINMENT"&&!e.waitTime?i(On,{standby:e}):i($n,{standby:e})}const $n=({standby:t})=>i(Ne,{label:"Standby"},t.available?i(Ct,{time:t.waitTime!==void 0?t.waitTime+" min":"now"}):i(St,{text:"down"})),On=({standby:t})=>i(Ne,{label:i(x,null,"Next ",i("span",{className:"hidden xs:inline"},"Show"))},t.displayNextShowTime?i(Ct,{time:t.displayNextShowTime}):i(St,{text:"none"})),Tt="inline-block border-2 rounded px-1.5 py-0.5 font-semibold",Ct=({time:t})=>i("span",{className:`${Tt} border-gray-500 text-gray-500 bg-gray-100`},t),St=({text:t})=>i("span",{className:`${Tt} border-red-600 text-red-600 bg-red-100`},t),Gn=6e4,Bn=(t,e)=>(t.priority||1/0)-(e.priority||1/0),ue=(t,e)=>(e.standby.waitTime||-1)-(t.standby.waitTime||-1),de=(t,e)=>(t.flex.nextAvailableTime||"").localeCompare(e.flex.nextAvailableTime||""),Mn=(t,e)=>t.name.toLowerCase().localeCompare(e.name.toLowerCase()),Un={priority:(t,e)=>Bn(t,e)||ue(t,e)||de(t,e),standby:(t,e)=>ue(t,e)||de(t,e),soonest:(t,e)=>de(t,e)||ue(t,e),aToZ:()=>0};function Fn(){const t=le(),{parks:e}=t,[n,s]=y(e[0]),[r,o]=y([]),[l,c]=y(),[u,d]=y(!1),[a,f]=y("priority"),{loadData:_,loaderElem:m,isLoading:h}=xe(),[,N]=y(0),[v,k]=y(()=>({current:null,begin:p=>{k(G(E({},v),{current:p})),s(p.park),d(!1)},end:(p=!1)=>{k(b=>b.current?G(E({},b),{current:null}):b),p&&c(void 0)}})),T=ye(null),I=q((p=!0)=>{N(b=>!p&&Date.now()-b<Gn?b:(_(async()=>o(await t.plusExperiences(n))),Date.now()))},[t,n,_]);return A(()=>{o([]),I()},[I]),A(()=>{if(h||l||u)return;const p=()=>{document.hidden||I(!1)};return document.addEventListener("visibilitychange",p),()=>{document.removeEventListener("visibilitychange",p)}},[l,I,h,u]),A(()=>{var p;(p=T.current)==null||p.scroll(0,0)},[n,a,v]),i(_n,{value:v},i(B,{heading:i(x,null,"G",i("span",{className:"hidden xs:inline"},"enie"),"+"),theme:n.theme,buttons:i(x,null,i(P,{onClick:()=>d(!0),title:"Your Lightning Lanes"},i(vn,null)),i(He,{value:n.id,onChange:p=>{s(e.find(b=>b.id===p.currentTarget.value))},title:"Park"},e.map(p=>i("option",{value:p.id,title:p.name,key:p.id},p.abbr))),i(He,{value:a,onChange:p=>f(p.currentTarget.value),title:"Sort By"},i("option",{value:"priority"},"Priority"),i("option",{value:"standby"},"Standby"),i("option",{value:"soonest"},"Soonest"),i("option",{value:"aToZ"},"A to Z")),i(P,{onClick:I,title:"Refresh Tip Board"},i(we,null))),containerRef:T},i("div",{"aria-hidden":!!(l||u)},i(Et,null),i("ul",null,r.sort((p,b)=>+b.flex.available-+p.flex.available||Un[a](p,b)||Mn(p,b)).map(p=>i("li",{className:"pb-3 first:border-0 border-t-4 border-gray-300",key:p.id},i("h2",{className:"text-lg leading-tight truncate"},p.name),p.flex.preexistingPlan?i("div",{className:"mt-2 border-2 border-green-600 rounded p-1 text-sm uppercase font-semibold text-center text-green-600 bg-green-100"},"Lightning Lane Booked"):null,i("div",{className:"flex flex-wrap gap-1.5 mt-2"},i(Ln,{experience:p}),i(Pn,{experience:p,onClick:c}))))),m)),u&&i(Rn,{onClose:()=>d(!1)}),l&&i(An,{experience:l,park:n,onClose:()=>{I(!1),c(void 0)}}))}const It=oe({}),Hn=It.Provider,jn=()=>ae(It),Wn={success:5e3,failure:1e3};function Qn({guests:t,result:e,onDone:n}){const{boardingGroup:s,conflicts:r}=e,o=t.filter(d=>!(d.id in r)),l=t.filter(d=>d.id in r),[c,u]=y(!0);return A(()=>{setTimeout(()=>u(!1),Wn[s?"success":"failure"])},[s]),i(x,null,s?i(x,null,i("h2",{className:"mt-5 text-xl"},"Boarding Group: ",s),i(L,{guests:o}),Object.keys(r).length>0?i(x,null,i("p",{className:"font-semibold"},"These guests could not join:"),i(L,{guests:l,conflicts:r})):null,i("p",null,"Refer to the My Disney Experience app for return time and other information.")):i(x,null,i("h2",{className:"mt-5 text-xl"},"Sorry!"),i("p",null,"A boarding group could not be obtained."),i(L,{guests:l,conflicts:r})),c?null:i($,{onClick:n},"Done"))}function Yn({guests:t,party:e,onToggle:n,onConfirm:s}){return i(x,null,i("h2",{className:"mt-5 text-xl"},"Choose Your Party"),t.length>0?i(L,{guests:t,selectable:{isSelected:r=>e.has(r),onToggle:n}}):i("p",null,"No guests available"),i($,{disabled:e.size===0,onClick:s},"Confirm Party"))}function Jn({queue:t}){return i(x,null,t.howToEnterMessage.split(`

`).map((e,n)=>i("p",{key:n},e)))}const qn=999;function zn({guests:t,joinQueue:e,onEdit:n}){const[s,r]=y(!1),[o,l]=ve(),{bg:c}=H();async function u(){r(!0),l("");const d=yt(qn);try{await e()||l("Queue not open yet")}catch(a){l("Error: try again","error"),a instanceof X||console.error(a)}finally{await d,r(!1)}}return i(x,null,i("div",{className:"mt-4"},i("h2",{className:"inline text-xl"},"Your Party"),i("span",null,i("button",{onClick:n,className:`ml-3 px-2 py-1.5 rounded-lg ${c} text-white text-xs uppercase font-semibold tracking-wide align-middle`},"Edit"))),i(L,{guests:t}),i($,{disabled:s,onClick:u},"Join Boarding Group"),o)}function Kn({queue:t,queues:e,onChange:n}){e||(e=[]);const{bg:s}=H(),r=`block w-full ${s} text-white text-xl font-semibold`;return i(x,null,e.length<=1?i("span",{className:`${r} px-1 truncate`},t.name):i("select",{className:`${r} pr-1`,onChange:o=>n?n(o.currentTarget.value):null},e.map(o=>i("option",{selected:o===t,key:o.id,value:o.id,className:"text-base font-normal"},o.name))))}function Vn(){const t=jn(),[e,n]=y(),[s,r]=y(null),[o,l]=y([]),[c,u]=y(new Set),[d,a]=y({boardingGroup:null,conflicts:{},closed:!0}),[f,_]=y("ChooseParty"),[m,h]=ve(),N=ye(null);A(()=>{(async()=>{const w=await t.getQueues();n(w),r(w[0])})()},[t]),A(()=>{if(!s)return;let w=!1;return(async()=>{const S=await t.getLinkedGuests(s);w||(l(S),u(new Set(S.filter(C=>C.isPreselected))))})(),()=>{w=!0}},[t,s]),A(()=>{var w;(w=N.current)==null||w.scroll(0,0)},[f]);function v(w){const S=new Set(c);S[S.has(w)?"delete":"add"](w);const C=Number(s==null?void 0:s.maxPartySize);C>0&&S.size>C?h(`Max party size: ${C}`,"error"):(u(S),h(""))}function k(w){const S=e==null?void 0:e.find(C=>C.id===w);S&&r(S)}async function T(){return!s||!(await t.getQueue(s)).isAcceptingJoins?!1:(a(await t.joinQueue(s,[...c])),_("BGResult"),!0)}if((e==null?void 0:e.length)===0)return i(B,{heading:"No Virtual Queues"},i("p",null,"The virtual queue system is not currently in use for any attractions."));if(!s)return i("div",null);const I=o.filter(w=>c.has(w)),p=i(kt,{resort:t.resort,time:s.nextScheduledOpenTime,label:"Next queue opening"}),b=i(Kn,{queue:s,queues:f==="ChooseParty"?e:[],onChange:k});return{ChooseParty:i(B,{heading:b,containerRef:N},i(Jn,{queue:s}),p,i(Yn,{guests:o,party:c,onToggle:v,onConfirm:()=>_("JoinQueue")}),m),JoinQueue:i(B,{heading:b},p,i(zn,{guests:I,onEdit:()=>_("ChooseParty"),joinQueue:T})),BGResult:i(B,{heading:b},i(Qn,{guests:I,result:d,onDone:()=>_("ChooseParty")}))}[f]}const Dt=new Ft("bg1.auth"),Qe=()=>Dt.getData();zt(origin)?Ye(new Vt({origin,getAuthData:Qe}),Vn,Hn):Jt(origin)?ge.load({origin,getAuthData:Qe}).then(t=>Ye(t,Fn,mn)):location.href="https://joelface.github.io/bg1/start.html";async function Ye(t,e,n){document.head.innerHTML+=`
    <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>BG1</title>
  `,Ut({WDW:"America/New_York",DLR:"America/Los_Angeles"}[t.resort]),Mt(i(fn,{resort:t.resort,authStore:Dt},i(n,{value:t},i(e,null))),document.body),Xn()}function Xn(){document.body.addEventListener("click",()=>null)}
