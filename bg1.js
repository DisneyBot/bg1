var Ft=Object.defineProperty,Ht=Object.defineProperties;var Wt=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var De=(t,e,n)=>e in t?Ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E=(t,e)=>{for(var n in e||(e={}))Ae.call(e,n)&&De(t,n,e[n]);if(Z)for(var n of Z(e))Le.call(e,n)&&De(t,n,e[n]);return t},G=(t,e)=>Ht(t,Wt(e));var H=(t,e)=>{var n={};for(var i in t)Ae.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&Z)for(var i of Z(t))e.indexOf(i)<0&&Le.call(t,i)&&(n[i]=t[i]);return n};var ce,y,st,J,it,Oe,ot,re={},rt=[],jt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function j(t,e){for(var n in e)t[n]=e[n];return t}function at(t){var e=t.parentNode;e&&e.removeChild(t)}function s(t,e,n){var i,r,o,a={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?ce.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)a[o]===void 0&&(a[o]=t.defaultProps[o]);return te(t,a,i,r,null)}function te(t,e,n,i,r){var o={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r==null?++st:r};return r==null&&y.vnode!=null&&y.vnode(o),o}function k(t){return t.children}function ne(t,e){this.props=t,this.context=e}function Y(t,e){if(e==null)return t.__?Y(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Y(t):null}function lt(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return lt(t)}}function ge(t){(!t.__d&&(t.__d=!0)&&J.push(t)&&!ae.__r++||Oe!==y.debounceRendering)&&((Oe=y.debounceRendering)||it)(ae)}function ae(){for(var t;ae.__r=J.length;)t=J.sort(function(e,n){return e.__v.__b-n.__v.__b}),J=[],t.some(function(e){var n,i,r,o,a,c;e.__d&&(a=(o=(n=e).__v).__e,(c=n.__P)&&(i=[],(r=j({},o)).__v=o.__v+1,xe(c,o,r,n.__n,c.ownerSVGElement!==void 0,o.__h!=null?[a]:null,i,a==null?Y(o):a,o.__h),mt(i,o),o.__e!=a&&lt(o)))})}function ct(t,e,n,i,r,o,a,c,d,u){var l,f,h,m,p,D,v,b=i&&i.__k||rt,N=b.length;for(n.__k=[],l=0;l<e.length;l++)if((m=n.__k[l]=(m=e[l])==null||typeof m=="boolean"?null:typeof m=="string"||typeof m=="number"||typeof m=="bigint"?te(null,m,null,null,m):Array.isArray(m)?te(k,{children:m},null,null,null):m.__b>0?te(m.type,m.props,m.key,null,m.__v):m)!=null){if(m.__=n,m.__b=n.__b+1,(h=b[l])===null||h&&m.key==h.key&&m.type===h.type)b[l]=void 0;else for(f=0;f<N;f++){if((h=b[f])&&m.key==h.key&&m.type===h.type){b[f]=void 0;break}h=null}xe(t,m,h=h||re,r,o,a,c,d,u),p=m.__e,(f=m.ref)&&h.ref!=f&&(v||(v=[]),h.ref&&v.push(h.ref,null,m),v.push(f,m.__c||p,m)),p!=null?(D==null&&(D=p),typeof m.type=="function"&&m.__k===h.__k?m.__d=d=ut(m,d,t):d=dt(t,m,h,b,p,d),typeof n.type=="function"&&(n.__d=d)):d&&h.__e==d&&d.parentNode!=t&&(d=Y(h))}for(n.__e=D,l=N;l--;)b[l]!=null&&(typeof n.type=="function"&&b[l].__e!=null&&b[l].__e==n.__d&&(n.__d=Y(i,l+1)),ht(b[l],b[l]));if(v)for(l=0;l<v.length;l++)ft(v[l],v[++l],v[++l])}function ut(t,e,n){for(var i,r=t.__k,o=0;r&&o<r.length;o++)(i=r[o])&&(i.__=t,e=typeof i.type=="function"?ut(i,e,n):dt(n,i,i,r,i.__e,e));return e}function dt(t,e,n,i,r,o){var a,c,d;if(e.__d!==void 0)a=e.__d,e.__d=void 0;else if(n==null||r!=o||r.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(r),a=null;else{for(c=o,d=0;(c=c.nextSibling)&&d<i.length;d+=2)if(c==r)break e;t.insertBefore(r,o),a=o}return a!==void 0?a:r.nextSibling}function zt(t,e,n,i,r){var o;for(o in n)o==="children"||o==="key"||o in e||le(t,o,null,n[o],i);for(o in e)r&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||le(t,o,e[o],n[o],i)}function $e(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||jt.test(e)?n:n+"px"}function le(t,e,n,i,r){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||$e(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||$e(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?i||t.addEventListener(e,o?Be:Ge,o):t.removeEventListener(e,o?Be:Ge,o);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n==null?"":n;break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function Ge(t){this.l[t.type+!1](y.event?y.event(t):t)}function Be(t){this.l[t.type+!0](y.event?y.event(t):t)}function xe(t,e,n,i,r,o,a,c,d){var u,l,f,h,m,p,D,v,b,N,A,C=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(d=n.__h,c=e.__e=n.__e,e.__h=null,o=[c]),(u=y.__b)&&u(e);try{e:if(typeof C=="function"){if(v=e.props,b=(u=C.contextType)&&i[u.__c],N=u?b?b.props.value:u.__:i,n.__c?D=(l=e.__c=n.__c).__=l.__E:("prototype"in C&&C.prototype.render?e.__c=l=new C(v,N):(e.__c=l=new ne(v,N),l.constructor=C,l.render=Yt),b&&b.sub(l),l.props=v,l.state||(l.state={}),l.context=N,l.__n=i,f=l.__d=!0,l.__h=[]),l.__s==null&&(l.__s=l.state),C.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=j({},l.__s)),j(l.__s,C.getDerivedStateFromProps(v,l.__s))),h=l.props,m=l.state,f)C.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(C.getDerivedStateFromProps==null&&v!==h&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(v,N),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(v,l.__s,N)===!1||e.__v===n.__v){l.props=v,l.state=l.__s,e.__v!==n.__v&&(l.__d=!1),l.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(I){I&&(I.__=e)}),l.__h.length&&a.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(v,l.__s,N),l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(h,m,p)})}l.context=N,l.props=v,l.state=l.__s,(u=y.__r)&&u(e),l.__d=!1,l.__v=e,l.__P=t,u=l.render(l.props,l.state,l.context),l.state=l.__s,l.getChildContext!=null&&(i=j(j({},i),l.getChildContext())),f||l.getSnapshotBeforeUpdate==null||(p=l.getSnapshotBeforeUpdate(h,m)),A=u!=null&&u.type===k&&u.key==null?u.props.children:u,ct(t,Array.isArray(A)?A:[A],e,n,i,r,o,a,c,d),l.base=e.__e,e.__h=null,l.__h.length&&a.push(l),D&&(l.__E=l.__=null),l.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Qt(n.__e,e,n,i,r,o,a,d);(u=y.diffed)&&u(e)}catch(I){e.__v=null,(d||o!=null)&&(e.__e=c,e.__h=!!d,o[o.indexOf(c)]=null),y.__e(I,e,n)}}function mt(t,e){y.__c&&y.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(i){i.call(n)})}catch(i){y.__e(i,n.__v)}})}function Qt(t,e,n,i,r,o,a,c){var d,u,l,f=n.props,h=e.props,m=e.type,p=0;if(m==="svg"&&(r=!0),o!=null){for(;p<o.length;p++)if((d=o[p])&&"setAttribute"in d==!!m&&(m?d.localName===m:d.nodeType===3)){t=d,o[p]=null;break}}if(t==null){if(m===null)return document.createTextNode(h);t=r?document.createElementNS("http://www.w3.org/2000/svg",m):document.createElement(m,h.is&&h),o=null,c=!1}if(m===null)f===h||c&&t.data===h||(t.data=h);else{if(o=o&&ce.call(t.childNodes),u=(f=n.props||re).dangerouslySetInnerHTML,l=h.dangerouslySetInnerHTML,!c){if(o!=null)for(f={},p=0;p<t.attributes.length;p++)f[t.attributes[p].name]=t.attributes[p].value;(l||u)&&(l&&(u&&l.__html==u.__html||l.__html===t.innerHTML)||(t.innerHTML=l&&l.__html||""))}if(zt(t,h,f,r,c),l)e.__k=[];else if(p=e.props.children,ct(t,Array.isArray(p)?p:[p],e,n,i,r&&m!=="foreignObject",o,a,o?o[0]:n.__k&&Y(n,0),c),o!=null)for(p=o.length;p--;)o[p]!=null&&at(o[p]);c||("value"in h&&(p=h.value)!==void 0&&(p!==t.value||m==="progress"&&!p||m==="option"&&p!==f.value)&&le(t,"value",p,f.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==t.checked&&le(t,"checked",p,f.checked,!1))}return t}function ft(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(i){y.__e(i,n)}}function ht(t,e,n){var i,r;if(y.unmount&&y.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||ft(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){y.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&ht(i[r],e,typeof t.type!="function");n||t.__e==null||at(t.__e),t.__e=t.__d=void 0}function Yt(t,e,n){return this.constructor(t,n)}function Jt(t,e,n){var i,r,o;y.__&&y.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,o=[],xe(e,t=(!i&&n||e).__k=s(k,null,[t]),r||re,re,e.ownerSVGElement!==void 0,!i&&n?[n]:r?null:e.firstChild?ce.call(e.childNodes):null,o,!i&&n?n:r?r.__e:e.firstChild,i),mt(o,t)}function ue(t,e){var n={__c:e="__cC"+ot++,__:t,Consumer:function(i,r){return i.children(r)},Provider:function(i){var r,o;return this.getChildContext||(r=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&r.some(ge)},this.sub=function(a){r.push(a);var c=a.componentWillUnmount;a.componentWillUnmount=function(){r.splice(r.indexOf(a),1),c&&c.call(a)}}),i.children}};return n.Provider.__=n.Consumer.contextType=n}ce=rt.slice,y={__e:function(t,e,n,i){for(var r,o,a;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),a=r.__d),a)return r.__E=r}catch(c){t=c}throw t}},st=0,ne.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=j({},this.state),typeof t=="function"&&(t=t(j({},n),this.props)),t&&j(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),ge(this))},ne.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ge(this))},ne.prototype.render=k,J=[],it=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ae.__r=0,ot=0;let _t="America/New_York";function Kt(t){_t=t}function M(t){t=new Date(t||Date.now());const e={},n="2-digit";return Intl.DateTimeFormat("en-US",{timeZone:_t,hourCycle:"h23",year:"numeric",month:n,day:n,hour:n,minute:n,second:n}).formatToParts(t).forEach(i=>e[i.type]=i.value),{date:`${e.year}-${e.month}-${e.day}`,time:`${e.hour}:${e.minute}:${e.second}`}}function W(t){const e=t.split(":").map(Number),n=e[0]>=12?"PM":"AM";return e[0]=e[0]%12||12,e.map(i=>String(i).padStart(2,"0")).join(":").replace(/:00$/,"").replace(/^0/,"")+" "+n}class qt extends Error{constructor(e){super(`Auth data "${e}" missing or expired`),this.name="ReauthNeeded"}}class Vt{constructor(e,n=localStorage){this.storageKey=e,this.storage=n}getData(){try{const e=this.storage.getItem(this.storageKey);if(e){const{swid:n,accessToken:i,expires:r}=JSON.parse(e),o=M(new Date(r)),a=M();if(o.date>a.date||o.date===a.date&&o.time>a.time&&o.time>="17")return{swid:n,accessToken:i}}}catch(e){console.error(e)}throw new qt(this.storageKey)}setData(e){this.storage.setItem(this.storageKey,JSON.stringify(e))}deleteData(){this.storage.removeItem(this.storageKey)}}const Xt="modulepreload",Me={},Zt="/bg1/",Ue=function(e,n){return!n||n.length===0?e():Promise.all(n.map(i=>{if(i=`${Zt}${i}`,i in Me)return;Me[i]=!0;const r=i.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${o}`))return;const a=document.createElement("link");if(a.rel=r?"stylesheet":Xt,r||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),r)return new Promise((c,d)=>{a.addEventListener("load",c),a.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())},en=8e3;async function ye(t,e={}){const u=e,{params:n,data:i,timeout:r=en}=u;e=H(u,["params","data","timeout"]),e.referrer||(e.referrer=""),e.credentials||(e.credentials="omit"),e.cache||(e.cache="no-store"),e.headers=E({"User-Agent":"Mozilla/5.0"},e.headers||{}),n&&(t+="?"+Object.entries(n).filter(([,l])=>l!=="").map(l=>l.map(encodeURIComponent).join("=")).join("&")),i&&(e.method||(e.method="POST"),e.headers=G(E({},e.headers),{"Content-Type":"application/json"}),e.body=JSON.stringify(i));const a=new AbortController;e.signal=a.signal;const c=setTimeout(()=>a.abort(),r);let d;try{d=await fetch(t,e)}catch(l){return console.error(l),{status:0,data:null}}finally{clearTimeout(c)}return{status:d.status,data:(d.headers.get("Content-Type")||"").startsWith("application/json")?await d.json():{}}}function tn(t){switch(t){case"./data/dlr.ts":return Ue(()=>import("./dlr.js"),[]);case"./data/wdw.ts":return Ue(()=>import("./wdw.js"),[]);default:return new Promise(function(e,n){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(n.bind(null,new Error("Unknown variable dynamic import: "+t)))})}}const be={"https://disneyworld.disney.go.com":"WDW","https://disneyland.disney.go.com":"DLR"},nn={WDW:"wdw-itinerary-api",DLR:"dlr-itinerary-web-api"};function sn(t){return t in be}class pt extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}const ee=t=>t.split(";")[0];class ke{constructor(e){this.maxPartySize=12,this.onUnauthorized=()=>{},this.guestNames=new Map,this._primaryGuestId="",this.origin=e.origin,this.authStore=e.authStore,this.data=e.data,this.bookingStack=new on}static async load(e){const n=(await tn(`./data/${be[e.origin].toLocaleLowerCase()}.ts`)).default;return new ke(G(E({},e),{data:n}))}get resort(){return be[this.origin]}get parks(){return this.data.parks}async plusExperiences(e){return(await this.request({path:`/tipboard-vas/api/v1/parks/${encodeURIComponent(e.id)}/experiences`,key:"availableExperiences"})).map(i=>E(E({},i),this.data.experiences[i.id])).filter(i=>!!(i.name&&i.flex))}async guests(e){const n=await this.request({path:"/ea-vas/api/v1/guests",params:{productType:"FLEX",experienceId:e.experience.id,parkId:e.park.id}});this._primaryGuestId=n.primaryGuestId;const i=u=>{var l=u,{firstName:a,lastName:c}=l,d=H(l,["firstName","lastName"]);return G(E({},d),{name:`${a} ${c}`.trim()})},r=n.ineligibleGuests.map(i),o=n.guests.map(i).filter(a=>"ineligibleReason"in a?(r.push(a),!1):!0);return[...o,...r].forEach(a=>{this.guestNames.has(a.id)||this.guestNames.set(a.id,a.name)}),o.sort((a,c)=>a.name.localeCompare(c.name)),r.sort((a,c)=>{const d=a.name.localeCompare(c.name);return a.eligibleAfter||c.eligibleAfter?(a.eligibleAfter||"99").localeCompare(c.eligibleAfter||"99")||d:a.ineligibleReason===c.ineligibleReason?d:a.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?-1:c.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"?1:d}),{eligible:o,ineligible:r}}async primaryGuestId(e){return this._primaryGuestId||await this.guests(e),this._primaryGuestId}async offer({experience:e,park:n,guests:i}){const{id:r,date:o,startTime:a,endTime:c,changeStatus:d}=await this.request({path:"/ea-vas/api/v1/products/flex/offers",method:"POST",data:{productType:"FLEX",guestIds:i.map(u=>u.id),primaryGuestId:await this.primaryGuestId({experience:e,park:n}),parkId:n.id,experienceId:e.id,selectedTime:e.flex.nextAvailableTime},key:"offer"});return{id:r,start:{date:o,time:a},end:{date:o,time:c},changeStatus:d}}async cancelOffer(e){await this.request({path:`/ea-vas/api/v1/offers/${encodeURIComponent(e.id)}`,method:"DELETE",params:{productType:"FLEX"},userId:!1})}async book(e){const{singleExperienceDetails:{experienceId:n,parkId:i},entitlements:r,startDateTime:o,endDateTime:a}=await this.request({path:"/ea-vas/api/v1/products/flex/bookings",method:"POST",userId:!1,data:{offerId:e.id},key:"booking"});return this.bookings(),{experience:{id:n,name:this.data.experiences[n].name},park:this.data.parks.find(c=>c.id===i),start:M(o),end:M(a),cancellable:!0,guests:r.map(c=>({id:c.guestId,name:this.guestNames.get(c.guestId)||"",entitlementId:c.id}))}}async cancelBooking(e){const i=e.map(r=>r.entitlementId).map(encodeURIComponent).join(",");await this.request({path:`/ea-vas/api/v1/entitlements/${i}`,method:"DELETE",userId:!1})}async bookings(){const{swid:e}=this.authStore.getData(),n=new Date(Date.now()),i=nn[this.resort],{items:r=[],assets:o={},profiles:a={}}=await this.request({path:`/plan/${i}/api/v1/itinerary-items/${e}`,params:{destination:this.resort,fields:"items,profiles,assets","item-types":"FASTPASS","guest-locators":e+";type=swid","guest-locator-groups":"MY_FAMILY","start-date":M(n).date,"end-date":M(new Date(n.getTime()).setDate(n.getDate()+1)).date,"show-friends":"false"},userId:!1}),c=Object.fromEntries(this.parks.map(f=>[f.id,f])),d=M(new Date(n.getTime()).setMinutes(n.getMinutes()-15)),u=new Set(["FLEX","OTHER"]),l=r.filter(f=>f.type==="FASTPASS"&&u.has(f.kind)).filter(f=>(!f.displayEndDate||f.displayEndDate>=d.date)&&(!f.displayEndTime||f.displayEndTime>=d.time)).map(f=>{const h=ee(f.facility),m=o[f.facility],{name:p}=this.data.experiences[h]||m,D=ee(m.location),v={experience:{id:h,name:p},park:c[D],start:{date:f.displayStartDate,time:f.displayStartTime},end:{date:f.displayEndDate,time:f.displayEndTime},cancellable:f.cancellable,guests:f.guests.map(b=>{const{name:N}=a[b.id];return E({id:ee(b.id),entitlementId:b.entitlementId,name:`${N.firstName} ${N.lastName}`.trim()},b.redemptionsRemaining!==void 0&&{redemptions:b.redemptionsRemaining})})};return f.multipleExperiences&&(v.experience={id:"",name:"Multiple Experiences"},v.choices=f.assets.filter(b=>!b.excluded&&!b.original).map(({content:b})=>{const N=ee(b),{name:A}=this.data.experiences[N]||o[b];return{id:N,name:A}}).sort((b,N)=>b.name.localeCompare(N.name))),v}).sort((f,h)=>((f.start.date||"0000-00-00")+(f.start.time||"")).localeCompare((h.start.date||"0000-00-00")+(h.start.time||"")));return this.bookingStack.update(l),l}isRebookable(e){return this.bookingStack.isRebookable(e)}pdt(e){var i;const n=M().time.slice(0,5);return(i=this.data.pdts[e.id])==null?void 0:i.find(r=>r>=n)}logOut(){this.authStore.deleteData(),this.onUnauthorized()}async request(e){var d;const{swid:n,accessToken:i}=this.authStore.getData(),r=this.origin+e.path,o=E({},e.params);((d=e.userId)==null||d)&&(o.userId=n);const{status:a,data:c}=await ye(r,{method:e.method||"GET",params:o,data:e.data,headers:{Authorization:`BEARER ${i}`}});if(a===401)setTimeout(()=>this.logOut());else{const{key:u}=e;if(String(a)[0]==="2"&&(!u||c[u]))return u?c[u]:c}throw new pt({status:a,data:c})}}const Fe="bg1.genie.bookings";class on{constructor(e=!0){if(this.entitlementIds=[],this.mostRecent=new Map,!e)return;const{entitlementIds:n=[],mostRecent:i={}}=JSON.parse(localStorage.getItem(Fe)||"{}");this.entitlementIds=n,this.mostRecent=new Map(Object.entries(i))}isRebookable(e){return e.guests.every(n=>this.mostRecent.get(n.id)===n.entitlementId)}update(e){const n=new Map,i=new Set(this.entitlementIds);this.entitlementIds=e.filter(({cancellable:r})=>r).map(r=>r.guests.map(({id:o,entitlementId:a})=>(this.entitlementIds.push(a),i.has(a)||n.set(o,n.has(o)?"":a),a))).flat(1),this.mostRecent=new Map([...this.mostRecent,...n]),n.size>0&&localStorage.setItem(Fe,JSON.stringify({entitlementIds:this.entitlementIds,mostRecent:Object.fromEntries(this.mostRecent)}))}}const gt={"https://vqguest-svc-wdw.wdprapps.disney.com":"WDW","https://vqguest-svc.wdprapps.disney.com":"DLR"};function rn(t){return t in gt}function an(t){return t.sort((e,n)=>e.isPrimaryGuest!==n.isPrimaryGuest?Number(n.isPrimaryGuest)-Number(e.isPrimaryGuest):e.isPreselected!==n.isPreselected?Number(n.isPreselected)-Number(e.isPreselected):e.name.localeCompare(n.name))}class se extends Error{constructor(e,n="Request failed"){super(`${n}: ${JSON.stringify(e)}`),this.response=e,this.name="RequestError"}}class ln{constructor(e){this.onUnauthorized=()=>{},this.origin=e.origin,this.authStore=e.authStore}get resort(){return gt[this.origin]}url(e){return`${this.origin}/application/v1/guest/${e}`}async getQueues(){return(await ye(this.url("getQueues"))).data.queues.map(i=>{var r=i,{queueId:e}=r,n=H(r,["queueId"]);return G(E({},n),{id:e})})}async getQueue(e){const n=(await this.getQueues()).find(i=>i.id===e.id);if(n)return n;throw new Error("Queue not Found")}async getLinkedGuests(e){const{data:n}=await this.post({resource:"getLinkedGuests",data:{queueId:e.id}});return an(n.guests.map(c=>{var d=c,{guestId:i,firstName:r,lastName:o}=d,a=H(d,["guestId","firstName","lastName"]);return G(E({},a),{id:i,name:`${r} ${o}`.trim()})}))}async joinQueue(e,n){const i=n.map(a=>a.id),{status:r,data:o}=await this.post({resource:"joinQueue",data:{queueId:e.id,guestIds:i}});if(o.responseStatus==="OK"){const a=o.positions.find(c=>c.queueId===e.id&&c.guestIds.length>0&&i.some(d=>c.guestIds.includes(d)));if(!a)throw new se({status:r,data:o});return{boardingGroup:a.boardingGroup,conflicts:{},closed:!1}}else if(o.responseStatus==="INVALID_GUEST"||o.responseStatus==="CLOSED_QUEUE"){const a=o.responseStatus==="CLOSED_QUEUE",c=new Set,d={};for(const f of o.conflicts)for(const h of f.guestIds){const m=n.find(p=>p.id===h);!m||(d[m.id]=f.conflictType,c.add(h))}const u=n.filter(f=>!c.has(f.id));if(a||u.length===0)return{boardingGroup:null,conflicts:d,closed:a};const l=await this.joinQueue(e,u);return l.conflicts=E(E({},d),l.conflicts),l}else throw new se({status:r,data:o})}logOut(){this.authStore.deleteData(),this.onUnauthorized()}async post(e){const{status:n,data:i}=await ye(this.url(e.resource),{method:"POST",headers:{Authorization:`BEARER ${this.authStore.getData().accessToken}`},data:e.data});if(n===401&&setTimeout(()=>this.logOut()),!n||n===401||n>=500)throw new se({status:n,data:i});return{status:n,data:i}}}var q,L,He,K=0,yt=[],We=y.__b,je=y.__r,ze=y.diffed,Qe=y.__c,Ye=y.unmount;function de(t,e){y.__h&&y.__h(L,t,K||e),K=0;var n=L.__H||(L.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function w(t){return K=1,cn(wt,t)}function cn(t,e,n){var i=de(q++,2);return i.t=t,i.__c||(i.__=[n?n(e):wt(void 0,e),function(r){var o=i.t(i.__[0],r);i.__[0]!==o&&(i.__=[o,i.__[1]],i.__c.setState({}))}],i.__c=L),i.__}function R(t,e){var n=de(q++,3);!y.__s&&vt(n.__H,e)&&(n.__=t,n.__H=e,L.__H.__h.push(n))}function Ne(t){return K=5,bt(function(){return{current:t}},[])}function bt(t,e){var n=de(q++,7);return vt(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Q(t,e){return K=8,bt(function(){return t},e)}function me(t){var e=L.context[t.__c],n=de(q++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(L)),e.props.value):t.__}function un(){for(var t;t=yt.shift();)if(t.__P)try{t.__H.__h.forEach(ie),t.__H.__h.forEach(ve),t.__H.__h=[]}catch(e){t.__H.__h=[],y.__e(e,t.__v)}}y.__b=function(t){L=null,We&&We(t)},y.__r=function(t){je&&je(t),q=0;var e=(L=t.__c).__H;e&&(e.__h.forEach(ie),e.__h.forEach(ve),e.__h=[])},y.diffed=function(t){ze&&ze(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(yt.push(e)!==1&&He===y.requestAnimationFrame||((He=y.requestAnimationFrame)||function(n){var i,r=function(){clearTimeout(o),Je&&cancelAnimationFrame(i),setTimeout(n)},o=setTimeout(r,100);Je&&(i=requestAnimationFrame(r))})(un)),L=null},y.__c=function(t,e){e.some(function(n){try{n.__h.forEach(ie),n.__h=n.__h.filter(function(i){return!i.__||ve(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],y.__e(i,n.__v)}}),Qe&&Qe(t,e)},y.unmount=function(t){Ye&&Ye(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{ie(i)}catch(r){e=r}}),e&&y.__e(e,n.__v))};var Je=typeof requestAnimationFrame=="function";function ie(t){var e=L,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),L=e}function ve(t){var e=L;t.__c=t.__(),L=e}function vt(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function wt(t,e){return typeof e=="function"?e(t):e}const xt={bg:"bg-blue-500"},kt=ue(xt),dn=kt.Provider,z=()=>me(kt),mn={normal:"py-1",small:"py-1.5 text-xs uppercase tracking-wide",full:"w-full py-3"};function O(t){const a=t,{type:e,className:n}=a,i=H(a,["type","className"]),r=(n||"")+" "+mn[e||"normal"],{bg:o}=z();return s("button",E({className:`${r} border-2 border-white rounded-lg px-2 ${o} text-white font-semibold disabled:opacity-50`},i))}function B({onClick:t,disabled:e,href:n,children:i}){return s("div",{className:"mb-20"},s("div",{className:"fixed bottom-0 left-0 w-full bg-white bg-opacity-75 text-center"},s("a",{href:n,className:"block max-w-2xl mx-auto px-3 pb-5"},s(O,{type:"full",onClick:t,disabled:e},i))))}function fn({title:t,children:e}){const{bg:n}=z();return s("div",{className:`flex justify-end gap-x-2 gap-y-1 min-h-[52px] px-3 py-2 font-semibold text-white ${n}`},s("h1",{className:"flex-1 self-center py-0.5 text-xl overflow-hidden whitespace-nowrap"},t),e)}function Se(t){const o=t,{children:e,className:n}=o,i=H(o,["children","className"]),r=E({outer:"",inner:""},typeof n=="string"?{inner:n}:n);return s("div",E({className:`${r.outer} fixed inset-0`},i),s("div",{className:`${r.inner} max-w-2xl min-h-full mx-auto`},e))}function F(c){var d=c,{heading:t,buttons:e,className:n,theme:i,containerRef:r,children:o}=d,a=H(d,["heading","buttons","className","theme","containerRef","children"]);return s(dn,{value:i||xt},s(Se,E({className:{outer:`bg-white ${n||""}`,inner:"flex flex-col max-w-2xl h-full"}},a),s(fn,{title:t},e),s("div",{ref:r,className:"flex-1 overflow-auto px-3 pb-3"},o)))}const hn="bg1.disclaimer.accepted",_n={bg:"bg-red-600"};function pn(){const t=localStorage,e=hn,[n,i]=w(!!t.getItem(e));return R(()=>{n&&t.setItem(e,"1")},[n,t,e]),n?null:s(gn,{onAccept:()=>i(!0)})}function gn({onAccept:t}){return s(F,{heading:"Warning!",theme:_n},s("p",null,'Use at your own risk. BG1 is highly experimental, for demonstration purposes only, and provided "as is" without warranty of any kind. It is in no way endorsed by or associated with the Walt Disney Company and could stop working at any time for any reason. To ensure the intended experience, always use the official Disney app.'),s(B,{onClick:t},"Accept"))}const yn="17e2767256f";function bn(t){return"deferredUuid"in t&&t.deferredUuid!==void 0}class vn{constructor(e,n,i,r=!1){this.iframe=e,this.resort=i,this.logging=r,this.handlers={},this.handshakeAcked=!1,this.onMessage=o=>{if(o.source!==this.iframe.contentWindow||o.data==="inner.loaded")return;const a=JSON.parse(o.data);this.logging&&console.log("Message:",a);const c=a.type==="message"?a.eventName:a.type,d=this.handlers[c],u=d?d("data"in a?a.data:null):void 0;bn(a)&&this.send({type:"deferred",action:"resolve",deferredUuid:a.deferredUuid,data:u!=null?u:{}})},this.on("handshake",()=>{this.handshakeAcked||(this.handshakeAcked=!0,this.send({type:"handshakeAck"}),this.logging&&this.sendMessage("setLogLevel",{level:"log"}),this.sendMessage("workflow.execute",{name:"login"}))}),this.on("lightbox.hide",()=>this.open()),this.on("session.dateOfBirth.read",()=>this.open()),this.on("session.loggedin",({token:o})=>{n({swid:o.swid,accessToken:o.access_token,expires:new Date(o.exp)})})}open(){addEventListener("message",this.onMessage),this.iframe.src=this.authPageUrl,this.handshakeAcked=!1}close(){removeEventListener("message",this.onMessage)}on(e,n){this.handlers[e]=n}sendMessage(e,n){this.send({type:"message",eventName:e,data:n})}send(e){var n;(n=this.iframe.contentWindow)==null||n.postMessage(JSON.stringify(G(E({},e),{name:"lightbox-client-window"})),this.authPageUrl)}get authPageUrl(){return`https://cdn.registerdisney.go.com/v2/TPR-${this.resort}-LBSDK.IOS-PROD/en-US?include=l10n,config,html,js&buildId=${yn}`}}function wn({resort:t,onLogin:e}){const n=Ne(null);return R(()=>{if(!n.current)return;const i=new vn(n.current,e,t);return i.open(),()=>i.close()},[t,e,n]),s("iframe",{title:"Disney Login Form",ref:n,className:"fixed top-0 left-0 w-full h-full border-0"})}const Nt=ue({resort:"WDW",onUnauthorized:()=>{},logOut:()=>null}),xn=Nt.Provider,fe=()=>me(Nt);function kn({authStore:t,children:e}){const[n,i]=w("Blank"),r=pn(),o=fe();R(()=>{o.onUnauthorized=()=>i("LoginForm")},[o]),R(()=>{function c(){if(!(document.hidden||n==="LoginForm"))try{t.getData(),i("Client")}catch{return i("LoginForm")}}return c(),document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)}},[t,n]);const a={Blank:s("div",null),LoginForm:s(wn,{resort:o.resort,onLogin:c=>{t.setData(c),i("Client")}}),Client:e};return s(k,null,r||a[n])}const V=fe,St=ue({current:null,begin:()=>null,end:()=>null}),Nn=St.Provider,X=()=>me(St),Sn=3e3,En={alert:"bg-yellow-200",error:"bg-red-200"};function he(){const[,t]=w(0),[e,n]=w(""),[i,r]=w("alert"),o=Q((c,d)=>{n(c),r(d||"alert"),t(u=>(clearTimeout(u),c?self.setTimeout(()=>{n("")},Sn):u))},[]);return[s(Tn,{message:e,type:i}),o]}function Tn({message:t,type:e}){return t?s("div",{role:"alert",className:`fixed bottom-20 left-0 w-full p-2 font-semibold text-center ${En[e]} text-gray-800`},t):null}function Ee({children:t,className:e}){return e||(e=""),e.match(/\bw-\S+\s*/)||(e+=" w-4"),e.match(/\bh-\S+\s*/)||(e+=" h-auto"),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16",className:e},t)}/**
 * Refresh icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function Te({className:t}){return s(Ee,{className:t},s("path",{d:"M16 6h-6l2.243-2.243c-1.133-1.133-2.64-1.757-4.243-1.757s-3.109 0.624-4.243 1.757c-1.133 1.133-1.757 2.64-1.757 4.243s0.624 3.109 1.757 4.243c1.133 1.133 2.64 1.757 4.243 1.757s3.109-0.624 4.243-1.757c0.095-0.095 0.185-0.192 0.273-0.292l1.505 1.317c-1.466 1.674-3.62 2.732-6.020 2.732-4.418 0-8-3.582-8-8s3.582-8 8-8c2.209 0 4.209 0.896 5.656 2.344l2.343-2.344v6z"}))}async function Et(t){return new Promise(e=>{setTimeout(e,t)})}function Cn(){const[t,e]=w(0),n=Q(async(r,o=500)=>{e(c=>c+1);const a=Et(o);try{await r()}finally{await a,e(c=>c-1)}},[]);return[t>0?s(In,null):null,n]}function In(){const{bg:t}=z();return s(Se,{className:"flex items-center bg-white bg-opacity-75"},s("div",{className:"w-[50px] mx-auto"},s("div",{"aria-label":"Loading\u2026",className:`rounded-full p-[20%] ${t}`},s(Te,{className:"animate-spin w-full text-white"}))))}function Ce(){const[t,e]=Cn(),n=!!t,[i,r]=he();return{loadData:Q(async(c,d)=>{const u=E({error:"Unknown error occurred",request:"Network request failed"},d);r("");let l=()=>null;const f=new Promise(m=>{l=()=>m(null)});async function h(...m){await f,r(...m)}await e(async()=>{try{await c(h)}catch(m){if(m instanceof pt){const{status:p}=m.response;h(p in u?u[p]:u.request,"error")}else console.error(m),h(u.error,"error")}}),l()},[e,r]),loaderElem:s(k,null,i,t),isLoading:n}}/**
 * Power icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function Rn({className:t}){return s(Ee,{className:t},s("path",{d:"M6 0l-6 8h6l-4 8 14-10h-8l6-6z"}))}function Ke(t){const r=t,{className:e}=r,n=H(r,["className"]),{bg:i}=z();return s("select",E({className:`${e||""} border-2 border-white rounded-lg px-1 ${i} font-semibold disabled:opacity-50`},n))}const Tt=ue({eligible:[],ineligible:[],selected:[],setSelected:()=>null}),Pn=Tt.Provider,Ie=()=>me(Tt);function U({guests:t,selectable:e,conflicts:n}){return t.length===0?null:s("ul",{className:"mt-2"},t.map(i=>{var r;return s("li",{key:i.id,className:"px-3 py-1"},s("label",{className:"flex items-center"},e?s("input",{type:"checkbox",checked:e.isSelected(i),onChange:()=>e.onToggle(i),className:"mr-3"}):null,s("span",{className:"w-[48px] h-[48px] leading-[48px] mr-3 rounded-full text-3xl font-bold text-center bg-gray-400 text-white"},i.avatarImageUrl?s("img",{src:i.avatarImageUrl,alt:"",width:"48",height:"48",className:"rounded-full"}):s("span",{"aria-hidden":"true"},i.name[0])),s("span",{className:"leading-tight"},i.name,s("br",null),n!=null&&n[i.id]?s("span",{className:"text-xs font-semibold text-red-700 uppercase"},(r=n[i.id])==null?void 0:r.replace(/_/g," ")):null)))}))}function Re({times:t}){return s("div",{className:"mt-4 text-lg"},"Arrive by:"," ",s("span",{className:"ml-0.5 font-semibold"},t.start.time?s("time",null,W(t.start.time)):"Park Open"," - ",t.end.time?s("time",null,W(t.end.time)):"Park Close"))}function Dn({booking:t,onClose:e}){const n=V(),[i,r]=w(new Set),{loadData:o,loaderElem:a}=Ce(),{guests:c}=t,d=i.size===0,u=i.size===c.length;function l(){o(async()=>{d||await n.cancelBooking([...i]),e(c.filter(f=>!i.has(f)))})}return s(F,{heading:"Your Lightning Lane",theme:t.park.theme},s("h2",null,t.experience.name),s("div",null,t.park.name),s(Re,{times:t}),s("div",{className:"ml-3"},s("label",{className:"flex items-center py-4"},s("input",{type:"checkbox",checked:u,onChange:()=>r(new Set(u?[]:c))}),s("span",{className:"ml-3"},"Select All"))),d?null:s("div",{className:"mb-4"},s("h3",null,"Cancel These Guests"),s(U,{guests:c.filter(f=>i.has(f)),selectable:{isSelected:()=>!0,onToggle:f=>{const h=new Set(i);h.delete(f),r(h)}}})),u?null:s("div",null,s("h3",null,"Select Guests to Cancel"),s(U,{guests:c.filter(f=>!i.has(f)),selectable:{isSelected:()=>!1,onToggle:f=>r(new Set(i).add(f))}})),s(B,{onClick:l},d?"Back":"Cancel "+(u?"Reservation":"Guests")),a)}function Ct({booking:t,onClose:e,isRebookable:n,isNew:i}){const r=X(),[o,a]=w(t.guests),[c,d]=w(!1);return c?s(Dn,{booking:G(E({},t),{guests:o}),onClose:u=>{d(!1),u.length>0?a(u):e(u)}}):s(F,{heading:"Your Lightning Lane",theme:t.park.theme,buttons:n&&s(O,{onClick:()=>r.begin(t)},"Rebook")},s("h2",null,t.experience.name),s("div",null,t.park.name),s(Re,{times:t}),t.choices&&s(k,null,s("p",null,"An experience you booked was temporarily unavailable during your return time. You may redeem this Lightning Lane at one of these replacement experiences:"),s("ul",{className:"list-disc mt-2 pl-8"},t.choices.map(u=>s("li",{key:u.id},u.name)))),s("div",{className:"flex mt-4"},s("h3",{className:"inline mt-0"},"Your Party"),t.cancellable&&s(O,{type:"small",onClick:()=>d(!0),className:"ml-3"},"Cancel")),s(U,{guests:o,conflicts:Object.fromEntries(o.filter(u=>u.redemptions!==void 0).map(u=>[u.id,`Redemptions left: ${u.redemptions}`]))}),s(B,{onClick:()=>e(o)},i?"Done":"Back"))}function It({children:t}){return s("p",{className:"border-2 rounded border-red-600 p-1 font-semibold text-center text-red-600 bg-red-100"},t)}function Rt(){const{ineligible:t}=Ie();return s(U,{guests:t,conflicts:Object.fromEntries(t.map(e=>[e.id,e.eligibleAfter?`TOO EARLY (${W(e.eligibleAfter)})`:e.ineligibleReason||"ELIGIBLE FOR NEW BOOKING"]))})}function Pt({buttonText:t,onSubmit:e}){const{eligible:n,ineligible:i,selected:r,setSelected:o}=Ie(),[a,c]=w(),[d,u]=he(),{maxPartySize:l}=V();return a?s(k,null,s("h3",null,"Choose Your Party"),s(U,{guests:n,selectable:{isSelected:h=>a.has(h),onToggle:h=>c(m=>{u(""),m=new Set(m);const p=m.has(h)?"delete":"add";return p==="add"&&m.size>=l?u(`Maximum party size: ${l}`):m[p](h),m})}}),i.length>0&&s(k,null,s("h3",null,"Ineligible Guests"),s(Rt,null)),s(B,{disabled:a.size===0,onClick:()=>{o([...a]),c(void 0)}},"Confirm Party"),d):s(k,null,n.length>l&&s(It,null,"Party size restricted"),s("div",{className:"mt-4"},s("h3",{className:"inline mt-0"},"Your Party"),s("span",null,s(O,{type:"small",onClick:()=>c(new Set(r)),className:"ml-3"},"Edit"))),s(U,{guests:r}),s(B,{onClick:e},t))}function An({offer:t,onBook:e}){const n=X();return s(k,null,n.current&&s(It,null,"Rebooking resets the two hour timer"),s(Re,{times:t}),t.changeStatus==="PARK_HOPPING"&&s("div",{className:"text-sm"},s("strong",null,"Note:")," Time changed due to park hopping"),s(Pt,{buttonText:`${n.current?"Rebook":"Book"} Lightning Lane`,onSubmit:e}))}const qe="https://widget.time.is/t.js";function Ln(){if([...document.scripts].some(e=>e.src===qe))return;const t=document.createElement("script");t.src=qe,t.onload=Dt,document.head.appendChild(t)}const oe={};function Dt(){"time_is_widget"in self&&self.time_is_widget.init(oe)}function On(t){Ln(),oe[t]||(oe[t]={}),Dt()}function At(t,e){const n=document.getElementById(t);if(!n||n.firstElementChild)return e();n.textContent=M().time,setTimeout(()=>At(t,e),100)}function $n({id:t,onSync:e}){return R(()=>{On(t),At(t,e)},[t,e]),s("time",{id:t})}const Gn={WDW:"Orlando_z161",DLR:"Anaheim_z14e"},Bn=5e3;function Lt({resort:t,time:e,label:n}){const i=Gn[t],[r,o]=w(null);R(()=>{setTimeout(()=>o(c=>c||!1),Bn)},[]);const a=Q(()=>o(!0),[]);return s("table",{className:"mt-4 mx-auto text-gray-500"},s(Ve,{heading:n,time:s("time",null,e||"--:--:--")}),s(Ve,{heading:s("a",{href:`https://time.is/${i.split("_")[0]}`,id:"time_is_link",target:"_blank",rel:"noreferrer"},"Current time"),time:s(k,null,s($n,{id:i,onSync:a}),r===!1?s("span",{className:"text-sm font-sans font-semibold text-red-600"}," ","(unsynced)"):null)}))}function Ve({heading:t,time:e}){return s("tr",null,s("th",{scope:"row",className:"pr-3 text-right text-xs font-semibold uppercase"},t,":"),s("td",{className:"text-xl font-mono leading-tight"},"\uFEFF",e))}function Mn({startTime:t,onRefresh:e}){return s(k,null,t&&s(Lt,{resort:"WDW",time:t,label:"Booking start"}),s("h3",{className:"mt-4"},"Not Available Yet"),t?s("p",null,"At"," ",s("time",{dateTime:t,className:"font-semibold"},W(t)),", tap the ",s("span",{className:"font-semibold"},"Check Availability")," ","button below to start booking this Lightning Lane."):s("p",null,"Sorry, but you can't make a Lightning Lane reservation for this attraction yet."),s(Pt,{buttonText:"Check Availability",onSubmit:e}))}function Un({onClose:t}){const{ineligible:e}=Ie(),{eligibleAfter:n}=e[0]||{},i=X();return s(k,null,n&&s("div",{className:"mt-4 border-2 border-green-600 rounded p-1 uppercase font-semibold text-center text-green-600 bg-green-100"},"Eligible at ",W(n)),i.current?s(k,null,s("h3",null,"Unable to Rebook"),s("p",null,"Your current reservation cannot be rebooked to this experience due to the following conflicts:")):s(k,null,s("h3",null,"No Eligible Guests"),s("p",null,"No one in your party is currently eligible for this Lightning Lane.")),s(Rt,null),s(B,{onClick:t},"Back"))}function Fn({onRefresh:t}){return s(k,null,s("h3",null,"No Guests Found"),s("p",null,"Your party could not be loaded. This is probably just a temporary network error. Wait a few seconds and try again."),s(B,{onClick:t},"Try Again"))}function Hn({onClose:t}){return s(k,null,s("h3",null,"No Reservations Available"),s("p",null,"Tap the refresh button above to try again or go back to the tip board and select another attraction."),s(B,{onClick:t},"Back"))}function Ot({booking:t,button:e}){return s("div",{className:"flex items-center gap-x-2"},s("div",{className:"flex-1 min-w-0"},s("div",{className:"text-gray-500 text-sm font-semibold uppercase"},t.start.time?s("time",null,W(t.start.time)):"open"," - ",t.end.time?s("time",null,W(t.end.time)):"close"),s("div",{className:"text-lg font-semibold leading-tight truncate"},t.experience.name)),e&&s("div",null,e))}function $t(){const t=X(),e=z();return t.current?s("div",{className:`sticky top-0 -mx-3 pb-1 ${e.bg}`},s("div",{className:"pb-3 bg-white"},s("div",{className:`py-1.5 ${e.bg} text-white text-sm font-semibold uppercase text-center`},"Rebooking"),s("div",{className:"mt-2 px-3"},s(Ot,{booking:t.current,button:s(O,{type:"small",onClick:()=>t.end(!0)},"Keep")})))):null}function Wn({experience:t,park:e,onClose:n}){var I;const i=V(),r=X(),[o,a]=w(),[c,d]=w(t.flex.available),[u,l]=w(c?void 0:null),[f,h]=w(),{loadData:m,loaderElem:p,isLoading:D}=Ce();async function v(){if(!u||!o)return;let S=null;await m(async()=>{const T=new Set(o.selected.map(_=>_.id));r.current&&await i.cancelBooking(r.current.guests.filter(_=>T.has(_.id)));try{S=await i.book(u)}finally{r.end()}const P=S.guests.filter(_=>!T.has(_.id));P.length>0&&(await i.cancelBooking(P),S.guests=S.guests.filter(_=>T.has(_.id)))},{410:"Offer expired"}),S&&h(S)}function b(){m(async S=>{const P=(await i.plusExperiences(e)).find(_=>_.id===t.id);P!=null&&P.flex.available?(d(!0),l(void 0)):S("Reservations not open yet")})}function N(){u&&i.cancelOffer(u),n()}function A(){!o||o.eligible.length===0||m(async()=>{const S=await i.offer({experience:t,park:e,guests:o.eligible});l(T=>(T&&i.cancelOffer(T),S))},{410:"No reservations available"})}const C=Q(()=>{m(async()=>{try{let S=await i.guests({experience:t,park:e});const T=r.current;if(T){const P=new Set(T.guests.map(g=>g.id)),_=[...S.eligible,...S.ineligible].filter(g=>P.has(g.id)&&!(g.ineligibleReason==="TOO_EARLY"||g.ineligibleReason==="EXPERIENCE_LIMIT_REACHED"&&t.id===T.experience.id));S=_.length>0?{eligible:[],ineligible:_}:{eligible:T.guests,ineligible:[]}}a(G(E({},S),{selected:S.eligible.slice(0,i.maxPartySize),setSelected:P=>a(_=>{if(!_)return _;const g=new Set(_.selected);return P.some(x=>!g.has(x))&&l(x=>{if(!x)return x;i.cancelOffer(x)}),G(E({},_),{selected:P})})}))}catch(S){throw a({eligible:[],ineligible:[],selected:[],setSelected:()=>null}),S}})},[i,t,e,r,m]);return R(C,[C]),R(()=>{u!==void 0||!o||o.selected.length===0||m(async()=>{try{l(await i.offer({experience:t,park:e,guests:[...o.selected]}))}catch(S){throw l(null),S}},{410:""})},[i,t,e,o,u,m]),f?s(Ct,{booking:f,onClose:n,isNew:!0}):s(F,{heading:"Lightning Lane",theme:e.theme,buttons:s(k,null,(!c||u!==null)&&s(O,{onClick:N},"Cancel"),c&&u!==void 0&&s(O,{onClick:A,title:"Refresh Offer"},s(Te,null)))},s($t,null),s("h2",null,t.name),s("div",null,e.name),s(Pn,{value:o||{eligible:[],ineligible:[],selected:[],setSelected:()=>null}},((I=o==null?void 0:o.eligible)==null?void 0:I.length)===0?D?s("div",null):o.ineligible.length===0?s(Fn,{onRefresh:C}):s(Un,{onClose:n}):u===void 0?s("div",null):c?u===null?s(Hn,{onClose:n}):s(An,{offer:u,onBook:v}):s(Mn,{startTime:t.flex.enrollmentStartTime,onRefresh:b})),p)}function jn({onClose:t}){const e=V(),[n,i]=w(),[r,o]=w(),[a,c]=w(!1);function d(l){!r||(i(f=>{if(!!f)return l.length>0?r.guests=l:f.splice(f.indexOf(r),1),f}),o(void 0))}R(()=>{c(!0),e.bookings().then(l=>i(l))},[e]);function u(){c(!1),setTimeout(t,300)}return r?s(Ct,{booking:r,onClose:d,isRebookable:e.isRebookable(r)}):s(k,null,s(Se,{onClick:u,"data-testid":"panel-shade",className:"bg-black bg-opacity-75"}),s(F,{heading:"Your Lightning Lanes",buttons:s(O,{onClick:u},"Close"),className:`top-auto max-h-[50%] ${a?"h-[275px]":"h-0"} duration-200 ease-linear`},n&&n.length>0?s("ul",null,(n||[]).map(l=>{var f;return s("li",{className:"py-3 first:border-0 border-t-4 border-gray-300",key:(f=l.guests[0])==null?void 0:f.entitlementId},s(Ot,{booking:l,button:s(O,{type:"small",onClick:()=>o(l)},"More")}))})):s("div",{className:"mt-4 text-sm font-semibold text-center uppercase  text-gray-500"},n&&"No current reservations")))}function Pe({label:t,children:e}){return s("div",{className:"flex items-center flex-1 whitespace-nowrap"},s("span",{className:"mr-2 text-xs font-semibold uppercase text-gray-500"},t)," ",e)}function zn({experience:t,onClick:e}){const{flex:n}=t;return s(Pe,{label:"Genie+"},n.nextAvailableTime?s("span",null,s(O,{onClick:()=>e(t)},W(n.nextAvailableTime))):s("span",{className:"inline-block border-2 border-gray-500 rounded px-1.5 py-0.5 font-semibold text-gray-500 bg-gray-100"},"none"))}function Qn({experience:{type:t,standby:e}}){return e.displayNextShowTime||t==="ENTERTAINMENT"&&!e.waitTime?s(Jn,{standby:e}):s(Yn,{standby:e})}const Yn=({standby:t})=>s(Pe,{label:"Standby"},t.available?s(Bt,{time:t.waitTime!==void 0?t.waitTime+" min":"now"}):s(Mt,{text:"down"})),Jn=({standby:t})=>s(Pe,{label:s(k,null,"Next ",s("span",{className:"hidden xs:inline"},"Show"))},t.displayNextShowTime?s(Bt,{time:t.displayNextShowTime}):s(Mt,{text:"none"})),Gt="inline-block border-2 rounded px-1.5 py-0.5 font-semibold",Bt=({time:t})=>s("span",{className:`${Gt} border-gray-500 text-gray-500 bg-gray-100`},t),Mt=({text:t})=>s("span",{className:`${Gt} border-red-600 text-red-600 bg-red-100`},t);function Xe({label:t,time:e}){const n=z();return s("div",{className:`-mx-3 px-3 pb-1 ${n.bg} text-white text-sm font-semibold uppercase text-center`},t,": ",s("time",null,W(e)))}function Ut(){const t=fe();return s(O,{type:"small",onClick:()=>t.logOut()},"Log Out")}/**
 * Star icon from [IcoMoon]{@link https://icomoon.io/#icons-icomoon}
 * @license CC-BY-4.0
 */function Kn({className:t}){return s(Ee,{className:t},s("path",{d:"M16 6.204l-5.528-0.803-2.472-5.009-2.472 5.009-5.528 0.803 4 3.899-0.944 5.505 4.944-2.599 4.944 2.599-0.944-5.505 4-3.899z"}))}const qn=6e4,Ze="bg1.genie.tipBoard.park",et="bg1.genie.tipBoard.starred",Vn=(t,e)=>(t.priority||1/0)-(e.priority||1/0),_e=(t,e)=>(e.standby.waitTime||-1)-(t.standby.waitTime||-1),pe=(t,e)=>(t.flex.nextAvailableTime||"").localeCompare(e.flex.nextAvailableTime||""),Xn=(t,e)=>t.name.toLowerCase().localeCompare(e.name.toLowerCase()),Zn={priority:(t,e)=>Vn(t,e)||_e(t,e)||pe(t,e),standby:(t,e)=>_e(t,e)||pe(t,e),soonest:(t,e)=>pe(t,e)||_e(t,e),aToZ:()=>0};function es(){const t=V(),{parks:e}=t,[n,i]=w(()=>{const{id:_=e[0].id,date:g=""}=JSON.parse(sessionStorage.getItem(Ze)||"{}")||{};return g===M().date&&e.find(x=>x.id===_)||e[0]}),[r,o]=w([]),[a,c]=w(),[d,u]=w(!1),[l,f]=w("priority"),{loadData:h,loaderElem:m,isLoading:p}=Ce(),[,D]=w(0),[v,b]=w(()=>({current:null,begin:_=>{b(G(E({},v),{current:_})),i(_.park),u(!1)},end:(_=!1)=>{b(g=>g.current?G(E({},g),{current:null}):g),_&&c(void 0)}})),N=Ne(null),A=r.length>0&&!r[0].flex.available?r[0].flex.enrollmentStartTime:void 0,C=r.length>0?t.pdt(n):void 0,[I,S]=w(()=>{let _=[];try{_=JSON.parse(localStorage.getItem(et)||"[]")}catch(g){console.error(g)}return new Set(_)}),T=Q((_=!0)=>{D(g=>!_&&Date.now()-g<qn?g:(h(async()=>o(await t.plusExperiences(n))),Date.now()))},[t,n,h]);R(()=>{o([]),T()},[T]),R(()=>{if(p||a||d)return;const _=()=>{document.hidden||T(!1)};return document.addEventListener("visibilitychange",_),()=>{document.removeEventListener("visibilitychange",_)}},[a,T,p,d]),R(()=>{var _;(_=N.current)==null||_.scroll(0,0)},[n,l,v]),R(()=>{sessionStorage.setItem(Ze,JSON.stringify({id:n.id,date:M().date}))},[n]);function P(_){const g=_.currentTarget;if(!(g instanceof HTMLElement))return;const x=g.getAttribute("data-id");!x||(I.has(x)?I.delete(x):I.add(x),localStorage.setItem(et,JSON.stringify([...I])),S(new Set([...I])))}return s(Nn,{value:v},s(F,{heading:s(k,null,"G",s("span",{className:"hidden xs:inline"},"enie"),"+"),theme:n.theme,buttons:s(k,null,s(O,{onClick:()=>u(!0),title:"Your Lightning Lanes"},s(Rn,null)),s(Ke,{value:n.id,onChange:_=>{i(e.find(g=>g.id===_.currentTarget.value))},title:"Park"},e.map(_=>s("option",{value:_.id,title:_.name,key:_.id},_.abbr))),s(Ke,{value:l,onChange:_=>f(_.currentTarget.value),title:"Sort By"},s("option",{value:"priority"},"Priority"),s("option",{value:"standby"},"Standby"),s("option",{value:"soonest"},"Soonest"),s("option",{value:"aToZ"},"A to Z")),s(O,{onClick:T,title:"Refresh Tip Board"},s(Te,null))),containerRef:N},s("div",{"aria-hidden":!!(a||d)},s($t,null),A?s(Xe,{label:"Booking start",time:A}):C?s(Xe,{label:"Next drop",time:C}):null,s("ul",null,r.sort((_,g)=>+g.flex.available-+_.flex.available||+I.has(g.id)-+I.has(_.id)||Zn[l](_,g)||Xn(_,g)).map(_=>s("li",{className:"pb-3 first:border-0 border-t-4 border-gray-300",key:_.id+(I.has(_.id)?"*":"")},s("div",{className:"flex items-center"},s(ts,{experience:_,starred:I,onClick:P}),s("h2",{className:"mt-2 text-lg leading-tight truncate"},_.name)),_.flex.preexistingPlan?s("div",{className:"mt-2 border-2 border-green-600 rounded p-1 text-sm uppercase font-semibold text-center text-green-600 bg-green-100"},"Lightning Lane Booked"):null,s("div",{className:"flex flex-wrap gap-1.5 mt-2"},s(Qn,{experience:_}),s(zn,{experience:_,onClick:c}))))),!p&&s("div",{className:"mt-12 text-center"},s(Ut,null)),m)),d&&s(jn,{onClose:()=>u(!1)}),a&&s(Wn,{experience:a,park:n,onClose:()=>{T(!1),c(void 0)}}))}function ts({experience:t,starred:e,onClick:n}){const i=z();return s("div",{className:"relative w-6 h-8"},s("button",{"data-id":t.id,title:"Favorite",className:"absolute top-0 -left-2 p-2",onClick:n},s(Kn,{className:e.has(t.id)?"text"+i.bg.slice(2):"text-gray-300"})))}const ns=fe,ss={success:5e3,failure:1e3};function is({guests:t,result:e,onDone:n}){const{boardingGroup:i,conflicts:r}=e,o=t.filter(u=>!(u.id in r)),a=t.filter(u=>u.id in r),[c,d]=w(!0);return R(()=>{setTimeout(()=>d(!1),ss[i?"success":"failure"])},[i]),s(k,null,i?s(k,null,s("h2",{className:"mt-5 text-xl"},"Boarding Group: ",i),s(U,{guests:o}),Object.keys(r).length>0?s(k,null,s("p",{className:"font-semibold"},"These guests could not join:"),s(U,{guests:a,conflicts:r})):null,s("p",null,"Refer to the My Disney Experience app for return time and other information.")):s(k,null,s("h2",{className:"mt-5 text-xl"},"Sorry!"),s("p",null,"A boarding group could not be obtained."),s(U,{guests:a,conflicts:r})),c?null:s(B,{onClick:n},"Done"))}function os({guests:t,party:e,onToggle:n,onConfirm:i}){return s(k,null,s("div",{className:"mt-5"},s("h2",{className:"inline mr-3 text-xl"},"Choose Your Party"),s(Ut,null)),t?t.length>0?s(U,{guests:t,selectable:{isSelected:r=>e.has(r),onToggle:n}}):s("p",null,"No guests available"):s("p",null,"Loading guests\u2026"),s(B,{disabled:e.size===0,onClick:i},"Confirm Party"))}function rs({queue:t}){return s(k,null,t.howToEnterMessage.split(`

`).map((e,n)=>s("p",{key:n},e)))}const as=999;function ls({guests:t,joinQueue:e,onEdit:n}){const[i,r]=w(!1),[o,a]=he();async function c(){r(!0),a("");const d=Et(as);try{await e()||a("Queue not open yet")}catch(u){a("Error: try again","error"),u instanceof se||console.error(u)}finally{await d,r(!1)}}return s(k,null,s("div",{className:"mt-4"},s("h2",{className:"inline mr-3 text-xl"},"Your Party"),s(O,{type:"small",onClick:n},"Edit")),s(U,{guests:t}),s(B,{disabled:i,onClick:c},"Join Boarding Group"),o)}function cs({queue:t,queues:e,onChange:n}){e||(e=[]);const{bg:i}=z(),r=`block w-full ${i} text-white text-xl font-semibold`;return s(k,null,e.length<=1?s("span",{className:`${r} px-1 truncate`},t.name):s("select",{className:`${r} pr-1`,onChange:o=>n?n(o.currentTarget.value):null},e.map(o=>s("option",{selected:o===t,key:o.id,value:o.id,className:"text-base font-normal"},o.name))))}const tt=t=>t.categoryContentId==="attraction";function us(){const t=ns(),[e,n]=w(),[i,r]=w(null),[o,a]=w(),[c,d]=w(new Set),[u,l]=w({boardingGroup:null,conflicts:{},closed:!0}),[f,h]=w(!1),[m,p]=w("ChooseParty"),[D,v]=he(),b=Ne(null),N=Q(async()=>{v(""),h(!0);const g=(await t.getQueues()).filter(x=>x.isAcceptingJoins||x.isAcceptingPartyCreation).sort((x,$)=>+tt($)-+tt(x)||x.name.localeCompare($.name));h(!1),n(x=>(x&&g.length===0&&v("No queues available"),g))},[t,v]);R(()=>{N();const g=()=>{document.hidden||N()};return document.addEventListener("visibilitychange",g),()=>{document.removeEventListener("visibilitychange",g)}},[N]),R(()=>{r(g=>{const x=g&&(e==null?void 0:e.find($=>$.id===g.id));return x||(a(void 0),e&&e.length>0?e[0]:null)})},[e]),R(()=>{if(o||!i)return;let g=!1;return(async()=>{const x=await t.getLinkedGuests(i);g||(a(x),d(new Set(x.filter($=>$.isPreselected))))})(),()=>{g=!0}},[t,i,o]),R(()=>{var g;(g=b.current)==null||g.scroll(0,0)},[m]);function A(g){const x=new Set(c);x[x.has(g)?"delete":"add"](g);const $=Number(i==null?void 0:i.maxPartySize);$>0&&x.size>$?v(`Maximum party size: ${$}`):(d(x),v(""))}function C(g){const x=e==null?void 0:e.find($=>$.id===g);x&&(r(x),a(void 0))}async function I(){return!i||!(await t.getQueue(i)).isAcceptingJoins?!1:(l(await t.joinQueue(i,[...c])),p("BGResult"),!0)}if((e==null?void 0:e.length)===0)return s(F,{heading:"No Active Queues"},s("p",null,"You can't join any virtual queues just yet. Check back within an hour of the queue opening time, or tap the Refresh button to check again."),s(B,{disabled:f,onClick:N},"Refresh"),D);if(!i)return s("div",null);const S=(o||[]).filter(g=>c.has(g)),T=s(Lt,{resort:t.resort,time:i.nextScheduledOpenTime,label:"Next queue opening"}),P=s(cs,{queue:i,queues:m==="ChooseParty"?e:[],onChange:C});return{ChooseParty:s(F,{heading:P,containerRef:b},s(rs,{queue:i}),T,s(os,{guests:o,party:c,onToggle:A,onConfirm:()=>p("JoinQueue")}),D),JoinQueue:s(F,{heading:P},T,s(ls,{guests:S,onEdit:()=>p("ChooseParty"),joinQueue:I})),BGResult:s(F,{heading:P},s(is,{guests:S,result:u,onDone:()=>p("ChooseParty")}))}[m]}const we=new Vt("bg1.auth");rn(origin)?nt(new ln({origin,authStore:we}),us):sn(origin)?ke.load({origin,authStore:we}).then(t=>nt(t,es)):location.href="https://joelface.github.io/bg1/start.html";async function nt(t,e){document.head.innerHTML+=`
    <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>BG1</title>
  `,Kt({WDW:"America/New_York",DLR:"America/Los_Angeles"}[t.resort]),Jt(s(xn,{value:t},s(kn,{authStore:we},s(e,null))),document.body),ds()}function ds(){document.body.addEventListener("click",()=>null)}
